"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
exports.id = "vendor-chunks/uploadthing";
exports.ids = ["vendor-chunks/uploadthing"];
exports.modules = {

/***/ "(ssr)/./node_modules/uploadthing/client/index.js":
/*!**************************************************!*\
  !*** ./node_modules/uploadthing/client/index.js ***!
  \**************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   UploadAbortedError: () => (/* reexport safe */ _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadAbortedError),\n/* harmony export */   UploadPausedError: () => (/* reexport safe */ _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadPausedError),\n/* harmony export */   genUploader: () => (/* binding */ genUploader),\n/* harmony export */   generateClientDropzoneAccept: () => (/* reexport safe */ _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.generateClientDropzoneAccept),\n/* harmony export */   generateMimeTypes: () => (/* reexport safe */ _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.generateMimeTypes),\n/* harmony export */   generatePermittedFileTypes: () => (/* reexport safe */ _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.generatePermittedFileTypes),\n/* harmony export */   isValidFileSize: () => (/* binding */ isValidFileSize),\n/* harmony export */   isValidFileType: () => (/* binding */ isValidFileType),\n/* harmony export */   version: () => (/* binding */ version)\n/* harmony export */ });\n/* harmony import */ var effect_Array__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! effect/Array */ \"(ssr)/./node_modules/effect/dist/esm/Array.js\");\n/* harmony import */ var effect_Micro__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! effect/Micro */ \"(ssr)/./node_modules/effect/dist/esm/Micro.js\");\n/* harmony import */ var _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @uploadthing/shared */ \"(ssr)/./node_modules/@uploadthing/shared/dist/index.js\");\n/* harmony import */ var effect_Function__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! effect/Function */ \"(ssr)/./node_modules/effect/dist/esm/Function.js\");\n\n\n\n\n\n\nvar version$1 = \"7.2.0\";\n\nconst createDeferred = ()=>{\n    let resolve;\n    let reject;\n    const ac = new AbortController();\n    const promise = new Promise((res, rej)=>{\n        resolve = res;\n        reject = rej;\n    });\n    return {\n        promise,\n        ac,\n        resolve,\n        reject\n    };\n};\n\nconst createAPIRequestUrl = (config)=>{\n    const url = new URL(config.url);\n    const queryParams = new URLSearchParams(url.search);\n    queryParams.set(\"actionType\", config.actionType);\n    queryParams.set(\"slug\", config.slug);\n    url.search = queryParams.toString();\n    return url;\n};\n/**\n * Creates a \"client\" for reporting events to the UploadThing server via the user's API endpoint.\n * Events are handled in \"./handler.ts starting at L112\"\n */ const createUTReporter = (cfg)=>(type, payload)=>effect_Micro__WEBPACK_IMPORTED_MODULE_1__.gen(function*() {\n            const url = createAPIRequestUrl({\n                url: cfg.url,\n                slug: cfg.endpoint,\n                actionType: type\n            });\n            const headers = new Headers((yield* effect_Micro__WEBPACK_IMPORTED_MODULE_1__.promise(async ()=>typeof cfg.headers === \"function\" ? await cfg.headers() : cfg.headers)));\n            headers.set(\"x-uploadthing-package\", cfg.package);\n            headers.set(\"x-uploadthing-version\", version$1);\n            headers.set(\"Content-Type\", \"application/json\");\n            const response = yield* (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.fetchEff)(url, {\n                method: \"POST\",\n                body: JSON.stringify(payload),\n                headers\n            }).pipe(effect_Micro__WEBPACK_IMPORTED_MODULE_1__.andThen(_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.parseResponseJson), /**\n         * We don't _need_ to validate the response here, just cast it for now.\n         * As of now, @effect/schema includes quite a few bytes we cut out by this...\n         * We have \"strong typing\" on the backend that ensures the shape should match.\n         */ effect_Micro__WEBPACK_IMPORTED_MODULE_1__.map(effect_Function__WEBPACK_IMPORTED_MODULE_2__.unsafeCoerce), effect_Micro__WEBPACK_IMPORTED_MODULE_1__.catchTag(\"FetchError\", (e)=>effect_Micro__WEBPACK_IMPORTED_MODULE_1__.fail(new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadThingError({\n                    code: \"INTERNAL_CLIENT_ERROR\",\n                    message: `Failed to report event \"${type}\" to UploadThing server`,\n                    cause: e\n                }))), effect_Micro__WEBPACK_IMPORTED_MODULE_1__.catchTag(\"BadRequestError\", (e)=>effect_Micro__WEBPACK_IMPORTED_MODULE_1__.fail(new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadThingError({\n                    code: (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.getErrorTypeFromStatusCode)(e.status),\n                    message: e.getMessage(),\n                    cause: e.json\n                }))), effect_Micro__WEBPACK_IMPORTED_MODULE_1__.catchTag(\"InvalidJson\", (e)=>effect_Micro__WEBPACK_IMPORTED_MODULE_1__.fail(new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadThingError({\n                    code: \"INTERNAL_CLIENT_ERROR\",\n                    message: \"Failed to parse response from UploadThing server\",\n                    cause: e\n                }))));\n            return response;\n        });\n\nconst uploadWithProgress = (file, rangeStart, presigned, onUploadProgress)=>effect_Micro__WEBPACK_IMPORTED_MODULE_1__.async((resume)=>{\n        const xhr = new XMLHttpRequest();\n        xhr.open(\"PUT\", presigned.url, true);\n        xhr.setRequestHeader(\"Range\", `bytes=${rangeStart}-`);\n        xhr.setRequestHeader(\"x-uploadthing-version\", version$1);\n        xhr.responseType = \"json\";\n        let previousLoaded = 0;\n        xhr.upload.addEventListener(\"progress\", ({ loaded })=>{\n            const delta = loaded - previousLoaded;\n            onUploadProgress?.({\n                loaded,\n                delta\n            });\n            previousLoaded = loaded;\n        });\n        xhr.addEventListener(\"load\", ()=>{\n            resume(xhr.status >= 200 && xhr.status < 300 ? effect_Micro__WEBPACK_IMPORTED_MODULE_1__.succeed(xhr.response) : effect_Micro__WEBPACK_IMPORTED_MODULE_1__.die(`XHR failed ${xhr.status} ${xhr.statusText} - ${JSON.stringify(xhr.response)}`));\n        });\n        // Is there a case when the client would throw and\n        // ingest server not knowing about it? idts?\n        xhr.addEventListener(\"error\", ()=>{\n            resume(new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadThingError({\n                code: \"UPLOAD_FAILED\"\n            }));\n        });\n        const formData = new FormData();\n        formData.append(\"file\", file.slice(rangeStart));\n        xhr.send(formData);\n        return effect_Micro__WEBPACK_IMPORTED_MODULE_1__.sync(()=>xhr.abort());\n    });\nconst uploadFile = (file, presigned, opts)=>(0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.fetchEff)(presigned.url, {\n        method: \"HEAD\"\n    }).pipe(effect_Micro__WEBPACK_IMPORTED_MODULE_1__.map(({ headers })=>parseInt(headers.get(\"x-ut-range-start\") ?? \"0\", 10)), effect_Micro__WEBPACK_IMPORTED_MODULE_1__.tap((start)=>opts.onUploadProgress?.({\n            delta: start,\n            loaded: start\n        })), effect_Micro__WEBPACK_IMPORTED_MODULE_1__.flatMap((start)=>uploadWithProgress(file, start, presigned, (progressEvent)=>opts.onUploadProgress?.({\n                delta: progressEvent.delta,\n                loaded: progressEvent.loaded + start\n            }))), effect_Micro__WEBPACK_IMPORTED_MODULE_1__.map(effect_Function__WEBPACK_IMPORTED_MODULE_2__.unsafeCoerce), effect_Micro__WEBPACK_IMPORTED_MODULE_1__.map((uploadResponse)=>({\n            name: file.name,\n            size: file.size,\n            key: presigned.key,\n            lastModified: file.lastModified,\n            serverData: uploadResponse.serverData,\n            url: uploadResponse.url,\n            appUrl: uploadResponse.appUrl,\n            customId: presigned.customId,\n            type: file.type,\n            fileHash: uploadResponse.fileHash\n        })));\nconst uploadFilesInternal = (endpoint, opts)=>{\n    // classic service right here\n    const reportEventToUT = createUTReporter({\n        endpoint: String(endpoint),\n        package: opts.package,\n        url: opts.url,\n        headers: opts.headers\n    });\n    const totalSize = opts.files.reduce((acc, f)=>acc + f.size, 0);\n    let totalLoaded = 0;\n    return reportEventToUT(\"upload\", {\n        input: \"input\" in opts ? opts.input : null,\n        files: opts.files.map((f)=>({\n                name: f.name,\n                size: f.size,\n                type: f.type,\n                lastModified: f.lastModified\n            }))\n    }).pipe(effect_Micro__WEBPACK_IMPORTED_MODULE_1__.flatMap((presigneds)=>effect_Micro__WEBPACK_IMPORTED_MODULE_1__.forEach(presigneds, (presigned, i)=>effect_Micro__WEBPACK_IMPORTED_MODULE_1__.flatMap(effect_Micro__WEBPACK_IMPORTED_MODULE_1__.sync(()=>opts.onUploadBegin?.({\n                    file: opts.files[i].name\n                })), ()=>uploadFile(opts.files[i], presigned, {\n                    onUploadProgress: (ev)=>{\n                        totalLoaded += ev.delta;\n                        opts.onUploadProgress?.({\n                            file: opts.files[i],\n                            progress: Math.round(ev.loaded / opts.files[i].size * 100),\n                            loaded: ev.loaded,\n                            delta: ev.delta,\n                            totalLoaded,\n                            totalProgress: Math.round(totalLoaded / totalSize * 100)\n                        });\n                    }\n                })), {\n            concurrency: 6\n        })), effect_Micro__WEBPACK_IMPORTED_MODULE_1__.provideService(_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.FetchContext, window.fetch));\n};\n\nconst version = version$1;\n/**\n * Validate that a file is of a valid type given a route config\n * @public\n */ const isValidFileType = (file, routeConfig)=>effect_Micro__WEBPACK_IMPORTED_MODULE_1__.runSync((0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.matchFileType)(file, (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.objectKeys)(routeConfig)).pipe(effect_Micro__WEBPACK_IMPORTED_MODULE_1__.map((type)=>file.type.includes(type)), effect_Micro__WEBPACK_IMPORTED_MODULE_1__.orElseSucceed(()=>false)));\n/**\n * Validate that a file is of a valid size given a route config\n * @public\n */ const isValidFileSize = (file, routeConfig)=>effect_Micro__WEBPACK_IMPORTED_MODULE_1__.runSync((0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.matchFileType)(file, (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.objectKeys)(routeConfig)).pipe(effect_Micro__WEBPACK_IMPORTED_MODULE_1__.flatMap((type)=>(0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.fileSizeToBytes)(routeConfig[type].maxFileSize)), effect_Micro__WEBPACK_IMPORTED_MODULE_1__.map((maxFileSize)=>file.size <= maxFileSize), effect_Micro__WEBPACK_IMPORTED_MODULE_1__.orElseSucceed(()=>false)));\n/**\n * Generate a typed uploader for a given FileRouter\n * @public\n */ const genUploader = (initOpts)=>{\n    const routeRegistry = (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.createIdentityProxy)();\n    const controllableUpload = async (slug, opts)=>{\n        const uploads = new Map();\n        const endpoint = typeof slug === \"function\" ? slug(routeRegistry) : slug;\n        const utReporter = createUTReporter({\n            endpoint: String(endpoint),\n            package: initOpts.package,\n            url: (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.resolveMaybeUrlArg)(initOpts?.url),\n            headers: opts.headers\n        });\n        const presigneds = await effect_Micro__WEBPACK_IMPORTED_MODULE_1__.runPromise(utReporter(\"upload\", {\n            // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n            input: \"input\" in opts ? opts.input : null,\n            files: opts.files.map((f)=>({\n                    name: f.name,\n                    size: f.size,\n                    type: f.type,\n                    lastModified: f.lastModified\n                }))\n        }).pipe(effect_Micro__WEBPACK_IMPORTED_MODULE_1__.provideService(_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.FetchContext, window.fetch)));\n        const totalSize = opts.files.reduce((acc, f)=>acc + f.size, 0);\n        let totalLoaded = 0;\n        const uploadEffect = (file, presigned)=>uploadFile(file, presigned, {\n                onUploadProgress: (progressEvent)=>{\n                    totalLoaded += progressEvent.delta;\n                    opts.onUploadProgress?.({\n                        ...progressEvent,\n                        file,\n                        progress: Math.round(progressEvent.loaded / file.size * 100),\n                        totalLoaded,\n                        totalProgress: Math.round(totalLoaded / totalSize * 100)\n                    });\n                }\n            }).pipe(effect_Micro__WEBPACK_IMPORTED_MODULE_1__.provideService(_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.FetchContext, window.fetch));\n        for (const [i, p] of presigneds.entries()){\n            const file = opts.files[i];\n            const deferred = createDeferred();\n            uploads.set(file, {\n                deferred,\n                presigned: p\n            });\n            void effect_Micro__WEBPACK_IMPORTED_MODULE_1__.runPromiseExit(uploadEffect(file, p), {\n                signal: deferred.ac.signal\n            }).then((result)=>{\n                if (result._tag === \"Right\") {\n                    return deferred.resolve(result.right);\n                } else if (result.left._tag === \"Interrupt\") {\n                    throw new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadPausedError();\n                }\n                throw effect_Micro__WEBPACK_IMPORTED_MODULE_1__.causeSquash(result.left);\n            }).catch((err)=>{\n                if (err instanceof _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadPausedError) return;\n                deferred.reject(err);\n            });\n        }\n        /**\n     * Pause an ongoing upload\n     * @param file The file upload you want to pause. Can be omitted to pause all files\n     */ const pauseUpload = (file)=>{\n            const files = effect_Array__WEBPACK_IMPORTED_MODULE_3__.ensure(file ?? opts.files);\n            for (const file of files){\n                const upload = uploads.get(file);\n                if (!upload) return;\n                if (upload.deferred.ac.signal.aborted) {\n                    // Cancel the upload if it's already been paused\n                    throw new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadAbortedError();\n                }\n                upload.deferred.ac.abort();\n            }\n        };\n        /**\n     * Resume a paused upload\n     * @param file The file upload you want to resume. Can be omitted to resume all files\n     */ const resumeUpload = (file)=>{\n            const files = effect_Array__WEBPACK_IMPORTED_MODULE_3__.ensure(file ?? opts.files);\n            for (const file of files){\n                const upload = uploads.get(file);\n                if (!upload) throw \"No upload found\";\n                upload.deferred.ac = new AbortController();\n                void effect_Micro__WEBPACK_IMPORTED_MODULE_1__.runPromiseExit(uploadEffect(file, upload.presigned), {\n                    signal: upload.deferred.ac.signal\n                }).then((result)=>{\n                    if (result._tag === \"Right\") {\n                        return upload.deferred.resolve(result.right);\n                    } else if (result.left._tag === \"Interrupt\") {\n                        throw new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadPausedError();\n                    }\n                    throw effect_Micro__WEBPACK_IMPORTED_MODULE_1__.causeSquash(result.left);\n                }).catch((err)=>{\n                    if (err instanceof _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadPausedError) return;\n                    upload.deferred.reject(err);\n                });\n            }\n        };\n        /**\n     * Wait for an upload to complete\n     * @param file The file upload you want to wait for. Can be omitted to wait for all files\n     */ const done = async (file)=>{\n            const promises = [];\n            const files = effect_Array__WEBPACK_IMPORTED_MODULE_3__.ensure(file ?? opts.files);\n            for (const file of files){\n                const upload = uploads.get(file);\n                if (!upload) throw \"No upload found\";\n                promises.push(upload.deferred.promise);\n            }\n            const results = await Promise.all(promises);\n            return file ? results[0] : results;\n        };\n        return {\n            pauseUpload,\n            resumeUpload,\n            done\n        };\n    };\n    /**\n   * One step upload function that both requests presigned URLs\n   * and then uploads the files to UploadThing\n   */ const typedUploadFiles = (slug, opts)=>{\n        const endpoint = typeof slug === \"function\" ? slug(routeRegistry) : slug;\n        return uploadFilesInternal(endpoint, {\n            ...opts,\n            skipPolling: {},\n            url: (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.resolveMaybeUrlArg)(initOpts?.url),\n            package: initOpts.package,\n            // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n            input: opts.input\n        }).pipe((effect)=>effect_Micro__WEBPACK_IMPORTED_MODULE_1__.runPromiseExit(effect, opts.signal && {\n                signal: opts.signal\n            })).then((exit)=>{\n            if (exit._tag === \"Right\") {\n                return exit.right;\n            } else if (exit.left._tag === \"Interrupt\") {\n                throw new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_0__.UploadAbortedError();\n            }\n            throw effect_Micro__WEBPACK_IMPORTED_MODULE_1__.causeSquash(exit.left);\n        });\n    };\n    return {\n        uploadFiles: typedUploadFiles,\n        createUpload: controllableUpload,\n        /**\n     * Identity object that can be used instead of raw strings\n     * that allows \"Go to definition\" in your IDE to bring you\n     * to the backend definition of a route.\n     */ routeRegistry\n    };\n};\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvdXBsb2FkdGhpbmcvY2xpZW50L2luZGV4LmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBb0M7QUFDRTtBQUNvTjtBQUNqRztBQUMxRzs7QUFFL0M7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFEQUFxRCw2Q0FBUztBQUM5RDtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixnREFBZ0QsaURBQWE7QUFDN0Q7QUFDQTtBQUNBO0FBQ0Esb0NBQW9DLDZEQUFRO0FBQzVDO0FBQ0E7QUFDQTtBQUNBLGFBQWEsT0FBTyxpREFBYSxDQUFDLGtFQUFpQjtBQUNuRDtBQUNBO0FBQ0E7QUFDQSxZQUFZLDZDQUFTLENBQUMseURBQVksR0FBRyxrREFBYyxvQkFBb0IsOENBQVUsS0FBSyxpRUFBZ0I7QUFDdEc7QUFDQSx3REFBd0QsS0FBSztBQUM3RDtBQUNBLGlCQUFpQixLQUFLLGtEQUFjLHlCQUF5Qiw4Q0FBVSxLQUFLLGlFQUFnQjtBQUM1RiwwQkFBMEIsK0VBQTBCO0FBQ3BEO0FBQ0E7QUFDQSxpQkFBaUIsS0FBSyxrREFBYyxxQkFBcUIsOENBQVUsS0FBSyxpRUFBZ0I7QUFDeEY7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0EsU0FBUzs7QUFFVCw0RUFBNEUsK0NBQVc7QUFDdkY7QUFDQTtBQUNBLCtDQUErQyxXQUFXO0FBQzFEO0FBQ0E7QUFDQTtBQUNBLG1EQUFtRCxRQUFRO0FBQzNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0EsU0FBUztBQUNUO0FBQ0EsMkRBQTJELGlEQUFhLGlCQUFpQiw2Q0FBUyxlQUFlLFlBQVksRUFBRSxnQkFBZ0IsSUFBSSw2QkFBNkI7QUFD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QTtBQUNBLDJCQUEyQjtBQUMzQixpQkFBaUIsdUVBQWtCO0FBQ25DO0FBQ0E7QUFDQTtBQUNBLFNBQVMsaUJBQWlCLHdEQUFvQjtBQUM5QztBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsY0FBYztBQUNkLDBCQUEwQixtRUFBa0I7QUFDNUM7QUFDQSxrQkFBa0IscURBQWlCO0FBQ25DLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVrRSIsInNvdXJjZXMiOlsid2VicGFjazovL215LWFwcC8uL25vZGVfbW9kdWxlcy91cGxvYWR0aGluZy9jbGllbnQvaW5kZXguanM/NTExNSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBBcnIgZnJvbSAnZWZmZWN0L0FycmF5JztcbmltcG9ydCAqIGFzIE1pY3JvIGZyb20gJ2VmZmVjdC9NaWNybyc7XG5pbXBvcnQgeyBmZXRjaEVmZiwgcGFyc2VSZXNwb25zZUpzb24sIFVwbG9hZFRoaW5nRXJyb3IsIGdldEVycm9yVHlwZUZyb21TdGF0dXNDb2RlLCBGZXRjaENvbnRleHQsIG1hdGNoRmlsZVR5cGUsIG9iamVjdEtleXMsIGZpbGVTaXplVG9CeXRlcywgY3JlYXRlSWRlbnRpdHlQcm94eSwgcmVzb2x2ZU1heWJlVXJsQXJnLCBVcGxvYWRQYXVzZWRFcnJvciwgVXBsb2FkQWJvcnRlZEVycm9yIH0gZnJvbSAnQHVwbG9hZHRoaW5nL3NoYXJlZCc7XG5leHBvcnQgeyBVcGxvYWRBYm9ydGVkRXJyb3IsIFVwbG9hZFBhdXNlZEVycm9yLCBnZW5lcmF0ZUNsaWVudERyb3B6b25lQWNjZXB0LCBnZW5lcmF0ZU1pbWVUeXBlcywgZ2VuZXJhdGVQZXJtaXR0ZWRGaWxlVHlwZXMgfSBmcm9tICdAdXBsb2FkdGhpbmcvc2hhcmVkJztcbmltcG9ydCB7IHVuc2FmZUNvZXJjZSB9IGZyb20gJ2VmZmVjdC9GdW5jdGlvbic7XG5cbnZhciB2ZXJzaW9uJDEgPSBcIjcuMi4wXCI7XG5cbmNvbnN0IGNyZWF0ZURlZmVycmVkID0gKCk9PntcbiAgICBsZXQgcmVzb2x2ZTtcbiAgICBsZXQgcmVqZWN0O1xuICAgIGNvbnN0IGFjID0gbmV3IEFib3J0Q29udHJvbGxlcigpO1xuICAgIGNvbnN0IHByb21pc2UgPSBuZXcgUHJvbWlzZSgocmVzLCByZWopPT57XG4gICAgICAgIHJlc29sdmUgPSByZXM7XG4gICAgICAgIHJlamVjdCA9IHJlajtcbiAgICB9KTtcbiAgICByZXR1cm4ge1xuICAgICAgICBwcm9taXNlLFxuICAgICAgICBhYyxcbiAgICAgICAgcmVzb2x2ZSxcbiAgICAgICAgcmVqZWN0XG4gICAgfTtcbn07XG5cbmNvbnN0IGNyZWF0ZUFQSVJlcXVlc3RVcmwgPSAoY29uZmlnKT0+e1xuICAgIGNvbnN0IHVybCA9IG5ldyBVUkwoY29uZmlnLnVybCk7XG4gICAgY29uc3QgcXVlcnlQYXJhbXMgPSBuZXcgVVJMU2VhcmNoUGFyYW1zKHVybC5zZWFyY2gpO1xuICAgIHF1ZXJ5UGFyYW1zLnNldChcImFjdGlvblR5cGVcIiwgY29uZmlnLmFjdGlvblR5cGUpO1xuICAgIHF1ZXJ5UGFyYW1zLnNldChcInNsdWdcIiwgY29uZmlnLnNsdWcpO1xuICAgIHVybC5zZWFyY2ggPSBxdWVyeVBhcmFtcy50b1N0cmluZygpO1xuICAgIHJldHVybiB1cmw7XG59O1xuLyoqXG4gKiBDcmVhdGVzIGEgXCJjbGllbnRcIiBmb3IgcmVwb3J0aW5nIGV2ZW50cyB0byB0aGUgVXBsb2FkVGhpbmcgc2VydmVyIHZpYSB0aGUgdXNlcidzIEFQSSBlbmRwb2ludC5cbiAqIEV2ZW50cyBhcmUgaGFuZGxlZCBpbiBcIi4vaGFuZGxlci50cyBzdGFydGluZyBhdCBMMTEyXCJcbiAqLyBjb25zdCBjcmVhdGVVVFJlcG9ydGVyID0gKGNmZyk9Pih0eXBlLCBwYXlsb2FkKT0+TWljcm8uZ2VuKGZ1bmN0aW9uKigpIHtcbiAgICAgICAgICAgIGNvbnN0IHVybCA9IGNyZWF0ZUFQSVJlcXVlc3RVcmwoe1xuICAgICAgICAgICAgICAgIHVybDogY2ZnLnVybCxcbiAgICAgICAgICAgICAgICBzbHVnOiBjZmcuZW5kcG9pbnQsXG4gICAgICAgICAgICAgICAgYWN0aW9uVHlwZTogdHlwZVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBjb25zdCBoZWFkZXJzID0gbmV3IEhlYWRlcnMoKHlpZWxkKiBNaWNyby5wcm9taXNlKGFzeW5jICgpPT50eXBlb2YgY2ZnLmhlYWRlcnMgPT09IFwiZnVuY3Rpb25cIiA/IGF3YWl0IGNmZy5oZWFkZXJzKCkgOiBjZmcuaGVhZGVycykpKTtcbiAgICAgICAgICAgIGhlYWRlcnMuc2V0KFwieC11cGxvYWR0aGluZy1wYWNrYWdlXCIsIGNmZy5wYWNrYWdlKTtcbiAgICAgICAgICAgIGhlYWRlcnMuc2V0KFwieC11cGxvYWR0aGluZy12ZXJzaW9uXCIsIHZlcnNpb24kMSk7XG4gICAgICAgICAgICBoZWFkZXJzLnNldChcIkNvbnRlbnQtVHlwZVwiLCBcImFwcGxpY2F0aW9uL2pzb25cIik7XG4gICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IHlpZWxkKiBmZXRjaEVmZih1cmwsIHtcbiAgICAgICAgICAgICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgICAgICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHBheWxvYWQpLFxuICAgICAgICAgICAgICAgIGhlYWRlcnNcbiAgICAgICAgICAgIH0pLnBpcGUoTWljcm8uYW5kVGhlbihwYXJzZVJlc3BvbnNlSnNvbiksIC8qKlxuICAgICAgICAgKiBXZSBkb24ndCBfbmVlZF8gdG8gdmFsaWRhdGUgdGhlIHJlc3BvbnNlIGhlcmUsIGp1c3QgY2FzdCBpdCBmb3Igbm93LlxuICAgICAgICAgKiBBcyBvZiBub3csIEBlZmZlY3Qvc2NoZW1hIGluY2x1ZGVzIHF1aXRlIGEgZmV3IGJ5dGVzIHdlIGN1dCBvdXQgYnkgdGhpcy4uLlxuICAgICAgICAgKiBXZSBoYXZlIFwic3Ryb25nIHR5cGluZ1wiIG9uIHRoZSBiYWNrZW5kIHRoYXQgZW5zdXJlcyB0aGUgc2hhcGUgc2hvdWxkIG1hdGNoLlxuICAgICAgICAgKi8gTWljcm8ubWFwKHVuc2FmZUNvZXJjZSksIE1pY3JvLmNhdGNoVGFnKFwiRmV0Y2hFcnJvclwiLCAoZSk9Pk1pY3JvLmZhaWwobmV3IFVwbG9hZFRoaW5nRXJyb3Ioe1xuICAgICAgICAgICAgICAgICAgICBjb2RlOiBcIklOVEVSTkFMX0NMSUVOVF9FUlJPUlwiLFxuICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiBgRmFpbGVkIHRvIHJlcG9ydCBldmVudCBcIiR7dHlwZX1cIiB0byBVcGxvYWRUaGluZyBzZXJ2ZXJgLFxuICAgICAgICAgICAgICAgICAgICBjYXVzZTogZVxuICAgICAgICAgICAgICAgIH0pKSksIE1pY3JvLmNhdGNoVGFnKFwiQmFkUmVxdWVzdEVycm9yXCIsIChlKT0+TWljcm8uZmFpbChuZXcgVXBsb2FkVGhpbmdFcnJvcih7XG4gICAgICAgICAgICAgICAgICAgIGNvZGU6IGdldEVycm9yVHlwZUZyb21TdGF0dXNDb2RlKGUuc3RhdHVzKSxcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogZS5nZXRNZXNzYWdlKCksXG4gICAgICAgICAgICAgICAgICAgIGNhdXNlOiBlLmpzb25cbiAgICAgICAgICAgICAgICB9KSkpLCBNaWNyby5jYXRjaFRhZyhcIkludmFsaWRKc29uXCIsIChlKT0+TWljcm8uZmFpbChuZXcgVXBsb2FkVGhpbmdFcnJvcih7XG4gICAgICAgICAgICAgICAgICAgIGNvZGU6IFwiSU5URVJOQUxfQ0xJRU5UX0VSUk9SXCIsXG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IFwiRmFpbGVkIHRvIHBhcnNlIHJlc3BvbnNlIGZyb20gVXBsb2FkVGhpbmcgc2VydmVyXCIsXG4gICAgICAgICAgICAgICAgICAgIGNhdXNlOiBlXG4gICAgICAgICAgICAgICAgfSkpKSk7XG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2U7XG4gICAgICAgIH0pO1xuXG5jb25zdCB1cGxvYWRXaXRoUHJvZ3Jlc3MgPSAoZmlsZSwgcmFuZ2VTdGFydCwgcHJlc2lnbmVkLCBvblVwbG9hZFByb2dyZXNzKT0+TWljcm8uYXN5bmMoKHJlc3VtZSk9PntcbiAgICAgICAgY29uc3QgeGhyID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XG4gICAgICAgIHhoci5vcGVuKFwiUFVUXCIsIHByZXNpZ25lZC51cmwsIHRydWUpO1xuICAgICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcihcIlJhbmdlXCIsIGBieXRlcz0ke3JhbmdlU3RhcnR9LWApO1xuICAgICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcihcIngtdXBsb2FkdGhpbmctdmVyc2lvblwiLCB2ZXJzaW9uJDEpO1xuICAgICAgICB4aHIucmVzcG9uc2VUeXBlID0gXCJqc29uXCI7XG4gICAgICAgIGxldCBwcmV2aW91c0xvYWRlZCA9IDA7XG4gICAgICAgIHhoci51cGxvYWQuYWRkRXZlbnRMaXN0ZW5lcihcInByb2dyZXNzXCIsICh7IGxvYWRlZCB9KT0+e1xuICAgICAgICAgICAgY29uc3QgZGVsdGEgPSBsb2FkZWQgLSBwcmV2aW91c0xvYWRlZDtcbiAgICAgICAgICAgIG9uVXBsb2FkUHJvZ3Jlc3M/Lih7XG4gICAgICAgICAgICAgICAgbG9hZGVkLFxuICAgICAgICAgICAgICAgIGRlbHRhXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHByZXZpb3VzTG9hZGVkID0gbG9hZGVkO1xuICAgICAgICB9KTtcbiAgICAgICAgeGhyLmFkZEV2ZW50TGlzdGVuZXIoXCJsb2FkXCIsICgpPT57XG4gICAgICAgICAgICByZXN1bWUoeGhyLnN0YXR1cyA+PSAyMDAgJiYgeGhyLnN0YXR1cyA8IDMwMCA/IE1pY3JvLnN1Y2NlZWQoeGhyLnJlc3BvbnNlKSA6IE1pY3JvLmRpZShgWEhSIGZhaWxlZCAke3hoci5zdGF0dXN9ICR7eGhyLnN0YXR1c1RleHR9IC0gJHtKU09OLnN0cmluZ2lmeSh4aHIucmVzcG9uc2UpfWApKTtcbiAgICAgICAgfSk7XG4gICAgICAgIC8vIElzIHRoZXJlIGEgY2FzZSB3aGVuIHRoZSBjbGllbnQgd291bGQgdGhyb3cgYW5kXG4gICAgICAgIC8vIGluZ2VzdCBzZXJ2ZXIgbm90IGtub3dpbmcgYWJvdXQgaXQ/IGlkdHM/XG4gICAgICAgIHhoci5hZGRFdmVudExpc3RlbmVyKFwiZXJyb3JcIiwgKCk9PntcbiAgICAgICAgICAgIHJlc3VtZShuZXcgVXBsb2FkVGhpbmdFcnJvcih7XG4gICAgICAgICAgICAgICAgY29kZTogXCJVUExPQURfRkFJTEVEXCJcbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKCk7XG4gICAgICAgIGZvcm1EYXRhLmFwcGVuZChcImZpbGVcIiwgZmlsZS5zbGljZShyYW5nZVN0YXJ0KSk7XG4gICAgICAgIHhoci5zZW5kKGZvcm1EYXRhKTtcbiAgICAgICAgcmV0dXJuIE1pY3JvLnN5bmMoKCk9Pnhoci5hYm9ydCgpKTtcbiAgICB9KTtcbmNvbnN0IHVwbG9hZEZpbGUgPSAoZmlsZSwgcHJlc2lnbmVkLCBvcHRzKT0+ZmV0Y2hFZmYocHJlc2lnbmVkLnVybCwge1xuICAgICAgICBtZXRob2Q6IFwiSEVBRFwiXG4gICAgfSkucGlwZShNaWNyby5tYXAoKHsgaGVhZGVycyB9KT0+cGFyc2VJbnQoaGVhZGVycy5nZXQoXCJ4LXV0LXJhbmdlLXN0YXJ0XCIpID8/IFwiMFwiLCAxMCkpLCBNaWNyby50YXAoKHN0YXJ0KT0+b3B0cy5vblVwbG9hZFByb2dyZXNzPy4oe1xuICAgICAgICAgICAgZGVsdGE6IHN0YXJ0LFxuICAgICAgICAgICAgbG9hZGVkOiBzdGFydFxuICAgICAgICB9KSksIE1pY3JvLmZsYXRNYXAoKHN0YXJ0KT0+dXBsb2FkV2l0aFByb2dyZXNzKGZpbGUsIHN0YXJ0LCBwcmVzaWduZWQsIChwcm9ncmVzc0V2ZW50KT0+b3B0cy5vblVwbG9hZFByb2dyZXNzPy4oe1xuICAgICAgICAgICAgICAgIGRlbHRhOiBwcm9ncmVzc0V2ZW50LmRlbHRhLFxuICAgICAgICAgICAgICAgIGxvYWRlZDogcHJvZ3Jlc3NFdmVudC5sb2FkZWQgKyBzdGFydFxuICAgICAgICAgICAgfSkpKSwgTWljcm8ubWFwKHVuc2FmZUNvZXJjZSksIE1pY3JvLm1hcCgodXBsb2FkUmVzcG9uc2UpPT4oe1xuICAgICAgICAgICAgbmFtZTogZmlsZS5uYW1lLFxuICAgICAgICAgICAgc2l6ZTogZmlsZS5zaXplLFxuICAgICAgICAgICAga2V5OiBwcmVzaWduZWQua2V5LFxuICAgICAgICAgICAgbGFzdE1vZGlmaWVkOiBmaWxlLmxhc3RNb2RpZmllZCxcbiAgICAgICAgICAgIHNlcnZlckRhdGE6IHVwbG9hZFJlc3BvbnNlLnNlcnZlckRhdGEsXG4gICAgICAgICAgICB1cmw6IHVwbG9hZFJlc3BvbnNlLnVybCxcbiAgICAgICAgICAgIGFwcFVybDogdXBsb2FkUmVzcG9uc2UuYXBwVXJsLFxuICAgICAgICAgICAgY3VzdG9tSWQ6IHByZXNpZ25lZC5jdXN0b21JZCxcbiAgICAgICAgICAgIHR5cGU6IGZpbGUudHlwZSxcbiAgICAgICAgICAgIGZpbGVIYXNoOiB1cGxvYWRSZXNwb25zZS5maWxlSGFzaFxuICAgICAgICB9KSkpO1xuY29uc3QgdXBsb2FkRmlsZXNJbnRlcm5hbCA9IChlbmRwb2ludCwgb3B0cyk9PntcbiAgICAvLyBjbGFzc2ljIHNlcnZpY2UgcmlnaHQgaGVyZVxuICAgIGNvbnN0IHJlcG9ydEV2ZW50VG9VVCA9IGNyZWF0ZVVUUmVwb3J0ZXIoe1xuICAgICAgICBlbmRwb2ludDogU3RyaW5nKGVuZHBvaW50KSxcbiAgICAgICAgcGFja2FnZTogb3B0cy5wYWNrYWdlLFxuICAgICAgICB1cmw6IG9wdHMudXJsLFxuICAgICAgICBoZWFkZXJzOiBvcHRzLmhlYWRlcnNcbiAgICB9KTtcbiAgICBjb25zdCB0b3RhbFNpemUgPSBvcHRzLmZpbGVzLnJlZHVjZSgoYWNjLCBmKT0+YWNjICsgZi5zaXplLCAwKTtcbiAgICBsZXQgdG90YWxMb2FkZWQgPSAwO1xuICAgIHJldHVybiByZXBvcnRFdmVudFRvVVQoXCJ1cGxvYWRcIiwge1xuICAgICAgICBpbnB1dDogXCJpbnB1dFwiIGluIG9wdHMgPyBvcHRzLmlucHV0IDogbnVsbCxcbiAgICAgICAgZmlsZXM6IG9wdHMuZmlsZXMubWFwKChmKT0+KHtcbiAgICAgICAgICAgICAgICBuYW1lOiBmLm5hbWUsXG4gICAgICAgICAgICAgICAgc2l6ZTogZi5zaXplLFxuICAgICAgICAgICAgICAgIHR5cGU6IGYudHlwZSxcbiAgICAgICAgICAgICAgICBsYXN0TW9kaWZpZWQ6IGYubGFzdE1vZGlmaWVkXG4gICAgICAgICAgICB9KSlcbiAgICB9KS5waXBlKE1pY3JvLmZsYXRNYXAoKHByZXNpZ25lZHMpPT5NaWNyby5mb3JFYWNoKHByZXNpZ25lZHMsIChwcmVzaWduZWQsIGkpPT5NaWNyby5mbGF0TWFwKE1pY3JvLnN5bmMoKCk9Pm9wdHMub25VcGxvYWRCZWdpbj8uKHtcbiAgICAgICAgICAgICAgICAgICAgZmlsZTogb3B0cy5maWxlc1tpXS5uYW1lXG4gICAgICAgICAgICAgICAgfSkpLCAoKT0+dXBsb2FkRmlsZShvcHRzLmZpbGVzW2ldLCBwcmVzaWduZWQsIHtcbiAgICAgICAgICAgICAgICAgICAgb25VcGxvYWRQcm9ncmVzczogKGV2KT0+e1xuICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxMb2FkZWQgKz0gZXYuZGVsdGE7XG4gICAgICAgICAgICAgICAgICAgICAgICBvcHRzLm9uVXBsb2FkUHJvZ3Jlc3M/Lih7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZTogb3B0cy5maWxlc1tpXSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9ncmVzczogTWF0aC5yb3VuZChldi5sb2FkZWQgLyBvcHRzLmZpbGVzW2ldLnNpemUgKiAxMDApLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvYWRlZDogZXYubG9hZGVkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlbHRhOiBldi5kZWx0YSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbExvYWRlZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbFByb2dyZXNzOiBNYXRoLnJvdW5kKHRvdGFsTG9hZGVkIC8gdG90YWxTaXplICogMTAwKVxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KSksIHtcbiAgICAgICAgICAgIGNvbmN1cnJlbmN5OiA2XG4gICAgICAgIH0pKSwgTWljcm8ucHJvdmlkZVNlcnZpY2UoRmV0Y2hDb250ZXh0LCB3aW5kb3cuZmV0Y2gpKTtcbn07XG5cbmNvbnN0IHZlcnNpb24gPSB2ZXJzaW9uJDE7XG4vKipcbiAqIFZhbGlkYXRlIHRoYXQgYSBmaWxlIGlzIG9mIGEgdmFsaWQgdHlwZSBnaXZlbiBhIHJvdXRlIGNvbmZpZ1xuICogQHB1YmxpY1xuICovIGNvbnN0IGlzVmFsaWRGaWxlVHlwZSA9IChmaWxlLCByb3V0ZUNvbmZpZyk9Pk1pY3JvLnJ1blN5bmMobWF0Y2hGaWxlVHlwZShmaWxlLCBvYmplY3RLZXlzKHJvdXRlQ29uZmlnKSkucGlwZShNaWNyby5tYXAoKHR5cGUpPT5maWxlLnR5cGUuaW5jbHVkZXModHlwZSkpLCBNaWNyby5vckVsc2VTdWNjZWVkKCgpPT5mYWxzZSkpKTtcbi8qKlxuICogVmFsaWRhdGUgdGhhdCBhIGZpbGUgaXMgb2YgYSB2YWxpZCBzaXplIGdpdmVuIGEgcm91dGUgY29uZmlnXG4gKiBAcHVibGljXG4gKi8gY29uc3QgaXNWYWxpZEZpbGVTaXplID0gKGZpbGUsIHJvdXRlQ29uZmlnKT0+TWljcm8ucnVuU3luYyhtYXRjaEZpbGVUeXBlKGZpbGUsIG9iamVjdEtleXMocm91dGVDb25maWcpKS5waXBlKE1pY3JvLmZsYXRNYXAoKHR5cGUpPT5maWxlU2l6ZVRvQnl0ZXMocm91dGVDb25maWdbdHlwZV0ubWF4RmlsZVNpemUpKSwgTWljcm8ubWFwKChtYXhGaWxlU2l6ZSk9PmZpbGUuc2l6ZSA8PSBtYXhGaWxlU2l6ZSksIE1pY3JvLm9yRWxzZVN1Y2NlZWQoKCk9PmZhbHNlKSkpO1xuLyoqXG4gKiBHZW5lcmF0ZSBhIHR5cGVkIHVwbG9hZGVyIGZvciBhIGdpdmVuIEZpbGVSb3V0ZXJcbiAqIEBwdWJsaWNcbiAqLyBjb25zdCBnZW5VcGxvYWRlciA9IChpbml0T3B0cyk9PntcbiAgICBjb25zdCByb3V0ZVJlZ2lzdHJ5ID0gY3JlYXRlSWRlbnRpdHlQcm94eSgpO1xuICAgIGNvbnN0IGNvbnRyb2xsYWJsZVVwbG9hZCA9IGFzeW5jIChzbHVnLCBvcHRzKT0+e1xuICAgICAgICBjb25zdCB1cGxvYWRzID0gbmV3IE1hcCgpO1xuICAgICAgICBjb25zdCBlbmRwb2ludCA9IHR5cGVvZiBzbHVnID09PSBcImZ1bmN0aW9uXCIgPyBzbHVnKHJvdXRlUmVnaXN0cnkpIDogc2x1ZztcbiAgICAgICAgY29uc3QgdXRSZXBvcnRlciA9IGNyZWF0ZVVUUmVwb3J0ZXIoe1xuICAgICAgICAgICAgZW5kcG9pbnQ6IFN0cmluZyhlbmRwb2ludCksXG4gICAgICAgICAgICBwYWNrYWdlOiBpbml0T3B0cy5wYWNrYWdlLFxuICAgICAgICAgICAgdXJsOiByZXNvbHZlTWF5YmVVcmxBcmcoaW5pdE9wdHM/LnVybCksXG4gICAgICAgICAgICBoZWFkZXJzOiBvcHRzLmhlYWRlcnNcbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IHByZXNpZ25lZHMgPSBhd2FpdCBNaWNyby5ydW5Qcm9taXNlKHV0UmVwb3J0ZXIoXCJ1cGxvYWRcIiwge1xuICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby11bnNhZmUtYXNzaWdubWVudFxuICAgICAgICAgICAgaW5wdXQ6IFwiaW5wdXRcIiBpbiBvcHRzID8gb3B0cy5pbnB1dCA6IG51bGwsXG4gICAgICAgICAgICBmaWxlczogb3B0cy5maWxlcy5tYXAoKGYpPT4oe1xuICAgICAgICAgICAgICAgICAgICBuYW1lOiBmLm5hbWUsXG4gICAgICAgICAgICAgICAgICAgIHNpemU6IGYuc2l6ZSxcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogZi50eXBlLFxuICAgICAgICAgICAgICAgICAgICBsYXN0TW9kaWZpZWQ6IGYubGFzdE1vZGlmaWVkXG4gICAgICAgICAgICAgICAgfSkpXG4gICAgICAgIH0pLnBpcGUoTWljcm8ucHJvdmlkZVNlcnZpY2UoRmV0Y2hDb250ZXh0LCB3aW5kb3cuZmV0Y2gpKSk7XG4gICAgICAgIGNvbnN0IHRvdGFsU2l6ZSA9IG9wdHMuZmlsZXMucmVkdWNlKChhY2MsIGYpPT5hY2MgKyBmLnNpemUsIDApO1xuICAgICAgICBsZXQgdG90YWxMb2FkZWQgPSAwO1xuICAgICAgICBjb25zdCB1cGxvYWRFZmZlY3QgPSAoZmlsZSwgcHJlc2lnbmVkKT0+dXBsb2FkRmlsZShmaWxlLCBwcmVzaWduZWQsIHtcbiAgICAgICAgICAgICAgICBvblVwbG9hZFByb2dyZXNzOiAocHJvZ3Jlc3NFdmVudCk9PntcbiAgICAgICAgICAgICAgICAgICAgdG90YWxMb2FkZWQgKz0gcHJvZ3Jlc3NFdmVudC5kZWx0YTtcbiAgICAgICAgICAgICAgICAgICAgb3B0cy5vblVwbG9hZFByb2dyZXNzPy4oe1xuICAgICAgICAgICAgICAgICAgICAgICAgLi4ucHJvZ3Jlc3NFdmVudCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpbGUsXG4gICAgICAgICAgICAgICAgICAgICAgICBwcm9ncmVzczogTWF0aC5yb3VuZChwcm9ncmVzc0V2ZW50LmxvYWRlZCAvIGZpbGUuc2l6ZSAqIDEwMCksXG4gICAgICAgICAgICAgICAgICAgICAgICB0b3RhbExvYWRlZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsUHJvZ3Jlc3M6IE1hdGgucm91bmQodG90YWxMb2FkZWQgLyB0b3RhbFNpemUgKiAxMDApXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pLnBpcGUoTWljcm8ucHJvdmlkZVNlcnZpY2UoRmV0Y2hDb250ZXh0LCB3aW5kb3cuZmV0Y2gpKTtcbiAgICAgICAgZm9yIChjb25zdCBbaSwgcF0gb2YgcHJlc2lnbmVkcy5lbnRyaWVzKCkpe1xuICAgICAgICAgICAgY29uc3QgZmlsZSA9IG9wdHMuZmlsZXNbaV07XG4gICAgICAgICAgICBjb25zdCBkZWZlcnJlZCA9IGNyZWF0ZURlZmVycmVkKCk7XG4gICAgICAgICAgICB1cGxvYWRzLnNldChmaWxlLCB7XG4gICAgICAgICAgICAgICAgZGVmZXJyZWQsXG4gICAgICAgICAgICAgICAgcHJlc2lnbmVkOiBwXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHZvaWQgTWljcm8ucnVuUHJvbWlzZUV4aXQodXBsb2FkRWZmZWN0KGZpbGUsIHApLCB7XG4gICAgICAgICAgICAgICAgc2lnbmFsOiBkZWZlcnJlZC5hYy5zaWduYWxcbiAgICAgICAgICAgIH0pLnRoZW4oKHJlc3VsdCk9PntcbiAgICAgICAgICAgICAgICBpZiAocmVzdWx0Ll90YWcgPT09IFwiUmlnaHRcIikge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucmVzb2x2ZShyZXN1bHQucmlnaHQpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzdWx0LmxlZnQuX3RhZyA9PT0gXCJJbnRlcnJ1cHRcIikge1xuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVXBsb2FkUGF1c2VkRXJyb3IoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhyb3cgTWljcm8uY2F1c2VTcXVhc2gocmVzdWx0LmxlZnQpO1xuICAgICAgICAgICAgfSkuY2F0Y2goKGVycik9PntcbiAgICAgICAgICAgICAgICBpZiAoZXJyIGluc3RhbmNlb2YgVXBsb2FkUGF1c2VkRXJyb3IpIHJldHVybjtcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZXJyKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIC8qKlxuICAgICAqIFBhdXNlIGFuIG9uZ29pbmcgdXBsb2FkXG4gICAgICogQHBhcmFtIGZpbGUgVGhlIGZpbGUgdXBsb2FkIHlvdSB3YW50IHRvIHBhdXNlLiBDYW4gYmUgb21pdHRlZCB0byBwYXVzZSBhbGwgZmlsZXNcbiAgICAgKi8gY29uc3QgcGF1c2VVcGxvYWQgPSAoZmlsZSk9PntcbiAgICAgICAgICAgIGNvbnN0IGZpbGVzID0gQXJyLmVuc3VyZShmaWxlID8/IG9wdHMuZmlsZXMpO1xuICAgICAgICAgICAgZm9yIChjb25zdCBmaWxlIG9mIGZpbGVzKXtcbiAgICAgICAgICAgICAgICBjb25zdCB1cGxvYWQgPSB1cGxvYWRzLmdldChmaWxlKTtcbiAgICAgICAgICAgICAgICBpZiAoIXVwbG9hZCkgcmV0dXJuO1xuICAgICAgICAgICAgICAgIGlmICh1cGxvYWQuZGVmZXJyZWQuYWMuc2lnbmFsLmFib3J0ZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gQ2FuY2VsIHRoZSB1cGxvYWQgaWYgaXQncyBhbHJlYWR5IGJlZW4gcGF1c2VkXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBVcGxvYWRBYm9ydGVkRXJyb3IoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdXBsb2FkLmRlZmVycmVkLmFjLmFib3J0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIC8qKlxuICAgICAqIFJlc3VtZSBhIHBhdXNlZCB1cGxvYWRcbiAgICAgKiBAcGFyYW0gZmlsZSBUaGUgZmlsZSB1cGxvYWQgeW91IHdhbnQgdG8gcmVzdW1lLiBDYW4gYmUgb21pdHRlZCB0byByZXN1bWUgYWxsIGZpbGVzXG4gICAgICovIGNvbnN0IHJlc3VtZVVwbG9hZCA9IChmaWxlKT0+e1xuICAgICAgICAgICAgY29uc3QgZmlsZXMgPSBBcnIuZW5zdXJlKGZpbGUgPz8gb3B0cy5maWxlcyk7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IGZpbGUgb2YgZmlsZXMpe1xuICAgICAgICAgICAgICAgIGNvbnN0IHVwbG9hZCA9IHVwbG9hZHMuZ2V0KGZpbGUpO1xuICAgICAgICAgICAgICAgIGlmICghdXBsb2FkKSB0aHJvdyBcIk5vIHVwbG9hZCBmb3VuZFwiO1xuICAgICAgICAgICAgICAgIHVwbG9hZC5kZWZlcnJlZC5hYyA9IG5ldyBBYm9ydENvbnRyb2xsZXIoKTtcbiAgICAgICAgICAgICAgICB2b2lkIE1pY3JvLnJ1blByb21pc2VFeGl0KHVwbG9hZEVmZmVjdChmaWxlLCB1cGxvYWQucHJlc2lnbmVkKSwge1xuICAgICAgICAgICAgICAgICAgICBzaWduYWw6IHVwbG9hZC5kZWZlcnJlZC5hYy5zaWduYWxcbiAgICAgICAgICAgICAgICB9KS50aGVuKChyZXN1bHQpPT57XG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuX3RhZyA9PT0gXCJSaWdodFwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdXBsb2FkLmRlZmVycmVkLnJlc29sdmUocmVzdWx0LnJpZ2h0KTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChyZXN1bHQubGVmdC5fdGFnID09PSBcIkludGVycnVwdFwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVXBsb2FkUGF1c2VkRXJyb3IoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBNaWNyby5jYXVzZVNxdWFzaChyZXN1bHQubGVmdCk7XG4gICAgICAgICAgICAgICAgfSkuY2F0Y2goKGVycik9PntcbiAgICAgICAgICAgICAgICAgICAgaWYgKGVyciBpbnN0YW5jZW9mIFVwbG9hZFBhdXNlZEVycm9yKSByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIHVwbG9hZC5kZWZlcnJlZC5yZWplY3QoZXJyKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgLyoqXG4gICAgICogV2FpdCBmb3IgYW4gdXBsb2FkIHRvIGNvbXBsZXRlXG4gICAgICogQHBhcmFtIGZpbGUgVGhlIGZpbGUgdXBsb2FkIHlvdSB3YW50IHRvIHdhaXQgZm9yLiBDYW4gYmUgb21pdHRlZCB0byB3YWl0IGZvciBhbGwgZmlsZXNcbiAgICAgKi8gY29uc3QgZG9uZSA9IGFzeW5jIChmaWxlKT0+e1xuICAgICAgICAgICAgY29uc3QgcHJvbWlzZXMgPSBbXTtcbiAgICAgICAgICAgIGNvbnN0IGZpbGVzID0gQXJyLmVuc3VyZShmaWxlID8/IG9wdHMuZmlsZXMpO1xuICAgICAgICAgICAgZm9yIChjb25zdCBmaWxlIG9mIGZpbGVzKXtcbiAgICAgICAgICAgICAgICBjb25zdCB1cGxvYWQgPSB1cGxvYWRzLmdldChmaWxlKTtcbiAgICAgICAgICAgICAgICBpZiAoIXVwbG9hZCkgdGhyb3cgXCJObyB1cGxvYWQgZm91bmRcIjtcbiAgICAgICAgICAgICAgICBwcm9taXNlcy5wdXNoKHVwbG9hZC5kZWZlcnJlZC5wcm9taXNlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdHMgPSBhd2FpdCBQcm9taXNlLmFsbChwcm9taXNlcyk7XG4gICAgICAgICAgICByZXR1cm4gZmlsZSA/IHJlc3VsdHNbMF0gOiByZXN1bHRzO1xuICAgICAgICB9O1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgcGF1c2VVcGxvYWQsXG4gICAgICAgICAgICByZXN1bWVVcGxvYWQsXG4gICAgICAgICAgICBkb25lXG4gICAgICAgIH07XG4gICAgfTtcbiAgICAvKipcbiAgICogT25lIHN0ZXAgdXBsb2FkIGZ1bmN0aW9uIHRoYXQgYm90aCByZXF1ZXN0cyBwcmVzaWduZWQgVVJMc1xuICAgKiBhbmQgdGhlbiB1cGxvYWRzIHRoZSBmaWxlcyB0byBVcGxvYWRUaGluZ1xuICAgKi8gY29uc3QgdHlwZWRVcGxvYWRGaWxlcyA9IChzbHVnLCBvcHRzKT0+e1xuICAgICAgICBjb25zdCBlbmRwb2ludCA9IHR5cGVvZiBzbHVnID09PSBcImZ1bmN0aW9uXCIgPyBzbHVnKHJvdXRlUmVnaXN0cnkpIDogc2x1ZztcbiAgICAgICAgcmV0dXJuIHVwbG9hZEZpbGVzSW50ZXJuYWwoZW5kcG9pbnQsIHtcbiAgICAgICAgICAgIC4uLm9wdHMsXG4gICAgICAgICAgICBza2lwUG9sbGluZzoge30sXG4gICAgICAgICAgICB1cmw6IHJlc29sdmVNYXliZVVybEFyZyhpbml0T3B0cz8udXJsKSxcbiAgICAgICAgICAgIHBhY2thZ2U6IGluaXRPcHRzLnBhY2thZ2UsXG4gICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLXVuc2FmZS1tZW1iZXItYWNjZXNzXG4gICAgICAgICAgICBpbnB1dDogb3B0cy5pbnB1dFxuICAgICAgICB9KS5waXBlKChlZmZlY3QpPT5NaWNyby5ydW5Qcm9taXNlRXhpdChlZmZlY3QsIG9wdHMuc2lnbmFsICYmIHtcbiAgICAgICAgICAgICAgICBzaWduYWw6IG9wdHMuc2lnbmFsXG4gICAgICAgICAgICB9KSkudGhlbigoZXhpdCk9PntcbiAgICAgICAgICAgIGlmIChleGl0Ll90YWcgPT09IFwiUmlnaHRcIikge1xuICAgICAgICAgICAgICAgIHJldHVybiBleGl0LnJpZ2h0O1xuICAgICAgICAgICAgfSBlbHNlIGlmIChleGl0LmxlZnQuX3RhZyA9PT0gXCJJbnRlcnJ1cHRcIikge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBVcGxvYWRBYm9ydGVkRXJyb3IoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRocm93IE1pY3JvLmNhdXNlU3F1YXNoKGV4aXQubGVmdCk7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgcmV0dXJuIHtcbiAgICAgICAgdXBsb2FkRmlsZXM6IHR5cGVkVXBsb2FkRmlsZXMsXG4gICAgICAgIGNyZWF0ZVVwbG9hZDogY29udHJvbGxhYmxlVXBsb2FkLFxuICAgICAgICAvKipcbiAgICAgKiBJZGVudGl0eSBvYmplY3QgdGhhdCBjYW4gYmUgdXNlZCBpbnN0ZWFkIG9mIHJhdyBzdHJpbmdzXG4gICAgICogdGhhdCBhbGxvd3MgXCJHbyB0byBkZWZpbml0aW9uXCIgaW4geW91ciBJREUgdG8gYnJpbmcgeW91XG4gICAgICogdG8gdGhlIGJhY2tlbmQgZGVmaW5pdGlvbiBvZiBhIHJvdXRlLlxuICAgICAqLyByb3V0ZVJlZ2lzdHJ5XG4gICAgfTtcbn07XG5cbmV4cG9ydCB7IGdlblVwbG9hZGVyLCBpc1ZhbGlkRmlsZVNpemUsIGlzVmFsaWRGaWxlVHlwZSwgdmVyc2lvbiB9O1xuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/uploadthing/client/index.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/uploadthing/internal/types.js":
/*!****************************************************!*\
  !*** ./node_modules/uploadthing/internal/types.js ***!
  \****************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   UTFiles: () => (/* binding */ UTFiles)\n/* harmony export */ });\n/**\n * Marker used to append a `customId` to the incoming file data in `.middleware()`\n * @example\n * ```ts\n * .middleware((opts) => {\n *   return {\n *     [UTFiles]: opts.files.map((file) => ({\n *       ...file,\n *       customId: generateId(),\n *     }))\n *   };\n * })\n * ```\n */ const UTFiles = Symbol(\"uploadthing-custom-id-symbol\");\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvdXBsb2FkdGhpbmcvaW50ZXJuYWwvdHlwZXMuanMiLCJtYXBwaW5ncyI6Ijs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBLElBQUk7QUFDSjtBQUNBOztBQUVtQiIsInNvdXJjZXMiOlsid2VicGFjazovL215LWFwcC8uL25vZGVfbW9kdWxlcy91cGxvYWR0aGluZy9pbnRlcm5hbC90eXBlcy5qcz8xYTk1Il0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogTWFya2VyIHVzZWQgdG8gYXBwZW5kIGEgYGN1c3RvbUlkYCB0byB0aGUgaW5jb21pbmcgZmlsZSBkYXRhIGluIGAubWlkZGxld2FyZSgpYFxuICogQGV4YW1wbGVcbiAqIGBgYHRzXG4gKiAubWlkZGxld2FyZSgob3B0cykgPT4ge1xuICogICByZXR1cm4ge1xuICogICAgIFtVVEZpbGVzXTogb3B0cy5maWxlcy5tYXAoKGZpbGUpID0+ICh7XG4gKiAgICAgICAuLi5maWxlLFxuICogICAgICAgY3VzdG9tSWQ6IGdlbmVyYXRlSWQoKSxcbiAqICAgICB9KSlcbiAqICAgfTtcbiAqIH0pXG4gKiBgYGBcbiAqLyBjb25zdCBVVEZpbGVzID0gU3ltYm9sKFwidXBsb2FkdGhpbmctY3VzdG9tLWlkLXN5bWJvbFwiKTtcblxuZXhwb3J0IHsgVVRGaWxlcyB9O1xuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/uploadthing/internal/types.js\n");

/***/ }),

/***/ "(rsc)/./node_modules/uploadthing/next/index.js":
/*!************************************************!*\
  !*** ./node_modules/uploadthing/next/index.js ***!
  \************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   UTFiles: () => (/* reexport safe */ _internal_types_js__WEBPACK_IMPORTED_MODULE_0__.UTFiles),\n/* harmony export */   createRouteHandler: () => (/* binding */ createRouteHandler),\n/* harmony export */   createUploadthing: () => (/* binding */ createUploadthing)\n/* harmony export */ });\n/* harmony import */ var effect_Effect__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! effect/Effect */ \"(rsc)/./node_modules/effect/dist/esm/Effect.js\");\n/* harmony import */ var _effect_platform__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! @effect/platform */ \"(rsc)/./node_modules/@effect/platform/dist/esm/FetchHttpClient.js\");\n/* harmony import */ var _effect_platform__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! @effect/platform */ \"(rsc)/./node_modules/@effect/platform/dist/esm/Headers.js\");\n/* harmony import */ var _effect_platform__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! @effect/platform */ \"(rsc)/./node_modules/@effect/platform/dist/esm/HttpApp.js\");\n/* harmony import */ var _effect_platform__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! @effect/platform */ \"(rsc)/./node_modules/@effect/platform/dist/esm/HttpServerResponse.js\");\n/* harmony import */ var _effect_platform__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! @effect/platform */ \"(rsc)/./node_modules/@effect/platform/dist/esm/HttpServerRequest.js\");\n/* harmony import */ var _effect_platform__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! @effect/platform */ \"(rsc)/./node_modules/@effect/platform/dist/esm/HttpRouter.js\");\n/* harmony import */ var _effect_platform__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! @effect/platform */ \"(rsc)/./node_modules/@effect/platform/dist/esm/HttpClient.js\");\n/* harmony import */ var _effect_platform__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! @effect/platform */ \"(rsc)/./node_modules/@effect/platform/dist/esm/HttpClientRequest.js\");\n/* harmony import */ var _effect_platform__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! @effect/platform */ \"(rsc)/./node_modules/@effect/platform/dist/esm/HttpIncomingMessage.js\");\n/* harmony import */ var _effect_platform__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! @effect/platform */ \"(rsc)/./node_modules/@effect/platform/dist/esm/HttpClientResponse.js\");\n/* harmony import */ var _effect_platform__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! @effect/platform */ \"(rsc)/./node_modules/@effect/platform/dist/esm/HttpBody.js\");\n/* harmony import */ var effect_Config__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! effect/Config */ \"(rsc)/./node_modules/effect/dist/esm/Config.js\");\n/* harmony import */ var effect_Context__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! effect/Context */ \"(rsc)/./node_modules/effect/dist/esm/Context.js\");\n/* harmony import */ var effect_Match__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! effect/Match */ \"(rsc)/./node_modules/effect/dist/esm/Match.js\");\n/* harmony import */ var effect_Redacted__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! effect/Redacted */ \"(rsc)/./node_modules/effect/dist/esm/Redacted.js\");\n/* harmony import */ var effect_Schema__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! effect/Schema */ \"(rsc)/./node_modules/effect/dist/esm/Schema.js\");\n/* harmony import */ var _uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @uploadthing/shared */ \"(rsc)/./node_modules/@uploadthing/shared/dist/index.js\");\n/* harmony import */ var effect_ConfigProvider__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! effect/ConfigProvider */ \"(rsc)/./node_modules/effect/dist/esm/ConfigProvider.js\");\n/* harmony import */ var effect_Stream__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! effect/Stream */ \"(rsc)/./node_modules/effect/dist/esm/Stream.js\");\n/* harmony import */ var effect_Layer__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! effect/Layer */ \"(rsc)/./node_modules/effect/dist/esm/Layer.js\");\n/* harmony import */ var effect_Logger__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! effect/Logger */ \"(rsc)/./node_modules/effect/dist/esm/Logger.js\");\n/* harmony import */ var effect_LogLevel__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! effect/LogLevel */ \"(rsc)/./node_modules/effect/dist/esm/LogLevel.js\");\n/* harmony import */ var effect_Data__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! effect/Data */ \"(rsc)/./node_modules/effect/dist/esm/Data.js\");\n/* harmony import */ var effect_FiberRef__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! effect/FiberRef */ \"(rsc)/./node_modules/effect/dist/esm/FiberRef.js\");\n/* harmony import */ var effect_ManagedRuntime__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! effect/ManagedRuntime */ \"(rsc)/./node_modules/effect/dist/esm/ManagedRuntime.js\");\n/* harmony import */ var _internal_types_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../internal/types.js */ \"(rsc)/./node_modules/uploadthing/internal/types.js\");\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nvar version = \"7.2.0\";\n\neffect_Schema__WEBPACK_IMPORTED_MODULE_1__.Literal(..._uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.ValidContentDispositions);\neffect_Schema__WEBPACK_IMPORTED_MODULE_1__.Literal(..._uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.ValidACLs);\n/**\n * Valid options for the `?actionType` query param\n */ const ActionType = effect_Schema__WEBPACK_IMPORTED_MODULE_1__.Literal(\"upload\");\n/**\n * Valid options for the `uploadthing-hook` header\n * for requests coming from UT server\n */ const UploadThingHook = effect_Schema__WEBPACK_IMPORTED_MODULE_1__.Literal(\"callback\", \"error\");\n/**\n * =============================================================================\n * =========================== Configuration ===================================\n * =============================================================================\n */ const DecodeString = effect_Schema__WEBPACK_IMPORTED_MODULE_1__.transform(effect_Schema__WEBPACK_IMPORTED_MODULE_1__.Uint8ArrayFromSelf, effect_Schema__WEBPACK_IMPORTED_MODULE_1__.String, {\n    decode: (data)=>new TextDecoder().decode(data),\n    encode: (data)=>new TextEncoder().encode(data)\n});\nconst ParsedToken = effect_Schema__WEBPACK_IMPORTED_MODULE_1__.Struct({\n    apiKey: effect_Schema__WEBPACK_IMPORTED_MODULE_1__.Redacted(effect_Schema__WEBPACK_IMPORTED_MODULE_1__.String.pipe(effect_Schema__WEBPACK_IMPORTED_MODULE_1__.startsWith(\"sk_\"))),\n    appId: effect_Schema__WEBPACK_IMPORTED_MODULE_1__.String,\n    regions: effect_Schema__WEBPACK_IMPORTED_MODULE_1__.NonEmptyArray(effect_Schema__WEBPACK_IMPORTED_MODULE_1__.String),\n    ingestHost: effect_Schema__WEBPACK_IMPORTED_MODULE_1__.String.pipe(effect_Schema__WEBPACK_IMPORTED_MODULE_1__.optionalWith({\n        default: ()=>\"ingest.uploadthing.com\"\n    }))\n});\nconst UploadThingToken = effect_Schema__WEBPACK_IMPORTED_MODULE_1__.Uint8ArrayFromBase64.pipe(effect_Schema__WEBPACK_IMPORTED_MODULE_1__.compose(DecodeString), effect_Schema__WEBPACK_IMPORTED_MODULE_1__.compose(effect_Schema__WEBPACK_IMPORTED_MODULE_1__.parseJson(ParsedToken)));\n/**\n * =============================================================================\n * ======================== File Type Hierarchy ===============================\n * =============================================================================\n */ /**\n * Properties from the web File object, this is what the client sends when initiating an upload\n */ class FileUploadData extends effect_Schema__WEBPACK_IMPORTED_MODULE_1__.Class(\"FileUploadData\")({\n    name: effect_Schema__WEBPACK_IMPORTED_MODULE_1__.String,\n    size: effect_Schema__WEBPACK_IMPORTED_MODULE_1__.Number,\n    type: effect_Schema__WEBPACK_IMPORTED_MODULE_1__.String,\n    lastModified: effect_Schema__WEBPACK_IMPORTED_MODULE_1__.Number.pipe(effect_Schema__WEBPACK_IMPORTED_MODULE_1__.optional)\n}) {\n}\n/**\n * `.middleware()` can add a customId to the incoming file data\n */ class FileUploadDataWithCustomId extends FileUploadData.extend(\"FileUploadDataWithCustomId\")({\n    customId: effect_Schema__WEBPACK_IMPORTED_MODULE_1__.NullOr(effect_Schema__WEBPACK_IMPORTED_MODULE_1__.String)\n}) {\n}\n/**\n * When files are uploaded, we get back\n * - a key\n * - a direct URL for the file\n * - an app-specific URL for the file (useful for scoping eg. for optimization allowed origins)\n * - the hash (md5-hex) of the uploaded file's contents\n */ class UploadedFileData extends FileUploadDataWithCustomId.extend(\"UploadedFileData\")({\n    key: effect_Schema__WEBPACK_IMPORTED_MODULE_1__.String,\n    url: effect_Schema__WEBPACK_IMPORTED_MODULE_1__.String,\n    appUrl: effect_Schema__WEBPACK_IMPORTED_MODULE_1__.String,\n    fileHash: effect_Schema__WEBPACK_IMPORTED_MODULE_1__.String\n}) {\n}\n/**\n * =============================================================================\n * ======================== Server Response Schemas ============================\n * =============================================================================\n */ class NewPresignedUrl extends effect_Schema__WEBPACK_IMPORTED_MODULE_1__.Class(\"NewPresignedUrl\")({\n    url: effect_Schema__WEBPACK_IMPORTED_MODULE_1__.String,\n    key: effect_Schema__WEBPACK_IMPORTED_MODULE_1__.String,\n    customId: effect_Schema__WEBPACK_IMPORTED_MODULE_1__.NullOr(effect_Schema__WEBPACK_IMPORTED_MODULE_1__.String),\n    name: effect_Schema__WEBPACK_IMPORTED_MODULE_1__.String\n}) {\n}\nclass MetadataFetchStreamPart extends effect_Schema__WEBPACK_IMPORTED_MODULE_1__.Class(\"MetadataFetchStreamPart\")({\n    payload: effect_Schema__WEBPACK_IMPORTED_MODULE_1__.String,\n    signature: effect_Schema__WEBPACK_IMPORTED_MODULE_1__.String,\n    hook: UploadThingHook\n}) {\n}\nclass MetadataFetchResponse extends effect_Schema__WEBPACK_IMPORTED_MODULE_1__.Class(\"MetadataFetchResponse\")({\n    ok: effect_Schema__WEBPACK_IMPORTED_MODULE_1__.Boolean\n}) {\n}\nclass CallbackResultResponse extends effect_Schema__WEBPACK_IMPORTED_MODULE_1__.Class(\"CallbackResultResponse\")({\n    ok: effect_Schema__WEBPACK_IMPORTED_MODULE_1__.Boolean\n}) {\n}\n/**\n * =============================================================================\n * ======================== Client Action Payloads ============================\n * =============================================================================\n */ class UploadActionPayload extends effect_Schema__WEBPACK_IMPORTED_MODULE_1__.Class(\"UploadActionPayload\")({\n    files: effect_Schema__WEBPACK_IMPORTED_MODULE_1__.Array(FileUploadData),\n    input: effect_Schema__WEBPACK_IMPORTED_MODULE_1__.Unknown\n}) {\n}\n\n/**\n * Merge in `import.meta.env` to the built-in `process.env` provider\n * Prefix keys with `UPLOADTHING_` so we can reference just the name.\n * @example\n * process.env.UPLOADTHING_TOKEN = \"foo\"\n * Config.string(\"token\"); // Config<\"foo\">\n */ const envProvider = effect_ConfigProvider__WEBPACK_IMPORTED_MODULE_3__.fromEnv().pipe(effect_ConfigProvider__WEBPACK_IMPORTED_MODULE_3__.orElse(()=>effect_ConfigProvider__WEBPACK_IMPORTED_MODULE_3__.fromMap(new Map(Object.entries((0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.filterDefinedObjectValues)(// fuck this I give up. import.meta is a mistake, someone else can fix it\n     null ?? {}))), {\n        pathDelim: \"_\"\n    })), effect_ConfigProvider__WEBPACK_IMPORTED_MODULE_3__.nested(\"uploadthing\"), effect_ConfigProvider__WEBPACK_IMPORTED_MODULE_3__.constantCase);\n/**\n * Config provider that merges the options from the object\n * and environment variables prefixed with `UPLOADTHING_`.\n * @remarks Options take precedence over environment variables.\n */ const configProvider = (options)=>effect_ConfigProvider__WEBPACK_IMPORTED_MODULE_3__.fromJson(options ?? {}).pipe(effect_ConfigProvider__WEBPACK_IMPORTED_MODULE_3__.orElse(()=>envProvider));\nconst IsDevelopment = effect_Config__WEBPACK_IMPORTED_MODULE_4__.boolean(\"isDev\").pipe(effect_Config__WEBPACK_IMPORTED_MODULE_4__.orElse(()=>effect_Config__WEBPACK_IMPORTED_MODULE_4__.succeed(typeof process !== \"undefined\" ? \"development\" : undefined).pipe(effect_Config__WEBPACK_IMPORTED_MODULE_4__.map((_)=>_ === \"development\"))), effect_Config__WEBPACK_IMPORTED_MODULE_4__.withDefault(false));\nconst UTToken = effect_Schema__WEBPACK_IMPORTED_MODULE_1__.Config(\"token\", UploadThingToken).pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.catchTags({\n    ConfigError: (e)=>new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.UploadThingError({\n            code: e._op === \"InvalidData\" ? \"INVALID_SERVER_CONFIG\" : \"MISSING_ENV\",\n            message: e._op === \"InvalidData\" ? \"Invalid token. A token is a base64 encoded JSON object matching { apiKey: string, appId: string, regions: string[] }.\" : \"Missing token. Please set the `UPLOADTHING_TOKEN` environment variable or provide a token manually through config.\",\n            cause: e\n        })\n}));\neffect_Config__WEBPACK_IMPORTED_MODULE_4__.string(\"apiUrl\").pipe(effect_Config__WEBPACK_IMPORTED_MODULE_4__.withDefault(\"https://api.uploadthing.com\"), effect_Config__WEBPACK_IMPORTED_MODULE_4__.mapAttempt((_)=>new URL(_)), effect_Config__WEBPACK_IMPORTED_MODULE_4__.map((url)=>url.href.replace(/\\/$/, \"\")));\nconst IngestUrl = effect_Effect__WEBPACK_IMPORTED_MODULE_5__.gen(function*() {\n    const { regions, ingestHost } = yield* UTToken;\n    const region = regions[0]; // Currently only support 1 region per app\n    return yield* effect_Config__WEBPACK_IMPORTED_MODULE_4__.string(\"ingestUrl\").pipe(effect_Config__WEBPACK_IMPORTED_MODULE_4__.withDefault(`https://${region}.${ingestHost}`), effect_Config__WEBPACK_IMPORTED_MODULE_4__.mapAttempt((_)=>new URL(_)), effect_Config__WEBPACK_IMPORTED_MODULE_4__.map((url)=>url.href.replace(/\\/$/, \"\")));\n});\n\nfunction defaultErrorFormatter(error) {\n    return {\n        message: error.message\n    };\n}\nfunction formatError(error, router) {\n    const errorFormatter = router[Object.keys(router)[0]]?._def.errorFormatter ?? defaultErrorFormatter;\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n    return errorFormatter(error);\n}\n\nconst handleJsonLineStream = (schema, onChunk)=>(stream)=>{\n        let buf = \"\";\n        return stream.pipe(effect_Stream__WEBPACK_IMPORTED_MODULE_6__.decodeText(), effect_Stream__WEBPACK_IMPORTED_MODULE_6__.mapEffect((chunk)=>effect_Effect__WEBPACK_IMPORTED_MODULE_5__.gen(function*() {\n                buf += chunk;\n                // Scan buffer for newlines\n                const parts = buf.split(\"\\n\");\n                const validChunks = [];\n                for (const part of parts){\n                    try {\n                        // Attempt to parse chunk as JSON\n                        validChunks.push(JSON.parse(part));\n                        // Advance buffer if parsing succeeded\n                        buf = buf.slice(part.length + 1);\n                    } catch  {\n                    //\n                    }\n                }\n                yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logDebug(\"Received chunks\").pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.annotateLogs(\"chunk\", chunk), effect_Effect__WEBPACK_IMPORTED_MODULE_5__.annotateLogs(\"parsedChunks\", validChunks), effect_Effect__WEBPACK_IMPORTED_MODULE_5__.annotateLogs(\"buf\", buf));\n                return validChunks;\n            })), effect_Stream__WEBPACK_IMPORTED_MODULE_6__.mapEffect(effect_Schema__WEBPACK_IMPORTED_MODULE_1__.decodeUnknown(effect_Schema__WEBPACK_IMPORTED_MODULE_1__.Array(schema))), effect_Stream__WEBPACK_IMPORTED_MODULE_6__.mapEffect(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.forEach((part)=>onChunk(part))), effect_Stream__WEBPACK_IMPORTED_MODULE_6__.runDrain, effect_Effect__WEBPACK_IMPORTED_MODULE_5__.withLogSpan(\"handleJsonLineStream\"));\n    };\n\nconst withMinimalLogLevel = effect_Config__WEBPACK_IMPORTED_MODULE_4__.logLevel(\"logLevel\").pipe(effect_Config__WEBPACK_IMPORTED_MODULE_4__.withDefault(effect_LogLevel__WEBPACK_IMPORTED_MODULE_7__.Info), effect_Effect__WEBPACK_IMPORTED_MODULE_5__.andThen((level)=>effect_Logger__WEBPACK_IMPORTED_MODULE_8__.minimumLogLevel(level)), effect_Effect__WEBPACK_IMPORTED_MODULE_5__.tapError((e)=>effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logError(\"Invalid log level\").pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.annotateLogs(\"error\", e))), effect_Effect__WEBPACK_IMPORTED_MODULE_5__.catchTag(\"ConfigError\", (e)=>new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.UploadThingError({\n        code: \"INVALID_SERVER_CONFIG\",\n        message: \"Invalid server configuration\",\n        cause: e\n    })), effect_Layer__WEBPACK_IMPORTED_MODULE_9__.unwrapEffect);\nconst LogFormat = effect_Config__WEBPACK_IMPORTED_MODULE_4__.literal(\"json\", \"logFmt\", \"structured\", \"pretty\")(\"logFormat\");\nconst withLogFormat = effect_Effect__WEBPACK_IMPORTED_MODULE_5__.gen(function*() {\n    const isDev = yield* IsDevelopment;\n    const logFormat = yield* LogFormat.pipe(effect_Config__WEBPACK_IMPORTED_MODULE_4__.withDefault(isDev ? \"pretty\" : \"json\"));\n    return effect_Logger__WEBPACK_IMPORTED_MODULE_8__[logFormat];\n}).pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.catchTag(\"ConfigError\", (e)=>new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.UploadThingError({\n        code: \"INVALID_SERVER_CONFIG\",\n        message: \"Invalid server configuration\",\n        cause: e\n    })), effect_Layer__WEBPACK_IMPORTED_MODULE_9__.unwrapEffect);\nconst logHttpClientResponse = (message, opts)=>{\n    const mixin = opts?.mixin ?? \"json\";\n    const level = effect_LogLevel__WEBPACK_IMPORTED_MODULE_7__.fromLiteral(opts?.level ?? \"Debug\");\n    return (response)=>effect_Effect__WEBPACK_IMPORTED_MODULE_5__.flatMap(mixin !== \"None\" ? response[mixin] : effect_Effect__WEBPACK_IMPORTED_MODULE_5__[\"void\"], ()=>effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logWithLevel(level, `${message} (${response.status})`).pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.annotateLogs(\"response\", response)));\n};\nconst logHttpClientError = (message)=>(err)=>err._tag === \"ResponseError\" ? logHttpClientResponse(message, {\n            level: \"Error\"\n        })(err.response) : effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logError(message).pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.annotateLogs(\"error\", err));\n\nfunction getParseFn(parser) {\n    if (typeof parser.parse === \"function\") {\n        return parser.parse;\n    }\n    throw new Error(\"Invalid parser\");\n}\n\nclass FileSizeMismatch extends effect_Data__WEBPACK_IMPORTED_MODULE_10__.Error {\n    constructor(type, max, actual){\n        const reason = `You uploaded a ${type} file that was ${(0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.bytesToFileSize)(actual)}, but the limit for that type is ${max}`;\n        super({\n            reason\n        });\n        this._tag = \"FileSizeMismatch\";\n        this.name = \"FileSizeMismatchError\";\n    }\n}\nclass FileCountMismatch extends effect_Data__WEBPACK_IMPORTED_MODULE_10__.Error {\n    constructor(type, boundtype, bound, actual){\n        const reason = `You uploaded ${actual} file(s) of type '${type}', but the ${boundtype} for that type is ${bound}`;\n        super({\n            reason\n        });\n        this._tag = \"FileCountMismatch\";\n        this.name = \"FileCountMismatchError\";\n    }\n}\n// Verify that the uploaded files doesn't violate the route config,\n// e.g. uploading more videos than allowed, or a file that is larger than allowed.\n// This is double-checked on infra side, but we want to fail early to avoid network latency.\nconst assertFilesMeetConfig = (files, routeConfig)=>effect_Effect__WEBPACK_IMPORTED_MODULE_5__.gen(function*() {\n        const counts = {};\n        for (const file of files){\n            const type = yield* (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.matchFileType)(file, (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.objectKeys)(routeConfig));\n            counts[type] = (counts[type] ?? 0) + 1;\n            const sizeLimit = routeConfig[type]?.maxFileSize;\n            if (!sizeLimit) {\n                return yield* new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.InvalidRouteConfigError(type, \"maxFileSize\");\n            }\n            const sizeLimitBytes = yield* (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.fileSizeToBytes)(sizeLimit);\n            if (file.size > sizeLimitBytes) {\n                return yield* new FileSizeMismatch(type, sizeLimit, file.size);\n            }\n        }\n        for(const _key in counts){\n            const key = _key;\n            const config = routeConfig[key];\n            if (!config) return yield* new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.InvalidRouteConfigError(key);\n            const count = counts[key];\n            const min = config.minFileCount;\n            const max = config.maxFileCount;\n            if (min > max) {\n                return yield* new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.UploadThingError({\n                    code: \"BAD_REQUEST\",\n                    message: \"Invalid config during file count - minFileCount > maxFileCount\",\n                    cause: `minFileCount must be less than maxFileCount for key ${key}. got: ${min} > ${max}`\n                });\n            }\n            if (count < min) {\n                return yield* new FileCountMismatch(key, \"minimum\", min, count);\n            }\n            if (count > max) {\n                return yield* new FileCountMismatch(key, \"maximum\", max, count);\n            }\n        }\n        return null;\n    });\nconst extractRouterConfig = (router)=>effect_Effect__WEBPACK_IMPORTED_MODULE_5__.forEach((0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.objectKeys)(router), (slug)=>effect_Effect__WEBPACK_IMPORTED_MODULE_5__.map((0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.fillInputRouteConfig)(router[slug]._def.routerConfig), (config)=>({\n                slug,\n                config\n            })));\n\nconst makeRuntime = (fetch, config)=>{\n    const fetchHttpClient = effect_Layer__WEBPACK_IMPORTED_MODULE_9__.provideMerge(_effect_platform__WEBPACK_IMPORTED_MODULE_11__.layer, effect_Layer__WEBPACK_IMPORTED_MODULE_9__.succeed(_effect_platform__WEBPACK_IMPORTED_MODULE_11__.Fetch, fetch));\n    const withRedactedHeaders = effect_Layer__WEBPACK_IMPORTED_MODULE_9__.effectDiscard(effect_FiberRef__WEBPACK_IMPORTED_MODULE_12__.update(_effect_platform__WEBPACK_IMPORTED_MODULE_13__.currentRedactedNames, (_)=>_.concat([\n            \"x-uploadthing-api-key\"\n        ])));\n    const layer = effect_Layer__WEBPACK_IMPORTED_MODULE_9__.provide(effect_Layer__WEBPACK_IMPORTED_MODULE_9__.mergeAll(withLogFormat, withMinimalLogLevel, fetchHttpClient, withRedactedHeaders), effect_Layer__WEBPACK_IMPORTED_MODULE_9__.setConfigProvider(configProvider(config)));\n    return effect_ManagedRuntime__WEBPACK_IMPORTED_MODULE_14__.make(layer);\n};\n\nclass MiddlewareArguments extends effect_Context__WEBPACK_IMPORTED_MODULE_15__.Tag(\"uploadthing/MiddlewareArguments\")() {\n}\nconst makeAdapterHandler = (makeMiddlewareArgs, toRequest, opts, beAdapter)=>{\n    const managed = makeRuntime(opts.config?.fetch, opts.config);\n    const handle = effect_Effect__WEBPACK_IMPORTED_MODULE_5__.promise(()=>managed.runtime().then(_effect_platform__WEBPACK_IMPORTED_MODULE_16__.toWebHandlerRuntime));\n    const app = (...args)=>effect_Effect__WEBPACK_IMPORTED_MODULE_5__.map(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.promise(()=>managed.runPromise(createRequestHandler(opts, beAdapter))), effect_Effect__WEBPACK_IMPORTED_MODULE_5__.provideServiceEffect(MiddlewareArguments, makeMiddlewareArgs(...args)));\n    return async (...args)=>{\n        const result = await handle.pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.ap(app(...args)), effect_Effect__WEBPACK_IMPORTED_MODULE_5__.ap(toRequest(...args)), effect_Effect__WEBPACK_IMPORTED_MODULE_5__.withLogSpan(\"requestHandler\"), managed.runPromise);\n        return result;\n    };\n};\nconst createRequestHandler = (opts, beAdapter)=>effect_Effect__WEBPACK_IMPORTED_MODULE_5__.gen(function*() {\n        const isDevelopment = yield* IsDevelopment;\n        const routerConfig = yield* extractRouterConfig(opts.router);\n        const handleDaemon = (()=>{\n            if (opts.config?.handleDaemonPromise) {\n                return opts.config.handleDaemonPromise;\n            }\n            return isDevelopment ? \"void\" : \"await\";\n        })();\n        if (isDevelopment && handleDaemon === \"await\") {\n            return yield* new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.UploadThingError({\n                code: \"INVALID_SERVER_CONFIG\",\n                message: 'handleDaemonPromise: \"await\" is forbidden in development.'\n            });\n        }\n        const GET = effect_Effect__WEBPACK_IMPORTED_MODULE_5__.gen(function*() {\n            return yield* _effect_platform__WEBPACK_IMPORTED_MODULE_17__.json(routerConfig);\n        });\n        const POST = effect_Effect__WEBPACK_IMPORTED_MODULE_5__.gen(function*() {\n            const { \"uploadthing-hook\": uploadthingHook, \"x-uploadthing-package\": fePackage, \"x-uploadthing-version\": clientVersion } = yield* _effect_platform__WEBPACK_IMPORTED_MODULE_18__.schemaHeaders(effect_Schema__WEBPACK_IMPORTED_MODULE_1__.Struct({\n                \"uploadthing-hook\": UploadThingHook.pipe(effect_Schema__WEBPACK_IMPORTED_MODULE_1__.optional),\n                \"x-uploadthing-package\": effect_Schema__WEBPACK_IMPORTED_MODULE_1__.String.pipe(effect_Schema__WEBPACK_IMPORTED_MODULE_1__.optionalWith({\n                    default: ()=>\"unknown\"\n                })),\n                \"x-uploadthing-version\": effect_Schema__WEBPACK_IMPORTED_MODULE_1__.String.pipe(effect_Schema__WEBPACK_IMPORTED_MODULE_1__.optionalWith({\n                    default: ()=>version\n                }))\n            }));\n            if (clientVersion !== version) {\n                const serverVersion = version;\n                yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logWarning(\"Client version mismatch. Things may not work as expected, please sync your versions to ensure compatibility.\").pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.annotateLogs({\n                    clientVersion,\n                    serverVersion\n                }));\n            }\n            const { slug, actionType } = yield* _effect_platform__WEBPACK_IMPORTED_MODULE_19__.schemaParams(effect_Schema__WEBPACK_IMPORTED_MODULE_1__.Struct({\n                actionType: ActionType.pipe(effect_Schema__WEBPACK_IMPORTED_MODULE_1__.optional),\n                slug: effect_Schema__WEBPACK_IMPORTED_MODULE_1__.String\n            }));\n            const uploadable = opts.router[slug];\n            if (!uploadable) {\n                const msg = `No file route found for slug ${slug}`;\n                yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logError(msg);\n                return yield* new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.UploadThingError({\n                    code: \"NOT_FOUND\",\n                    message: msg\n                });\n            }\n            const { body, fiber } = yield* effect_Match__WEBPACK_IMPORTED_MODULE_20__.value({\n                actionType,\n                uploadthingHook\n            }).pipe(effect_Match__WEBPACK_IMPORTED_MODULE_20__.when({\n                actionType: \"upload\",\n                uploadthingHook: undefined\n            }, ()=>handleUploadAction({\n                    uploadable,\n                    fePackage,\n                    beAdapter,\n                    slug\n                })), effect_Match__WEBPACK_IMPORTED_MODULE_20__.when({\n                actionType: undefined,\n                uploadthingHook: \"callback\"\n            }, ()=>handleCallbackRequest({\n                    uploadable,\n                    fePackage,\n                    beAdapter\n                })), effect_Match__WEBPACK_IMPORTED_MODULE_20__.when({\n                actionType: undefined,\n                uploadthingHook: \"error\"\n            }, ()=>handleErrorRequest({\n                    uploadable\n                })), effect_Match__WEBPACK_IMPORTED_MODULE_20__.orElse(()=>effect_Effect__WEBPACK_IMPORTED_MODULE_5__.succeed({\n                    body: null,\n                    fiber: null\n                })));\n            if (fiber) {\n                yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logDebug(\"Running fiber as daemon\").pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.annotateLogs(\"handleDaemon\", handleDaemon));\n                if (handleDaemon === \"void\") ; else if (handleDaemon === \"await\") {\n                    yield* fiber.await;\n                } else if (typeof handleDaemon === \"function\") {\n                    handleDaemon(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.runPromise(fiber.await));\n                }\n            }\n            yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logDebug(\"Sending response\").pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.annotateLogs(\"body\", body));\n            return yield* _effect_platform__WEBPACK_IMPORTED_MODULE_17__.json(body);\n        }).pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.catchTags({\n            ParseError: (e)=>_effect_platform__WEBPACK_IMPORTED_MODULE_17__.json(formatError(new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.UploadThingError({\n                    code: \"BAD_REQUEST\",\n                    message: \"Invalid input\",\n                    cause: e.message\n                }), opts.router), {\n                    status: 400\n                }),\n            UploadThingError: (e)=>// eslint-disable-next-line @typescript-eslint/no-unsafe-argument\n                _effect_platform__WEBPACK_IMPORTED_MODULE_17__.json(formatError(e, opts.router), {\n                    status: (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.getStatusCodeFromError)(e)\n                })\n        }));\n        const appendResponseHeaders = effect_Effect__WEBPACK_IMPORTED_MODULE_5__.map(_effect_platform__WEBPACK_IMPORTED_MODULE_17__.setHeader(\"x-uploadthing-version\", version));\n        return _effect_platform__WEBPACK_IMPORTED_MODULE_19__.empty.pipe(_effect_platform__WEBPACK_IMPORTED_MODULE_19__.get(\"*\", GET), _effect_platform__WEBPACK_IMPORTED_MODULE_19__.post(\"*\", POST), _effect_platform__WEBPACK_IMPORTED_MODULE_19__.use(appendResponseHeaders));\n    }).pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.withLogSpan(\"createRequestHandler\"));\nconst handleErrorRequest = (opts)=>effect_Effect__WEBPACK_IMPORTED_MODULE_5__.gen(function*() {\n        const { uploadable } = opts;\n        const request = yield* _effect_platform__WEBPACK_IMPORTED_MODULE_18__.HttpServerRequest;\n        const { apiKey } = yield* UTToken;\n        const verified = yield* (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.verifySignature)((yield* request.text), request.headers[\"x-uploadthing-signature\"], apiKey);\n        yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logDebug(`Signature verified: ${verified}`);\n        if (!verified) {\n            yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logError(\"Invalid signature\");\n            return yield* new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.UploadThingError({\n                code: \"BAD_REQUEST\",\n                message: \"Invalid signature\"\n            });\n        }\n        const requestInput = yield* _effect_platform__WEBPACK_IMPORTED_MODULE_18__.schemaBodyJson(effect_Schema__WEBPACK_IMPORTED_MODULE_1__.Struct({\n            fileKey: effect_Schema__WEBPACK_IMPORTED_MODULE_1__.String,\n            error: effect_Schema__WEBPACK_IMPORTED_MODULE_1__.String\n        }));\n        yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logDebug(\"Handling error callback request with input:\").pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.annotateLogs(\"json\", requestInput));\n        const fiber = yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.tryPromise({\n            try: async ()=>uploadable._def.onUploadError({\n                    error: new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.UploadThingError({\n                        code: \"UPLOAD_FAILED\",\n                        message: `Upload failed for ${requestInput.fileKey}: ${requestInput.error}`\n                    }),\n                    fileKey: requestInput.fileKey\n                }),\n            catch: (error)=>new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.UploadThingError({\n                    code: \"INTERNAL_SERVER_ERROR\",\n                    message: \"Failed to run onUploadError\",\n                    cause: error\n                })\n        }).pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.tapError((error)=>effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logError(\"Failed to run onUploadError. You probably shouldn't be throwing errors here.\").pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.annotateLogs(\"error\", error)))).pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.ignoreLogged, effect_Effect__WEBPACK_IMPORTED_MODULE_5__.forkDaemon);\n        return {\n            body: null,\n            fiber\n        };\n    }).pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.withLogSpan(\"handleErrorRequest\"));\nconst handleCallbackRequest = (opts)=>effect_Effect__WEBPACK_IMPORTED_MODULE_5__.gen(function*() {\n        const { uploadable, fePackage, beAdapter } = opts;\n        const request = yield* _effect_platform__WEBPACK_IMPORTED_MODULE_18__.HttpServerRequest;\n        const { apiKey } = yield* UTToken;\n        const verified = yield* (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.verifySignature)((yield* request.text), request.headers[\"x-uploadthing-signature\"], apiKey);\n        yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logDebug(`Signature verified: ${verified}`);\n        if (!verified) {\n            yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logError(\"Invalid signature\");\n            return yield* new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.UploadThingError({\n                code: \"BAD_REQUEST\",\n                message: \"Invalid signature\"\n            });\n        }\n        const requestInput = yield* _effect_platform__WEBPACK_IMPORTED_MODULE_18__.schemaBodyJson(effect_Schema__WEBPACK_IMPORTED_MODULE_1__.Struct({\n            status: effect_Schema__WEBPACK_IMPORTED_MODULE_1__.String,\n            file: UploadedFileData,\n            metadata: effect_Schema__WEBPACK_IMPORTED_MODULE_1__.Record({\n                key: effect_Schema__WEBPACK_IMPORTED_MODULE_1__.String,\n                value: effect_Schema__WEBPACK_IMPORTED_MODULE_1__.Unknown\n            })\n        }));\n        yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logDebug(\"Handling callback request with input:\").pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.annotateLogs(\"json\", requestInput));\n        /**\n     * Run `.onUploadComplete` as a daemon to prevent the\n     * request from UT to potentially timeout.\n     */ const fiber = yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.gen(function*() {\n            const serverData = yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.tryPromise({\n                try: async ()=>uploadable.resolver({\n                        file: requestInput.file,\n                        metadata: requestInput.metadata\n                    }),\n                catch: (error)=>new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.UploadThingError({\n                        code: \"INTERNAL_SERVER_ERROR\",\n                        message: \"Failed to run onUploadComplete. You probably shouldn't be throwing errors here.\",\n                        cause: error\n                    })\n            });\n            const payload = {\n                fileKey: requestInput.file.key,\n                callbackData: serverData ?? null\n            };\n            yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logDebug(\"'onUploadComplete' callback finished. Sending response to UploadThing:\").pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.annotateLogs(\"callbackData\", payload));\n            const baseUrl = yield* IngestUrl;\n            const httpClient = (yield* _effect_platform__WEBPACK_IMPORTED_MODULE_21__.HttpClient).pipe(_effect_platform__WEBPACK_IMPORTED_MODULE_21__.filterStatusOk);\n            yield* _effect_platform__WEBPACK_IMPORTED_MODULE_22__.post(`/callback-result`).pipe(_effect_platform__WEBPACK_IMPORTED_MODULE_22__.prependUrl(baseUrl), _effect_platform__WEBPACK_IMPORTED_MODULE_22__.setHeaders({\n                \"x-uploadthing-api-key\": effect_Redacted__WEBPACK_IMPORTED_MODULE_23__.value(apiKey),\n                \"x-uploadthing-version\": version,\n                \"x-uploadthing-be-adapter\": beAdapter,\n                \"x-uploadthing-fe-package\": fePackage\n            }), _effect_platform__WEBPACK_IMPORTED_MODULE_22__.bodyJson(payload), effect_Effect__WEBPACK_IMPORTED_MODULE_5__.flatMap(httpClient.execute), effect_Effect__WEBPACK_IMPORTED_MODULE_5__.tapError(logHttpClientError(\"Failed to register callback result\")), effect_Effect__WEBPACK_IMPORTED_MODULE_5__.flatMap(_effect_platform__WEBPACK_IMPORTED_MODULE_24__.schemaBodyJson(CallbackResultResponse)), effect_Effect__WEBPACK_IMPORTED_MODULE_5__.tap(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.log(\"Sent callback result to UploadThing\")), effect_Effect__WEBPACK_IMPORTED_MODULE_5__.scoped);\n        }).pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.ignoreLogged, effect_Effect__WEBPACK_IMPORTED_MODULE_5__.forkDaemon);\n        return {\n            body: null,\n            fiber\n        };\n    }).pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.withLogSpan(\"handleCallbackRequest\"));\nconst runRouteMiddleware = (opts)=>effect_Effect__WEBPACK_IMPORTED_MODULE_5__.gen(function*() {\n        const middlewareArgs = yield* MiddlewareArguments;\n        const { json: { files, input }, uploadable } = opts;\n        yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logDebug(\"Running middleware\");\n        const metadata = yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.tryPromise({\n            try: async ()=>uploadable._def.middleware({\n                    ...middlewareArgs,\n                    input,\n                    files\n                }),\n            catch: (error)=>error instanceof _uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.UploadThingError ? error : new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.UploadThingError({\n                    code: \"INTERNAL_SERVER_ERROR\",\n                    message: \"Failed to run middleware\",\n                    cause: error\n                })\n        });\n        if (metadata[_internal_types_js__WEBPACK_IMPORTED_MODULE_0__.UTFiles] && metadata[_internal_types_js__WEBPACK_IMPORTED_MODULE_0__.UTFiles].length !== files.length) {\n            const msg = `Expected files override to have the same length as original files, got ${metadata[_internal_types_js__WEBPACK_IMPORTED_MODULE_0__.UTFiles].length} but expected ${files.length}`;\n            yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logError(msg);\n            return yield* new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.UploadThingError({\n                code: \"BAD_REQUEST\",\n                message: \"Files override must have the same length as files\",\n                cause: msg\n            });\n        }\n        // Attach customIds from middleware to the files\n        const filesWithCustomIds = yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.forEach(files, (file, idx)=>effect_Effect__WEBPACK_IMPORTED_MODULE_5__.gen(function*() {\n                const theirs = metadata[_internal_types_js__WEBPACK_IMPORTED_MODULE_0__.UTFiles]?.[idx];\n                if (theirs && theirs.size !== file.size) {\n                    yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logWarning(\"File size mismatch. Reverting to original size\");\n                }\n                return {\n                    name: theirs?.name ?? file.name,\n                    size: file.size,\n                    type: file.type,\n                    customId: theirs?.customId,\n                    lastModified: theirs?.lastModified ?? Date.now()\n                };\n            }));\n        return {\n            metadata,\n            filesWithCustomIds\n        };\n    }).pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.withLogSpan(\"runRouteMiddleware\"));\nconst handleUploadAction = (opts)=>effect_Effect__WEBPACK_IMPORTED_MODULE_5__.gen(function*() {\n        const httpClient = (yield* _effect_platform__WEBPACK_IMPORTED_MODULE_21__.HttpClient).pipe(_effect_platform__WEBPACK_IMPORTED_MODULE_21__.filterStatusOk);\n        const { uploadable, fePackage, beAdapter, slug } = opts;\n        const json = yield* _effect_platform__WEBPACK_IMPORTED_MODULE_18__.schemaBodyJson(UploadActionPayload);\n        yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logDebug(\"Handling upload request\").pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.annotateLogs(\"json\", json));\n        // validate the input\n        yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logDebug(\"Parsing user input\");\n        const inputParser = uploadable._def.inputParser;\n        const parsedInput = yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.tryPromise({\n            try: async ()=>getParseFn(inputParser)(json.input),\n            catch: (error)=>new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.UploadThingError({\n                    code: \"BAD_REQUEST\",\n                    message: \"Invalid input\",\n                    cause: error\n                })\n        });\n        yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logDebug(\"Input parsed successfully\").pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.annotateLogs(\"input\", parsedInput));\n        const { metadata, filesWithCustomIds } = yield* runRouteMiddleware({\n            json: {\n                input: parsedInput,\n                files: json.files\n            },\n            uploadable\n        });\n        yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logDebug(\"Parsing route config\").pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.annotateLogs(\"routerConfig\", uploadable._def.routerConfig));\n        const parsedConfig = yield* (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.fillInputRouteConfig)(uploadable._def.routerConfig).pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.catchTag(\"InvalidRouteConfig\", (err)=>new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.UploadThingError({\n                code: \"BAD_REQUEST\",\n                message: \"Invalid route config\",\n                cause: err\n            })));\n        yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logDebug(\"Route config parsed successfully\").pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.annotateLogs(\"routeConfig\", parsedConfig));\n        yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logDebug(\"Validating files meet the config requirements\").pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.annotateLogs(\"files\", json.files));\n        yield* assertFilesMeetConfig(json.files, parsedConfig).pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.mapError((e)=>new _uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.UploadThingError({\n                code: \"BAD_REQUEST\",\n                message: `Invalid config: ${e._tag}`,\n                cause: \"reason\" in e ? e.reason : e.message\n            })));\n        yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logDebug(\"Files validated.\");\n        const fileUploadRequests = yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.forEach(filesWithCustomIds, (file)=>effect_Effect__WEBPACK_IMPORTED_MODULE_5__.map((0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.matchFileType)(file, (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.objectKeys)(parsedConfig)), (type)=>({\n                    name: file.name,\n                    size: file.size,\n                    type: file.type || type,\n                    lastModified: file.lastModified,\n                    customId: file.customId,\n                    contentDisposition: parsedConfig[type]?.contentDisposition ?? \"inline\",\n                    acl: parsedConfig[type]?.acl\n                }))).pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.catchTags({\n            /** Shouldn't happen since config is validated above so just dying is fine I think */ InvalidFileType: (e)=>effect_Effect__WEBPACK_IMPORTED_MODULE_5__.die(e),\n            UnknownFileType: (e)=>effect_Effect__WEBPACK_IMPORTED_MODULE_5__.die(e)\n        }));\n        const routeOptions = uploadable._def.routeOptions;\n        const { apiKey, appId } = yield* UTToken;\n        const ingestUrl = yield* IngestUrl;\n        const isDev = yield* IsDevelopment;\n        yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logDebug(\"Generating presigned URLs\").pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.annotateLogs(\"fileUploadRequests\", fileUploadRequests), effect_Effect__WEBPACK_IMPORTED_MODULE_5__.annotateLogs(\"ingestUrl\", ingestUrl));\n        const presignedUrls = yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.forEach(fileUploadRequests, (file)=>effect_Effect__WEBPACK_IMPORTED_MODULE_5__.gen(function*() {\n                const key = yield* (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.generateKey)(file, appId, routeOptions.getFileHashParts);\n                const url = yield* (0,_uploadthing_shared__WEBPACK_IMPORTED_MODULE_2__.generateSignedURL)(`${ingestUrl}/${key}`, apiKey, {\n                    ttlInSeconds: routeOptions.presignedURLTTL,\n                    data: {\n                        \"x-ut-identifier\": appId,\n                        \"x-ut-file-name\": file.name,\n                        \"x-ut-file-size\": file.size,\n                        \"x-ut-file-type\": file.type,\n                        \"x-ut-slug\": slug,\n                        \"x-ut-custom-id\": file.customId,\n                        \"x-ut-content-disposition\": file.contentDisposition,\n                        \"x-ut-acl\": file.acl\n                    }\n                });\n                return {\n                    url,\n                    key\n                };\n            }), {\n            concurrency: \"unbounded\"\n        });\n        const serverReq = yield* _effect_platform__WEBPACK_IMPORTED_MODULE_18__.HttpServerRequest;\n        const requestUrl = yield* _effect_platform__WEBPACK_IMPORTED_MODULE_18__.toURL(serverReq);\n        const devHookRequest = yield* effect_Config__WEBPACK_IMPORTED_MODULE_4__.string(\"callbackUrl\").pipe(effect_Config__WEBPACK_IMPORTED_MODULE_4__.withDefault(requestUrl.origin + requestUrl.pathname), effect_Effect__WEBPACK_IMPORTED_MODULE_5__.map((url)=>_effect_platform__WEBPACK_IMPORTED_MODULE_22__.post(url).pipe(_effect_platform__WEBPACK_IMPORTED_MODULE_22__.appendUrlParam(\"slug\", slug))));\n        const metadataRequest = _effect_platform__WEBPACK_IMPORTED_MODULE_22__.post(\"/route-metadata\").pipe(_effect_platform__WEBPACK_IMPORTED_MODULE_22__.prependUrl(ingestUrl), _effect_platform__WEBPACK_IMPORTED_MODULE_22__.setHeaders({\n            \"x-uploadthing-api-key\": effect_Redacted__WEBPACK_IMPORTED_MODULE_23__.value(apiKey),\n            \"x-uploadthing-version\": version,\n            \"x-uploadthing-be-adapter\": beAdapter,\n            \"x-uploadthing-fe-package\": fePackage\n        }), _effect_platform__WEBPACK_IMPORTED_MODULE_22__.bodyJson({\n            fileKeys: presignedUrls.map(({ key })=>key),\n            metadata: metadata,\n            isDev,\n            callbackUrl: devHookRequest.url,\n            callbackSlug: slug,\n            awaitServerData: routeOptions.awaitServerData ?? true\n        }), effect_Effect__WEBPACK_IMPORTED_MODULE_5__.flatMap(httpClient.execute));\n        // Send metadata to UT server (non blocking as a daemon)\n        // In dev, keep the stream open and simulate the callback requests as\n        // files complete uploading\n        const fiber = yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__[\"if\"](isDev, {\n            onTrue: ()=>metadataRequest.pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.tapBoth({\n                    onSuccess: logHttpClientResponse(\"Registered metadata\", {\n                        mixin: \"None\"\n                    }),\n                    onFailure: logHttpClientError(\"Failed to register metadata\")\n                }), _effect_platform__WEBPACK_IMPORTED_MODULE_25__.stream, handleJsonLineStream(MetadataFetchStreamPart, (chunk)=>devHookRequest.pipe(_effect_platform__WEBPACK_IMPORTED_MODULE_22__.setHeaders({\n                        \"uploadthing-hook\": chunk.hook,\n                        \"x-uploadthing-signature\": chunk.signature\n                    }), _effect_platform__WEBPACK_IMPORTED_MODULE_22__.setBody(_effect_platform__WEBPACK_IMPORTED_MODULE_26__.text(chunk.payload, \"application/json\")), httpClient.execute, effect_Effect__WEBPACK_IMPORTED_MODULE_5__.tapBoth({\n                        onSuccess: logHttpClientResponse(\"Successfully forwarded callback request from dev stream\"),\n                        onFailure: logHttpClientError(\"Failed to forward callback request from dev stream\")\n                    }), effect_Effect__WEBPACK_IMPORTED_MODULE_5__.annotateLogs(chunk), effect_Effect__WEBPACK_IMPORTED_MODULE_5__.asVoid, effect_Effect__WEBPACK_IMPORTED_MODULE_5__.ignoreLogged, effect_Effect__WEBPACK_IMPORTED_MODULE_5__.scoped))),\n            onFalse: ()=>metadataRequest.pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.tapBoth({\n                    onSuccess: logHttpClientResponse(\"Registered metadata\"),\n                    onFailure: logHttpClientError(\"Failed to register metadata\")\n                }), effect_Effect__WEBPACK_IMPORTED_MODULE_5__.flatMap(_effect_platform__WEBPACK_IMPORTED_MODULE_24__.schemaBodyJson(MetadataFetchResponse)), effect_Effect__WEBPACK_IMPORTED_MODULE_5__.scoped)\n        }).pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.forkDaemon);\n        const presigneds = presignedUrls.map((p, i)=>({\n                url: p.url,\n                key: p.key,\n                name: fileUploadRequests[i].name,\n                customId: fileUploadRequests[i].customId ?? null\n            }));\n        yield* effect_Effect__WEBPACK_IMPORTED_MODULE_5__.logInfo(\"Sending presigned URLs to client\").pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.annotateLogs(\"presignedUrls\", presigneds));\n        return {\n            body: presigneds,\n            fiber\n        };\n    }).pipe(effect_Effect__WEBPACK_IMPORTED_MODULE_5__.withLogSpan(\"handleUploadAction\"));\n\nfunction internalCreateBuilder(initDef = {}) {\n    const _def = {\n        // Default router config\n        routerConfig: {\n            image: {\n                maxFileSize: \"4MB\"\n            }\n        },\n        routeOptions: {\n            awaitServerData: true\n        },\n        inputParser: {\n            parse: ()=>undefined,\n            _input: undefined,\n            _output: undefined\n        },\n        middleware: ()=>({}),\n        onUploadError: ()=>{\n        // noop\n        },\n        errorFormatter: initDef.errorFormatter ?? defaultErrorFormatter,\n        // Overload with properties passed in\n        ...initDef\n    };\n    return {\n        input (userParser) {\n            return internalCreateBuilder({\n                ..._def,\n                inputParser: userParser\n            });\n        },\n        middleware (userMiddleware) {\n            return internalCreateBuilder({\n                ..._def,\n                middleware: userMiddleware\n            });\n        },\n        onUploadComplete (userUploadComplete) {\n            return {\n                _def,\n                resolver: userUploadComplete\n            };\n        },\n        onUploadError (userOnUploadError) {\n            return internalCreateBuilder({\n                ..._def,\n                onUploadError: userOnUploadError\n            });\n        }\n    };\n}\nfunction createBuilder(opts) {\n    return (input, config)=>{\n        return internalCreateBuilder({\n            routerConfig: input,\n            routeOptions: config ?? {},\n            ...opts\n        });\n    };\n}\n\nconst createUploadthing = (opts)=>createBuilder(opts);\nconst createRouteHandler = (opts)=>{\n    const handler = makeAdapterHandler((req)=>effect_Effect__WEBPACK_IMPORTED_MODULE_5__.succeed({\n            req,\n            res: undefined,\n            event: undefined\n        }), (req)=>effect_Effect__WEBPACK_IMPORTED_MODULE_5__.succeed(req), opts, \"nextjs-app\");\n    return {\n        POST: handler,\n        GET: handler\n    };\n};\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvdXBsb2FkdGhpbmcvbmV4dC9pbmRleC5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBd0M7QUFDNkk7QUFDN0k7QUFDRTtBQUNKO0FBQ007QUFDVDtBQUN5UTtBQUNwUDtBQUNoQjtBQUNGO0FBQ0U7QUFDSTtBQUNSO0FBQ1E7QUFDWTtBQUNUO0FBQ0E7O0FBRS9DOztBQUVBLGtEQUFTLElBQUkseUVBQXdCO0FBQ3JDLGtEQUFTLElBQUksMERBQVM7QUFDdEI7QUFDQTtBQUNBLHVCQUF1QixrREFBUztBQUNoQztBQUNBO0FBQ0E7QUFDQSw0QkFBNEIsa0RBQVM7QUFDckM7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUIsb0RBQVcsQ0FBQyw2REFBb0IsRUFBRSxpREFBUTtBQUNuRTtBQUNBO0FBQ0EsQ0FBQztBQUNELG9CQUFvQixpREFBUTtBQUM1QixZQUFZLG1EQUFVLENBQUMsaURBQVEsTUFBTSxxREFBWTtBQUNqRCxXQUFXLGlEQUFRO0FBQ25CLGFBQWEsd0RBQWUsQ0FBQyxpREFBUTtBQUNyQyxnQkFBZ0IsaURBQVEsTUFBTSx1REFBYztBQUM1QztBQUNBLEtBQUs7QUFDTCxDQUFDO0FBQ0QseUJBQXlCLCtEQUFzQixNQUFNLGtEQUFTLGdCQUFnQixrREFBUyxDQUFDLG9EQUFXO0FBQ25HO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlDQUFpQyxnREFBTztBQUN4QyxVQUFVLGlEQUFRO0FBQ2xCLFVBQVUsaURBQVE7QUFDbEIsVUFBVSxpREFBUTtBQUNsQixrQkFBa0IsaURBQVEsTUFBTSxtREFBVTtBQUMxQyxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxjQUFjLGlEQUFRLENBQUMsaURBQVE7QUFDL0IsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTLGlEQUFRO0FBQ2pCLFNBQVMsaURBQVE7QUFDakIsWUFBWSxpREFBUTtBQUNwQixjQUFjLGlEQUFRO0FBQ3RCLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0NBQWtDLGdEQUFPO0FBQ3pDLFNBQVMsaURBQVE7QUFDakIsU0FBUyxpREFBUTtBQUNqQixjQUFjLGlEQUFRLENBQUMsaURBQVE7QUFDL0IsVUFBVSxpREFBUTtBQUNsQixDQUFDO0FBQ0Q7QUFDQSxzQ0FBc0MsZ0RBQU87QUFDN0MsYUFBYSxpREFBUTtBQUNyQixlQUFlLGlEQUFRO0FBQ3ZCO0FBQ0EsQ0FBQztBQUNEO0FBQ0Esb0NBQW9DLGdEQUFPO0FBQzNDLFFBQVEsa0RBQVM7QUFDakIsQ0FBQztBQUNEO0FBQ0EscUNBQXFDLGdEQUFPO0FBQzVDLFFBQVEsa0RBQVM7QUFDakIsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQ0FBc0MsZ0RBQU87QUFDN0MsV0FBVyxnREFBTztBQUNsQixXQUFXLGtEQUFTO0FBQ3BCLENBQUM7QUFDRDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkJBQTJCO0FBQzNCLHdCQUF3QiwwREFBc0IsUUFBUSx5REFBcUIsS0FBSywwREFBc0Isd0JBQXdCLDhFQUF5QjtBQUN2SixJQUFJLEtBQWdCLE1BQU07QUFDMUI7QUFDQSxLQUFLLElBQUkseURBQXFCLGlCQUFpQiwrREFBMkI7QUFDMUU7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQ0FBc0MsMkRBQXVCLGNBQWMsT0FBTyx5REFBcUI7QUFDdkcsc0JBQXNCLGtEQUFjLGVBQWUsaURBQWEsS0FBSyxrREFBYyxrQ0FBa0MsYUFBb0IsbUJBQW1CLDhDQUFVLDhCQUE4QixzREFBa0I7QUFDdE4sZ0JBQWdCLGlEQUFRLGlDQUFpQyxvREFBZ0I7QUFDekUsMEJBQTBCLGlFQUFnQjtBQUMxQztBQUNBLGtIQUFrSCxrREFBa0Q7QUFDcEs7QUFDQSxTQUFTO0FBQ1QsQ0FBQztBQUNELGlEQUFhLGdCQUFnQixzREFBa0IsaUNBQWlDLHFEQUFpQixtQkFBbUIsOENBQVU7QUFDOUgsa0JBQWtCLDhDQUFVO0FBQzVCLFlBQVksc0JBQXNCO0FBQ2xDLCtCQUErQjtBQUMvQixrQkFBa0IsaURBQWEsbUJBQW1CLHNEQUFrQixZQUFZLE9BQU8sR0FBRyxXQUFXLElBQUkscURBQWlCLG1CQUFtQiw4Q0FBVTtBQUN2SixDQUFDOztBQUVEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSwyQkFBMkIscURBQWlCLElBQUksb0RBQWdCLFVBQVUsOENBQVU7QUFDcEY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQkFBc0I7QUFDdEI7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCLG1EQUFlLHlCQUF5Qix1REFBbUIsa0JBQWtCLHVEQUFtQiwrQkFBK0IsdURBQW1CO0FBQ3pLO0FBQ0EsYUFBYSxJQUFJLG9EQUFnQixDQUFDLHdEQUFlLENBQUMsZ0RBQU8sWUFBWSxvREFBZ0IsQ0FBQyxrREFBYywwQkFBMEIsbURBQWUsRUFBRSxzREFBa0I7QUFDaks7O0FBRUEsNEJBQTRCLG1EQUFlLGtCQUFrQixzREFBa0IsQ0FBQyxpREFBYSxHQUFHLGtEQUFjLFVBQVUsMERBQXNCLFVBQVUsbURBQWUsTUFBTSxtREFBZSwyQkFBMkIsdURBQW1CLGdCQUFnQixtREFBZSx5QkFBeUIsaUVBQWdCO0FBQ2xUO0FBQ0E7QUFDQTtBQUNBLEtBQUssSUFBSSxzREFBa0I7QUFDM0Isa0JBQWtCLGtEQUFjO0FBQ2hDLHNCQUFzQiw4Q0FBVTtBQUNoQztBQUNBLDRDQUE0QyxzREFBa0I7QUFDOUQsV0FBVywwQ0FBTTtBQUNqQixDQUFDLE9BQU8sbURBQWUseUJBQXlCLGlFQUFnQjtBQUNoRTtBQUNBO0FBQ0E7QUFDQSxLQUFLLElBQUksc0RBQWtCO0FBQzNCO0FBQ0E7QUFDQSxrQkFBa0Isd0RBQW9CO0FBQ3RDLHVCQUF1QixrREFBYyxzQ0FBc0Msa0RBQVcsTUFBTSx1REFBbUIsV0FBVyxTQUFTLEdBQUcsZ0JBQWdCLFNBQVMsdURBQW1CO0FBQ2xMO0FBQ0E7QUFDQTtBQUNBLFNBQVMsa0JBQWtCLG1EQUFlLGVBQWUsdURBQW1COztBQUU1RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsK0JBQStCLCtDQUFVO0FBQ3pDO0FBQ0EseUNBQXlDLE1BQU0sZ0JBQWdCLG9FQUFlLFNBQVMsbUNBQW1DLElBQUk7QUFDOUg7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdDQUFnQywrQ0FBVTtBQUMxQztBQUNBLHVDQUF1QyxRQUFRLG1CQUFtQixLQUFLLGFBQWEsV0FBVyxtQkFBbUIsTUFBTTtBQUN4SDtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0RBQW9ELDhDQUFVO0FBQzlEO0FBQ0E7QUFDQSxnQ0FBZ0Msa0VBQWEsT0FBTywrREFBVTtBQUM5RDtBQUNBO0FBQ0E7QUFDQSxrQ0FBa0Msd0VBQXVCO0FBQ3pEO0FBQ0EsMENBQTBDLG9FQUFlO0FBQ3pEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkNBQTJDLHdFQUF1QjtBQUNsRTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtDQUFrQyxpRUFBZ0I7QUFDbEQ7QUFDQTtBQUNBLGtGQUFrRixJQUFJLFNBQVMsS0FBSyxJQUFJLElBQUk7QUFDNUcsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxzQ0FBc0Msa0RBQWMsQ0FBQywrREFBVSxrQkFBa0IsOENBQVUsQ0FBQyx5RUFBb0I7QUFDaEg7QUFDQTtBQUNBLGFBQWE7O0FBRWI7QUFDQSw0QkFBNEIsc0RBQWtCLENBQUMsb0RBQXFCLEVBQUUsaURBQWEsQ0FBQyxvREFBcUI7QUFDekcsZ0NBQWdDLHVEQUFtQixDQUFDLG9EQUFlLENBQUMsbUVBQTRCO0FBQ2hHO0FBQ0E7QUFDQSxrQkFBa0IsaURBQWEsQ0FBQyxrREFBYyw0RUFBNEUsMkRBQXVCO0FBQ2pKLFdBQVcsd0RBQW1CO0FBQzlCOztBQUVBLGtDQUFrQyxnREFBVztBQUM3QztBQUNBO0FBQ0E7QUFDQSxtQkFBbUIsa0RBQWMsNEJBQTRCLGtFQUEyQjtBQUN4RiwyQkFBMkIsOENBQVUsQ0FBQyxrREFBYyxpRUFBaUUsK0RBQTJCO0FBQ2hKO0FBQ0EseUNBQXlDLDZDQUFTLGdCQUFnQiw2Q0FBUyxzQkFBc0Isc0RBQWtCO0FBQ25IO0FBQ0E7QUFDQTtBQUNBLGdEQUFnRCw4Q0FBVTtBQUMxRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBLDhCQUE4QixpRUFBZ0I7QUFDOUM7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBLG9CQUFvQiw4Q0FBVTtBQUM5QiwwQkFBMEIsbURBQXVCO0FBQ2pELFNBQVM7QUFDVCxxQkFBcUIsOENBQVU7QUFDL0Isb0JBQW9CLGtIQUFrSCxTQUFTLDREQUErQixDQUFDLGlEQUFRO0FBQ3ZMLHlEQUF5RCxtREFBVTtBQUNuRSx5Q0FBeUMsaURBQVEsTUFBTSx1REFBYztBQUNyRTtBQUNBLGlCQUFpQjtBQUNqQix5Q0FBeUMsaURBQVEsTUFBTSx1REFBYztBQUNyRTtBQUNBLGlCQUFpQjtBQUNqQixhQUFhO0FBQ2I7QUFDQTtBQUNBLHVCQUF1QixxREFBaUIsc0hBQXNILHVEQUFtQjtBQUNqTDtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0Esb0JBQW9CLG1CQUFtQixTQUFTLDJEQUF1QixDQUFDLGlEQUFRO0FBQ2hGLDRDQUE0QyxtREFBVTtBQUN0RCxzQkFBc0IsaURBQVE7QUFDOUIsYUFBYTtBQUNiO0FBQ0E7QUFDQSw0REFBNEQsS0FBSztBQUNqRSx1QkFBdUIsbURBQWU7QUFDdEMsa0NBQWtDLGlFQUFnQjtBQUNsRDtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0Esb0JBQW9CLGNBQWMsU0FBUyxnREFBVztBQUN0RDtBQUNBO0FBQ0EsYUFBYSxPQUFPLCtDQUFVO0FBQzlCO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUIsSUFBSSwrQ0FBVTtBQUMvQjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQixJQUFJLCtDQUFVO0FBQy9CO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQSxpQkFBaUIsSUFBSSxpREFBWSxLQUFLLGtEQUFjO0FBQ3BEO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQSx1QkFBdUIsbURBQWUsaUNBQWlDLHVEQUFtQjtBQUMxRiwrQ0FBK0M7QUFDL0M7QUFDQSxrQkFBa0I7QUFDbEIsaUNBQWlDLHFEQUFpQjtBQUNsRDtBQUNBO0FBQ0EsbUJBQW1CLG1EQUFlLDBCQUEwQix1REFBbUI7QUFDL0UsMEJBQTBCLG1EQUF1QjtBQUNqRCxTQUFTLE9BQU8sb0RBQWdCO0FBQ2hDLDZCQUE2QixtREFBdUIsaUJBQWlCLGlFQUFnQjtBQUNyRjtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQSxpQkFBaUI7QUFDakI7QUFDQSxnQkFBZ0IsbURBQXVCO0FBQ3ZDLDRCQUE0QiwyRUFBc0I7QUFDbEQsaUJBQWlCO0FBQ2pCLFNBQVM7QUFDVCxzQ0FBc0MsOENBQVUsQ0FBQyx3REFBNEI7QUFDN0UsZUFBZSxvREFBZ0IsTUFBTSxrREFBYyxZQUFZLG1EQUFlLGFBQWEsa0RBQWM7QUFDekcsS0FBSyxPQUFPLHNEQUFrQjtBQUM5QixtQ0FBbUMsOENBQVU7QUFDN0MsZ0JBQWdCLGFBQWE7QUFDN0IsK0JBQStCLGdFQUFtQztBQUNsRSxnQkFBZ0IsU0FBUztBQUN6QixnQ0FBZ0Msb0VBQWU7QUFDL0MsZUFBZSxtREFBZSx3QkFBd0IsU0FBUztBQUMvRDtBQUNBLG1CQUFtQixtREFBZTtBQUNsQyw4QkFBOEIsaUVBQWdCO0FBQzlDO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQSxvQ0FBb0MsNkRBQWdDLENBQUMsaURBQVE7QUFDN0UscUJBQXFCLGlEQUFRO0FBQzdCLG1CQUFtQixpREFBUTtBQUMzQixTQUFTO0FBQ1QsZUFBZSxtREFBZSxxREFBcUQsdURBQW1CO0FBQ3RHLDZCQUE2QixxREFBaUI7QUFDOUM7QUFDQSwrQkFBK0IsaUVBQWdCO0FBQy9DO0FBQ0Esc0RBQXNELHFCQUFxQixJQUFJLG1CQUFtQjtBQUNsRyxxQkFBcUI7QUFDckI7QUFDQSxpQkFBaUI7QUFDakIsZ0NBQWdDLGlFQUFnQjtBQUNoRDtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakIsU0FBUyxPQUFPLG1EQUFlLFVBQVUsbURBQWUsc0ZBQXNGLHVEQUFtQix5QkFBeUIsdURBQW1CLEVBQUUscURBQWlCO0FBQ2hPO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSyxPQUFPLHNEQUFrQjtBQUM5QixzQ0FBc0MsOENBQVU7QUFDaEQsZ0JBQWdCLG1DQUFtQztBQUNuRCwrQkFBK0IsZ0VBQW1DO0FBQ2xFLGdCQUFnQixTQUFTO0FBQ3pCLGdDQUFnQyxvRUFBZTtBQUMvQyxlQUFlLG1EQUFlLHdCQUF3QixTQUFTO0FBQy9EO0FBQ0EsbUJBQW1CLG1EQUFlO0FBQ2xDLDhCQUE4QixpRUFBZ0I7QUFDOUM7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBLG9DQUFvQyw2REFBZ0MsQ0FBQyxpREFBUTtBQUM3RSxvQkFBb0IsaURBQVE7QUFDNUI7QUFDQSxzQkFBc0IsaURBQVE7QUFDOUIscUJBQXFCLGlEQUFRO0FBQzdCLHVCQUF1QixrREFBUztBQUNoQyxhQUFhO0FBQ2IsU0FBUztBQUNULGVBQWUsbURBQWUsK0NBQStDLHVEQUFtQjtBQUNoRztBQUNBO0FBQ0E7QUFDQSw2QkFBNkIsOENBQVU7QUFDdkMsc0NBQXNDLHFEQUFpQjtBQUN2RDtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckIsb0NBQW9DLGlFQUFnQjtBQUNwRDtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckIsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUJBQW1CLG1EQUFlLGdGQUFnRix1REFBbUI7QUFDckk7QUFDQSx1Q0FBdUMseURBQXFCLE9BQU8sNkRBQXlCO0FBQzVGLG1CQUFtQixtREFBc0IsMEJBQTBCLHlEQUE0QixXQUFXLHlEQUE0QjtBQUN0SSx5Q0FBeUMsbURBQWM7QUFDdkQ7QUFDQTtBQUNBO0FBQ0EsYUFBYSxHQUFHLHVEQUEwQixXQUFXLGtEQUFjLHNCQUFzQixtREFBZSw0REFBNEQsa0RBQWMsQ0FBQyw2REFBaUMsMkJBQTJCLDhDQUFVLENBQUMsOENBQVUsMENBQTBDLGlEQUFhO0FBQzNULFNBQVMsT0FBTyx1REFBbUIsRUFBRSxxREFBaUI7QUFDdEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLLE9BQU8sc0RBQWtCO0FBQzlCLG1DQUFtQyw4Q0FBVTtBQUM3QztBQUNBLGdCQUFnQixRQUFRLGNBQWMsZUFBZTtBQUNyRCxlQUFlLG1EQUFlO0FBQzlCLGdDQUFnQyxxREFBaUI7QUFDakQ7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakIsNkNBQTZDLGlFQUFnQixlQUFlLGlFQUFnQjtBQUM1RjtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakIsU0FBUztBQUNULHFCQUFxQix1REFBTyxjQUFjLHVEQUFPO0FBQ2pELGtHQUFrRyxTQUFTLHVEQUFPLFVBQVUsZUFBZSxhQUFhO0FBQ3hKLG1CQUFtQixtREFBZTtBQUNsQyw4QkFBOEIsaUVBQWdCO0FBQzlDO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsMENBQTBDLGtEQUFjLHFCQUFxQiw4Q0FBVTtBQUN2Rix3Q0FBd0MsdURBQU87QUFDL0M7QUFDQSwyQkFBMkIscURBQWlCO0FBQzVDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLLE9BQU8sc0RBQWtCO0FBQzlCLG1DQUFtQyw4Q0FBVTtBQUM3QyxtQ0FBbUMseURBQXFCLE9BQU8sNkRBQXlCO0FBQ3hGLGdCQUFnQix5Q0FBeUM7QUFDekQsNEJBQTRCLDZEQUFnQztBQUM1RCxlQUFlLG1EQUFlLGlDQUFpQyx1REFBbUI7QUFDbEY7QUFDQSxlQUFlLG1EQUFlO0FBQzlCO0FBQ0EsbUNBQW1DLHFEQUFpQjtBQUNwRDtBQUNBLGdDQUFnQyxpRUFBZ0I7QUFDaEQ7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCLFNBQVM7QUFDVCxlQUFlLG1EQUFlLG1DQUFtQyx1REFBbUI7QUFDcEYsZ0JBQWdCLCtCQUErQjtBQUMvQztBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQSxTQUFTO0FBQ1QsZUFBZSxtREFBZSw4QkFBOEIsdURBQW1CO0FBQy9FLG9DQUFvQyx5RUFBb0Isb0NBQW9DLG1EQUFlLGtDQUFrQyxpRUFBZ0I7QUFDN0o7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLGVBQWUsbURBQWUsMENBQTBDLHVEQUFtQjtBQUMzRixlQUFlLG1EQUFlLHVEQUF1RCx1REFBbUI7QUFDeEcsb0VBQW9FLG1EQUFlLFVBQVUsaUVBQWdCO0FBQzdHO0FBQ0EsNENBQTRDLE9BQU87QUFDbkQ7QUFDQSxhQUFhO0FBQ2IsZUFBZSxtREFBZTtBQUM5QiwwQ0FBMEMsa0RBQWMsNkJBQTZCLDhDQUFVLENBQUMsa0VBQWEsT0FBTywrREFBVTtBQUM5SDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQixTQUFTLG9EQUFnQjtBQUMxQyx3SEFBd0gsOENBQVU7QUFDbEksa0NBQWtDLDhDQUFVO0FBQzVDLFNBQVM7QUFDVDtBQUNBLGdCQUFnQixnQkFBZ0I7QUFDaEM7QUFDQTtBQUNBLGVBQWUsbURBQWUsbUNBQW1DLHVEQUFtQiw0Q0FBNEMsdURBQW1CO0FBQ25KLHFDQUFxQyxrREFBYyw2QkFBNkIsOENBQVU7QUFDMUYsbUNBQW1DLGdFQUFXO0FBQzlDLG1DQUFtQyxzRUFBaUIsSUFBSSxVQUFVLEdBQUcsSUFBSTtBQUN6RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0EsU0FBUztBQUNULGlDQUFpQyxnRUFBbUM7QUFDcEUsa0NBQWtDLG9EQUF1QjtBQUN6RCxzQ0FBc0MsaURBQWEscUJBQXFCLHNEQUFrQiwyQ0FBMkMsOENBQVUsUUFBUSxtREFBc0IsV0FBVyw2REFBZ0M7QUFDeE4sZ0NBQWdDLG1EQUFzQix5QkFBeUIseURBQTRCLGFBQWEseURBQTRCO0FBQ3BKLHFDQUFxQyxtREFBYztBQUNuRDtBQUNBO0FBQ0E7QUFDQSxTQUFTLEdBQUcsdURBQTBCO0FBQ3RDLDJDQUEyQyxLQUFLO0FBQ2hEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTLEdBQUcsa0RBQWM7QUFDMUI7QUFDQTtBQUNBO0FBQ0EsNkJBQTZCLGdEQUFTO0FBQ3RDLDZDQUE2QyxrREFBYztBQUMzRDtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0EsaUJBQWlCLEdBQUcscURBQXlCLDZFQUE2RSx5REFBNEI7QUFDdEo7QUFDQTtBQUNBLHFCQUFxQixHQUFHLHNEQUF5QixDQUFDLG1EQUFhLDBEQUEwRCxrREFBYztBQUN2STtBQUNBO0FBQ0EscUJBQXFCLEdBQUcsdURBQW1CLFNBQVMsaURBQWEsRUFBRSx1REFBbUIsRUFBRSxpREFBYTtBQUNyRyw4Q0FBOEMsa0RBQWM7QUFDNUQ7QUFDQTtBQUNBLGlCQUFpQixHQUFHLGtEQUFjLENBQUMsNkRBQWlDLDBCQUEwQixpREFBYTtBQUMzRyxTQUFTLE9BQU8scURBQWlCO0FBQ2pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsZUFBZSxrREFBYywwQ0FBMEMsdURBQW1CO0FBQzFGO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSyxPQUFPLHNEQUFrQjs7QUFFOUIsMkNBQTJDO0FBQzNDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNULDJCQUEyQjtBQUMzQjtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQ0FBc0M7QUFDdEM7QUFDQSxTQUFTO0FBQ1Q7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsOENBQThDLGtEQUFjO0FBQzVEO0FBQ0E7QUFDQTtBQUNBLFNBQVMsVUFBVSxrREFBYztBQUNqQztBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVpRCIsInNvdXJjZXMiOlsid2VicGFjazovL215LWFwcC8uL25vZGVfbW9kdWxlcy91cGxvYWR0aGluZy9uZXh0L2luZGV4LmpzPzI2MjIiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgRWZmZWN0IGZyb20gJ2VmZmVjdC9FZmZlY3QnO1xuaW1wb3J0IHsgRmV0Y2hIdHRwQ2xpZW50LCBIZWFkZXJzLCBIdHRwQXBwLCBIdHRwU2VydmVyUmVzcG9uc2UsIEh0dHBTZXJ2ZXJSZXF1ZXN0LCBIdHRwUm91dGVyLCBIdHRwQ2xpZW50LCBIdHRwQ2xpZW50UmVxdWVzdCwgSHR0cENsaWVudFJlc3BvbnNlLCBIdHRwQm9keSB9IGZyb20gJ0BlZmZlY3QvcGxhdGZvcm0nO1xuaW1wb3J0ICogYXMgQ29uZmlnIGZyb20gJ2VmZmVjdC9Db25maWcnO1xuaW1wb3J0ICogYXMgQ29udGV4dCBmcm9tICdlZmZlY3QvQ29udGV4dCc7XG5pbXBvcnQgKiBhcyBNYXRjaCBmcm9tICdlZmZlY3QvTWF0Y2gnO1xuaW1wb3J0ICogYXMgUmVkYWN0ZWQgZnJvbSAnZWZmZWN0L1JlZGFjdGVkJztcbmltcG9ydCAqIGFzIFMgZnJvbSAnZWZmZWN0L1NjaGVtYSc7XG5pbXBvcnQgeyBWYWxpZENvbnRlbnREaXNwb3NpdGlvbnMsIFZhbGlkQUNMcywgZmlsdGVyRGVmaW5lZE9iamVjdFZhbHVlcywgVXBsb2FkVGhpbmdFcnJvciwgbWF0Y2hGaWxlVHlwZSwgb2JqZWN0S2V5cywgSW52YWxpZFJvdXRlQ29uZmlnRXJyb3IsIGZpbGVTaXplVG9CeXRlcywgZmlsbElucHV0Um91dGVDb25maWcsIGJ5dGVzVG9GaWxlU2l6ZSwgZ2V0U3RhdHVzQ29kZUZyb21FcnJvciwgdmVyaWZ5U2lnbmF0dXJlLCBnZW5lcmF0ZUtleSwgZ2VuZXJhdGVTaWduZWRVUkwgfSBmcm9tICdAdXBsb2FkdGhpbmcvc2hhcmVkJztcbmltcG9ydCAqIGFzIENvbmZpZ1Byb3ZpZGVyIGZyb20gJ2VmZmVjdC9Db25maWdQcm92aWRlcic7XG5pbXBvcnQgKiBhcyBTdHJlYW0gZnJvbSAnZWZmZWN0L1N0cmVhbSc7XG5pbXBvcnQgKiBhcyBMYXllciBmcm9tICdlZmZlY3QvTGF5ZXInO1xuaW1wb3J0ICogYXMgTG9nZ2VyIGZyb20gJ2VmZmVjdC9Mb2dnZXInO1xuaW1wb3J0ICogYXMgTG9nTGV2ZWwgZnJvbSAnZWZmZWN0L0xvZ0xldmVsJztcbmltcG9ydCAqIGFzIERhdGEgZnJvbSAnZWZmZWN0L0RhdGEnO1xuaW1wb3J0ICogYXMgRmliZXJSZWYgZnJvbSAnZWZmZWN0L0ZpYmVyUmVmJztcbmltcG9ydCAqIGFzIE1hbmFnZWRSdW50aW1lIGZyb20gJ2VmZmVjdC9NYW5hZ2VkUnVudGltZSc7XG5pbXBvcnQgeyBVVEZpbGVzIH0gZnJvbSAnLi4vaW50ZXJuYWwvdHlwZXMuanMnO1xuZXhwb3J0IHsgVVRGaWxlcyB9IGZyb20gJy4uL2ludGVybmFsL3R5cGVzLmpzJztcblxudmFyIHZlcnNpb24gPSBcIjcuMi4wXCI7XG5cblMuTGl0ZXJhbCguLi5WYWxpZENvbnRlbnREaXNwb3NpdGlvbnMpO1xuUy5MaXRlcmFsKC4uLlZhbGlkQUNMcyk7XG4vKipcbiAqIFZhbGlkIG9wdGlvbnMgZm9yIHRoZSBgP2FjdGlvblR5cGVgIHF1ZXJ5IHBhcmFtXG4gKi8gY29uc3QgQWN0aW9uVHlwZSA9IFMuTGl0ZXJhbChcInVwbG9hZFwiKTtcbi8qKlxuICogVmFsaWQgb3B0aW9ucyBmb3IgdGhlIGB1cGxvYWR0aGluZy1ob29rYCBoZWFkZXJcbiAqIGZvciByZXF1ZXN0cyBjb21pbmcgZnJvbSBVVCBzZXJ2ZXJcbiAqLyBjb25zdCBVcGxvYWRUaGluZ0hvb2sgPSBTLkxpdGVyYWwoXCJjYWxsYmFja1wiLCBcImVycm9yXCIpO1xuLyoqXG4gKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICogPT09PT09PT09PT09PT09PT09PT09PT09PT09IENvbmZpZ3VyYXRpb24gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAqID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gKi8gY29uc3QgRGVjb2RlU3RyaW5nID0gUy50cmFuc2Zvcm0oUy5VaW50OEFycmF5RnJvbVNlbGYsIFMuU3RyaW5nLCB7XG4gICAgZGVjb2RlOiAoZGF0YSk9Pm5ldyBUZXh0RGVjb2RlcigpLmRlY29kZShkYXRhKSxcbiAgICBlbmNvZGU6IChkYXRhKT0+bmV3IFRleHRFbmNvZGVyKCkuZW5jb2RlKGRhdGEpXG59KTtcbmNvbnN0IFBhcnNlZFRva2VuID0gUy5TdHJ1Y3Qoe1xuICAgIGFwaUtleTogUy5SZWRhY3RlZChTLlN0cmluZy5waXBlKFMuc3RhcnRzV2l0aChcInNrX1wiKSkpLFxuICAgIGFwcElkOiBTLlN0cmluZyxcbiAgICByZWdpb25zOiBTLk5vbkVtcHR5QXJyYXkoUy5TdHJpbmcpLFxuICAgIGluZ2VzdEhvc3Q6IFMuU3RyaW5nLnBpcGUoUy5vcHRpb25hbFdpdGgoe1xuICAgICAgICBkZWZhdWx0OiAoKT0+XCJpbmdlc3QudXBsb2FkdGhpbmcuY29tXCJcbiAgICB9KSlcbn0pO1xuY29uc3QgVXBsb2FkVGhpbmdUb2tlbiA9IFMuVWludDhBcnJheUZyb21CYXNlNjQucGlwZShTLmNvbXBvc2UoRGVjb2RlU3RyaW5nKSwgUy5jb21wb3NlKFMucGFyc2VKc29uKFBhcnNlZFRva2VuKSkpO1xuLyoqXG4gKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICogPT09PT09PT09PT09PT09PT09PT09PT09IEZpbGUgVHlwZSBIaWVyYXJjaHkgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAqLyAvKipcbiAqIFByb3BlcnRpZXMgZnJvbSB0aGUgd2ViIEZpbGUgb2JqZWN0LCB0aGlzIGlzIHdoYXQgdGhlIGNsaWVudCBzZW5kcyB3aGVuIGluaXRpYXRpbmcgYW4gdXBsb2FkXG4gKi8gY2xhc3MgRmlsZVVwbG9hZERhdGEgZXh0ZW5kcyBTLkNsYXNzKFwiRmlsZVVwbG9hZERhdGFcIikoe1xuICAgIG5hbWU6IFMuU3RyaW5nLFxuICAgIHNpemU6IFMuTnVtYmVyLFxuICAgIHR5cGU6IFMuU3RyaW5nLFxuICAgIGxhc3RNb2RpZmllZDogUy5OdW1iZXIucGlwZShTLm9wdGlvbmFsKVxufSkge1xufVxuLyoqXG4gKiBgLm1pZGRsZXdhcmUoKWAgY2FuIGFkZCBhIGN1c3RvbUlkIHRvIHRoZSBpbmNvbWluZyBmaWxlIGRhdGFcbiAqLyBjbGFzcyBGaWxlVXBsb2FkRGF0YVdpdGhDdXN0b21JZCBleHRlbmRzIEZpbGVVcGxvYWREYXRhLmV4dGVuZChcIkZpbGVVcGxvYWREYXRhV2l0aEN1c3RvbUlkXCIpKHtcbiAgICBjdXN0b21JZDogUy5OdWxsT3IoUy5TdHJpbmcpXG59KSB7XG59XG4vKipcbiAqIFdoZW4gZmlsZXMgYXJlIHVwbG9hZGVkLCB3ZSBnZXQgYmFja1xuICogLSBhIGtleVxuICogLSBhIGRpcmVjdCBVUkwgZm9yIHRoZSBmaWxlXG4gKiAtIGFuIGFwcC1zcGVjaWZpYyBVUkwgZm9yIHRoZSBmaWxlICh1c2VmdWwgZm9yIHNjb3BpbmcgZWcuIGZvciBvcHRpbWl6YXRpb24gYWxsb3dlZCBvcmlnaW5zKVxuICogLSB0aGUgaGFzaCAobWQ1LWhleCkgb2YgdGhlIHVwbG9hZGVkIGZpbGUncyBjb250ZW50c1xuICovIGNsYXNzIFVwbG9hZGVkRmlsZURhdGEgZXh0ZW5kcyBGaWxlVXBsb2FkRGF0YVdpdGhDdXN0b21JZC5leHRlbmQoXCJVcGxvYWRlZEZpbGVEYXRhXCIpKHtcbiAgICBrZXk6IFMuU3RyaW5nLFxuICAgIHVybDogUy5TdHJpbmcsXG4gICAgYXBwVXJsOiBTLlN0cmluZyxcbiAgICBmaWxlSGFzaDogUy5TdHJpbmdcbn0pIHtcbn1cbi8qKlxuICogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAqID09PT09PT09PT09PT09PT09PT09PT09PSBTZXJ2ZXIgUmVzcG9uc2UgU2NoZW1hcyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICovIGNsYXNzIE5ld1ByZXNpZ25lZFVybCBleHRlbmRzIFMuQ2xhc3MoXCJOZXdQcmVzaWduZWRVcmxcIikoe1xuICAgIHVybDogUy5TdHJpbmcsXG4gICAga2V5OiBTLlN0cmluZyxcbiAgICBjdXN0b21JZDogUy5OdWxsT3IoUy5TdHJpbmcpLFxuICAgIG5hbWU6IFMuU3RyaW5nXG59KSB7XG59XG5jbGFzcyBNZXRhZGF0YUZldGNoU3RyZWFtUGFydCBleHRlbmRzIFMuQ2xhc3MoXCJNZXRhZGF0YUZldGNoU3RyZWFtUGFydFwiKSh7XG4gICAgcGF5bG9hZDogUy5TdHJpbmcsXG4gICAgc2lnbmF0dXJlOiBTLlN0cmluZyxcbiAgICBob29rOiBVcGxvYWRUaGluZ0hvb2tcbn0pIHtcbn1cbmNsYXNzIE1ldGFkYXRhRmV0Y2hSZXNwb25zZSBleHRlbmRzIFMuQ2xhc3MoXCJNZXRhZGF0YUZldGNoUmVzcG9uc2VcIikoe1xuICAgIG9rOiBTLkJvb2xlYW5cbn0pIHtcbn1cbmNsYXNzIENhbGxiYWNrUmVzdWx0UmVzcG9uc2UgZXh0ZW5kcyBTLkNsYXNzKFwiQ2FsbGJhY2tSZXN1bHRSZXNwb25zZVwiKSh7XG4gICAgb2s6IFMuQm9vbGVhblxufSkge1xufVxuLyoqXG4gKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICogPT09PT09PT09PT09PT09PT09PT09PT09IENsaWVudCBBY3Rpb24gUGF5bG9hZHMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAqLyBjbGFzcyBVcGxvYWRBY3Rpb25QYXlsb2FkIGV4dGVuZHMgUy5DbGFzcyhcIlVwbG9hZEFjdGlvblBheWxvYWRcIikoe1xuICAgIGZpbGVzOiBTLkFycmF5KEZpbGVVcGxvYWREYXRhKSxcbiAgICBpbnB1dDogUy5Vbmtub3duXG59KSB7XG59XG5cbi8qKlxuICogTWVyZ2UgaW4gYGltcG9ydC5tZXRhLmVudmAgdG8gdGhlIGJ1aWx0LWluIGBwcm9jZXNzLmVudmAgcHJvdmlkZXJcbiAqIFByZWZpeCBrZXlzIHdpdGggYFVQTE9BRFRISU5HX2Agc28gd2UgY2FuIHJlZmVyZW5jZSBqdXN0IHRoZSBuYW1lLlxuICogQGV4YW1wbGVcbiAqIHByb2Nlc3MuZW52LlVQTE9BRFRISU5HX1RPS0VOID0gXCJmb29cIlxuICogQ29uZmlnLnN0cmluZyhcInRva2VuXCIpOyAvLyBDb25maWc8XCJmb29cIj5cbiAqLyBjb25zdCBlbnZQcm92aWRlciA9IENvbmZpZ1Byb3ZpZGVyLmZyb21FbnYoKS5waXBlKENvbmZpZ1Byb3ZpZGVyLm9yRWxzZSgoKT0+Q29uZmlnUHJvdmlkZXIuZnJvbU1hcChuZXcgTWFwKE9iamVjdC5lbnRyaWVzKGZpbHRlckRlZmluZWRPYmplY3RWYWx1ZXMoLy8gZnVjayB0aGlzIEkgZ2l2ZSB1cC4gaW1wb3J0Lm1ldGEgaXMgYSBtaXN0YWtlLCBzb21lb25lIGVsc2UgY2FuIGZpeCBpdFxuICAgIGltcG9ydC5tZXRhPy5lbnYgPz8ge30pKSksIHtcbiAgICAgICAgcGF0aERlbGltOiBcIl9cIlxuICAgIH0pKSwgQ29uZmlnUHJvdmlkZXIubmVzdGVkKFwidXBsb2FkdGhpbmdcIiksIENvbmZpZ1Byb3ZpZGVyLmNvbnN0YW50Q2FzZSk7XG4vKipcbiAqIENvbmZpZyBwcm92aWRlciB0aGF0IG1lcmdlcyB0aGUgb3B0aW9ucyBmcm9tIHRoZSBvYmplY3RcbiAqIGFuZCBlbnZpcm9ubWVudCB2YXJpYWJsZXMgcHJlZml4ZWQgd2l0aCBgVVBMT0FEVEhJTkdfYC5cbiAqIEByZW1hcmtzIE9wdGlvbnMgdGFrZSBwcmVjZWRlbmNlIG92ZXIgZW52aXJvbm1lbnQgdmFyaWFibGVzLlxuICovIGNvbnN0IGNvbmZpZ1Byb3ZpZGVyID0gKG9wdGlvbnMpPT5Db25maWdQcm92aWRlci5mcm9tSnNvbihvcHRpb25zID8/IHt9KS5waXBlKENvbmZpZ1Byb3ZpZGVyLm9yRWxzZSgoKT0+ZW52UHJvdmlkZXIpKTtcbmNvbnN0IElzRGV2ZWxvcG1lbnQgPSBDb25maWcuYm9vbGVhbihcImlzRGV2XCIpLnBpcGUoQ29uZmlnLm9yRWxzZSgoKT0+Q29uZmlnLnN1Y2NlZWQodHlwZW9mIHByb2Nlc3MgIT09IFwidW5kZWZpbmVkXCIgPyBwcm9jZXNzLmVudi5OT0RFX0VOViA6IHVuZGVmaW5lZCkucGlwZShDb25maWcubWFwKChfKT0+XyA9PT0gXCJkZXZlbG9wbWVudFwiKSkpLCBDb25maWcud2l0aERlZmF1bHQoZmFsc2UpKTtcbmNvbnN0IFVUVG9rZW4gPSBTLkNvbmZpZyhcInRva2VuXCIsIFVwbG9hZFRoaW5nVG9rZW4pLnBpcGUoRWZmZWN0LmNhdGNoVGFncyh7XG4gICAgQ29uZmlnRXJyb3I6IChlKT0+bmV3IFVwbG9hZFRoaW5nRXJyb3Ioe1xuICAgICAgICAgICAgY29kZTogZS5fb3AgPT09IFwiSW52YWxpZERhdGFcIiA/IFwiSU5WQUxJRF9TRVJWRVJfQ09ORklHXCIgOiBcIk1JU1NJTkdfRU5WXCIsXG4gICAgICAgICAgICBtZXNzYWdlOiBlLl9vcCA9PT0gXCJJbnZhbGlkRGF0YVwiID8gXCJJbnZhbGlkIHRva2VuLiBBIHRva2VuIGlzIGEgYmFzZTY0IGVuY29kZWQgSlNPTiBvYmplY3QgbWF0Y2hpbmcgeyBhcGlLZXk6IHN0cmluZywgYXBwSWQ6IHN0cmluZywgcmVnaW9uczogc3RyaW5nW10gfS5cIiA6IFwiTWlzc2luZyB0b2tlbi4gUGxlYXNlIHNldCB0aGUgYFVQTE9BRFRISU5HX1RPS0VOYCBlbnZpcm9ubWVudCB2YXJpYWJsZSBvciBwcm92aWRlIGEgdG9rZW4gbWFudWFsbHkgdGhyb3VnaCBjb25maWcuXCIsXG4gICAgICAgICAgICBjYXVzZTogZVxuICAgICAgICB9KVxufSkpO1xuQ29uZmlnLnN0cmluZyhcImFwaVVybFwiKS5waXBlKENvbmZpZy53aXRoRGVmYXVsdChcImh0dHBzOi8vYXBpLnVwbG9hZHRoaW5nLmNvbVwiKSwgQ29uZmlnLm1hcEF0dGVtcHQoKF8pPT5uZXcgVVJMKF8pKSwgQ29uZmlnLm1hcCgodXJsKT0+dXJsLmhyZWYucmVwbGFjZSgvXFwvJC8sIFwiXCIpKSk7XG5jb25zdCBJbmdlc3RVcmwgPSBFZmZlY3QuZ2VuKGZ1bmN0aW9uKigpIHtcbiAgICBjb25zdCB7IHJlZ2lvbnMsIGluZ2VzdEhvc3QgfSA9IHlpZWxkKiBVVFRva2VuO1xuICAgIGNvbnN0IHJlZ2lvbiA9IHJlZ2lvbnNbMF07IC8vIEN1cnJlbnRseSBvbmx5IHN1cHBvcnQgMSByZWdpb24gcGVyIGFwcFxuICAgIHJldHVybiB5aWVsZCogQ29uZmlnLnN0cmluZyhcImluZ2VzdFVybFwiKS5waXBlKENvbmZpZy53aXRoRGVmYXVsdChgaHR0cHM6Ly8ke3JlZ2lvbn0uJHtpbmdlc3RIb3N0fWApLCBDb25maWcubWFwQXR0ZW1wdCgoXyk9Pm5ldyBVUkwoXykpLCBDb25maWcubWFwKCh1cmwpPT51cmwuaHJlZi5yZXBsYWNlKC9cXC8kLywgXCJcIikpKTtcbn0pO1xuXG5mdW5jdGlvbiBkZWZhdWx0RXJyb3JGb3JtYXR0ZXIoZXJyb3IpIHtcbiAgICByZXR1cm4ge1xuICAgICAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlXG4gICAgfTtcbn1cbmZ1bmN0aW9uIGZvcm1hdEVycm9yKGVycm9yLCByb3V0ZXIpIHtcbiAgICBjb25zdCBlcnJvckZvcm1hdHRlciA9IHJvdXRlcltPYmplY3Qua2V5cyhyb3V0ZXIpWzBdXT8uX2RlZi5lcnJvckZvcm1hdHRlciA/PyBkZWZhdWx0RXJyb3JGb3JtYXR0ZXI7XG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby11bnNhZmUtcmV0dXJuXG4gICAgcmV0dXJuIGVycm9yRm9ybWF0dGVyKGVycm9yKTtcbn1cblxuY29uc3QgaGFuZGxlSnNvbkxpbmVTdHJlYW0gPSAoc2NoZW1hLCBvbkNodW5rKT0+KHN0cmVhbSk9PntcbiAgICAgICAgbGV0IGJ1ZiA9IFwiXCI7XG4gICAgICAgIHJldHVybiBzdHJlYW0ucGlwZShTdHJlYW0uZGVjb2RlVGV4dCgpLCBTdHJlYW0ubWFwRWZmZWN0KChjaHVuayk9PkVmZmVjdC5nZW4oZnVuY3Rpb24qKCkge1xuICAgICAgICAgICAgICAgIGJ1ZiArPSBjaHVuaztcbiAgICAgICAgICAgICAgICAvLyBTY2FuIGJ1ZmZlciBmb3IgbmV3bGluZXNcbiAgICAgICAgICAgICAgICBjb25zdCBwYXJ0cyA9IGJ1Zi5zcGxpdChcIlxcblwiKTtcbiAgICAgICAgICAgICAgICBjb25zdCB2YWxpZENodW5rcyA9IFtdO1xuICAgICAgICAgICAgICAgIGZvciAoY29uc3QgcGFydCBvZiBwYXJ0cyl7XG4gICAgICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBBdHRlbXB0IHRvIHBhcnNlIGNodW5rIGFzIEpTT05cbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbGlkQ2h1bmtzLnB1c2goSlNPTi5wYXJzZShwYXJ0KSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBBZHZhbmNlIGJ1ZmZlciBpZiBwYXJzaW5nIHN1Y2NlZWRlZFxuICAgICAgICAgICAgICAgICAgICAgICAgYnVmID0gYnVmLnNsaWNlKHBhcnQubGVuZ3RoICsgMSk7XG4gICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggIHtcbiAgICAgICAgICAgICAgICAgICAgLy9cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB5aWVsZCogRWZmZWN0LmxvZ0RlYnVnKFwiUmVjZWl2ZWQgY2h1bmtzXCIpLnBpcGUoRWZmZWN0LmFubm90YXRlTG9ncyhcImNodW5rXCIsIGNodW5rKSwgRWZmZWN0LmFubm90YXRlTG9ncyhcInBhcnNlZENodW5rc1wiLCB2YWxpZENodW5rcyksIEVmZmVjdC5hbm5vdGF0ZUxvZ3MoXCJidWZcIiwgYnVmKSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHZhbGlkQ2h1bmtzO1xuICAgICAgICAgICAgfSkpLCBTdHJlYW0ubWFwRWZmZWN0KFMuZGVjb2RlVW5rbm93bihTLkFycmF5KHNjaGVtYSkpKSwgU3RyZWFtLm1hcEVmZmVjdChFZmZlY3QuZm9yRWFjaCgocGFydCk9Pm9uQ2h1bmsocGFydCkpKSwgU3RyZWFtLnJ1bkRyYWluLCBFZmZlY3Qud2l0aExvZ1NwYW4oXCJoYW5kbGVKc29uTGluZVN0cmVhbVwiKSk7XG4gICAgfTtcblxuY29uc3Qgd2l0aE1pbmltYWxMb2dMZXZlbCA9IENvbmZpZy5sb2dMZXZlbChcImxvZ0xldmVsXCIpLnBpcGUoQ29uZmlnLndpdGhEZWZhdWx0KExvZ0xldmVsLkluZm8pLCBFZmZlY3QuYW5kVGhlbigobGV2ZWwpPT5Mb2dnZXIubWluaW11bUxvZ0xldmVsKGxldmVsKSksIEVmZmVjdC50YXBFcnJvcigoZSk9PkVmZmVjdC5sb2dFcnJvcihcIkludmFsaWQgbG9nIGxldmVsXCIpLnBpcGUoRWZmZWN0LmFubm90YXRlTG9ncyhcImVycm9yXCIsIGUpKSksIEVmZmVjdC5jYXRjaFRhZyhcIkNvbmZpZ0Vycm9yXCIsIChlKT0+bmV3IFVwbG9hZFRoaW5nRXJyb3Ioe1xuICAgICAgICBjb2RlOiBcIklOVkFMSURfU0VSVkVSX0NPTkZJR1wiLFxuICAgICAgICBtZXNzYWdlOiBcIkludmFsaWQgc2VydmVyIGNvbmZpZ3VyYXRpb25cIixcbiAgICAgICAgY2F1c2U6IGVcbiAgICB9KSksIExheWVyLnVud3JhcEVmZmVjdCk7XG5jb25zdCBMb2dGb3JtYXQgPSBDb25maWcubGl0ZXJhbChcImpzb25cIiwgXCJsb2dGbXRcIiwgXCJzdHJ1Y3R1cmVkXCIsIFwicHJldHR5XCIpKFwibG9nRm9ybWF0XCIpO1xuY29uc3Qgd2l0aExvZ0Zvcm1hdCA9IEVmZmVjdC5nZW4oZnVuY3Rpb24qKCkge1xuICAgIGNvbnN0IGlzRGV2ID0geWllbGQqIElzRGV2ZWxvcG1lbnQ7XG4gICAgY29uc3QgbG9nRm9ybWF0ID0geWllbGQqIExvZ0Zvcm1hdC5waXBlKENvbmZpZy53aXRoRGVmYXVsdChpc0RldiA/IFwicHJldHR5XCIgOiBcImpzb25cIikpO1xuICAgIHJldHVybiBMb2dnZXJbbG9nRm9ybWF0XTtcbn0pLnBpcGUoRWZmZWN0LmNhdGNoVGFnKFwiQ29uZmlnRXJyb3JcIiwgKGUpPT5uZXcgVXBsb2FkVGhpbmdFcnJvcih7XG4gICAgICAgIGNvZGU6IFwiSU5WQUxJRF9TRVJWRVJfQ09ORklHXCIsXG4gICAgICAgIG1lc3NhZ2U6IFwiSW52YWxpZCBzZXJ2ZXIgY29uZmlndXJhdGlvblwiLFxuICAgICAgICBjYXVzZTogZVxuICAgIH0pKSwgTGF5ZXIudW53cmFwRWZmZWN0KTtcbmNvbnN0IGxvZ0h0dHBDbGllbnRSZXNwb25zZSA9IChtZXNzYWdlLCBvcHRzKT0+e1xuICAgIGNvbnN0IG1peGluID0gb3B0cz8ubWl4aW4gPz8gXCJqc29uXCI7XG4gICAgY29uc3QgbGV2ZWwgPSBMb2dMZXZlbC5mcm9tTGl0ZXJhbChvcHRzPy5sZXZlbCA/PyBcIkRlYnVnXCIpO1xuICAgIHJldHVybiAocmVzcG9uc2UpPT5FZmZlY3QuZmxhdE1hcChtaXhpbiAhPT0gXCJOb25lXCIgPyByZXNwb25zZVttaXhpbl0gOiBFZmZlY3Qudm9pZCwgKCk9PkVmZmVjdC5sb2dXaXRoTGV2ZWwobGV2ZWwsIGAke21lc3NhZ2V9ICgke3Jlc3BvbnNlLnN0YXR1c30pYCkucGlwZShFZmZlY3QuYW5ub3RhdGVMb2dzKFwicmVzcG9uc2VcIiwgcmVzcG9uc2UpKSk7XG59O1xuY29uc3QgbG9nSHR0cENsaWVudEVycm9yID0gKG1lc3NhZ2UpPT4oZXJyKT0+ZXJyLl90YWcgPT09IFwiUmVzcG9uc2VFcnJvclwiID8gbG9nSHR0cENsaWVudFJlc3BvbnNlKG1lc3NhZ2UsIHtcbiAgICAgICAgICAgIGxldmVsOiBcIkVycm9yXCJcbiAgICAgICAgfSkoZXJyLnJlc3BvbnNlKSA6IEVmZmVjdC5sb2dFcnJvcihtZXNzYWdlKS5waXBlKEVmZmVjdC5hbm5vdGF0ZUxvZ3MoXCJlcnJvclwiLCBlcnIpKTtcblxuZnVuY3Rpb24gZ2V0UGFyc2VGbihwYXJzZXIpIHtcbiAgICBpZiAodHlwZW9mIHBhcnNlci5wYXJzZSA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgIHJldHVybiBwYXJzZXIucGFyc2U7XG4gICAgfVxuICAgIHRocm93IG5ldyBFcnJvcihcIkludmFsaWQgcGFyc2VyXCIpO1xufVxuXG5jbGFzcyBGaWxlU2l6ZU1pc21hdGNoIGV4dGVuZHMgRGF0YS5FcnJvciB7XG4gICAgY29uc3RydWN0b3IodHlwZSwgbWF4LCBhY3R1YWwpe1xuICAgICAgICBjb25zdCByZWFzb24gPSBgWW91IHVwbG9hZGVkIGEgJHt0eXBlfSBmaWxlIHRoYXQgd2FzICR7Ynl0ZXNUb0ZpbGVTaXplKGFjdHVhbCl9LCBidXQgdGhlIGxpbWl0IGZvciB0aGF0IHR5cGUgaXMgJHttYXh9YDtcbiAgICAgICAgc3VwZXIoe1xuICAgICAgICAgICAgcmVhc29uXG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLl90YWcgPSBcIkZpbGVTaXplTWlzbWF0Y2hcIjtcbiAgICAgICAgdGhpcy5uYW1lID0gXCJGaWxlU2l6ZU1pc21hdGNoRXJyb3JcIjtcbiAgICB9XG59XG5jbGFzcyBGaWxlQ291bnRNaXNtYXRjaCBleHRlbmRzIERhdGEuRXJyb3Ige1xuICAgIGNvbnN0cnVjdG9yKHR5cGUsIGJvdW5kdHlwZSwgYm91bmQsIGFjdHVhbCl7XG4gICAgICAgIGNvbnN0IHJlYXNvbiA9IGBZb3UgdXBsb2FkZWQgJHthY3R1YWx9IGZpbGUocykgb2YgdHlwZSAnJHt0eXBlfScsIGJ1dCB0aGUgJHtib3VuZHR5cGV9IGZvciB0aGF0IHR5cGUgaXMgJHtib3VuZH1gO1xuICAgICAgICBzdXBlcih7XG4gICAgICAgICAgICByZWFzb25cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuX3RhZyA9IFwiRmlsZUNvdW50TWlzbWF0Y2hcIjtcbiAgICAgICAgdGhpcy5uYW1lID0gXCJGaWxlQ291bnRNaXNtYXRjaEVycm9yXCI7XG4gICAgfVxufVxuLy8gVmVyaWZ5IHRoYXQgdGhlIHVwbG9hZGVkIGZpbGVzIGRvZXNuJ3QgdmlvbGF0ZSB0aGUgcm91dGUgY29uZmlnLFxuLy8gZS5nLiB1cGxvYWRpbmcgbW9yZSB2aWRlb3MgdGhhbiBhbGxvd2VkLCBvciBhIGZpbGUgdGhhdCBpcyBsYXJnZXIgdGhhbiBhbGxvd2VkLlxuLy8gVGhpcyBpcyBkb3VibGUtY2hlY2tlZCBvbiBpbmZyYSBzaWRlLCBidXQgd2Ugd2FudCB0byBmYWlsIGVhcmx5IHRvIGF2b2lkIG5ldHdvcmsgbGF0ZW5jeS5cbmNvbnN0IGFzc2VydEZpbGVzTWVldENvbmZpZyA9IChmaWxlcywgcm91dGVDb25maWcpPT5FZmZlY3QuZ2VuKGZ1bmN0aW9uKigpIHtcbiAgICAgICAgY29uc3QgY291bnRzID0ge307XG4gICAgICAgIGZvciAoY29uc3QgZmlsZSBvZiBmaWxlcyl7XG4gICAgICAgICAgICBjb25zdCB0eXBlID0geWllbGQqIG1hdGNoRmlsZVR5cGUoZmlsZSwgb2JqZWN0S2V5cyhyb3V0ZUNvbmZpZykpO1xuICAgICAgICAgICAgY291bnRzW3R5cGVdID0gKGNvdW50c1t0eXBlXSA/PyAwKSArIDE7XG4gICAgICAgICAgICBjb25zdCBzaXplTGltaXQgPSByb3V0ZUNvbmZpZ1t0eXBlXT8ubWF4RmlsZVNpemU7XG4gICAgICAgICAgICBpZiAoIXNpemVMaW1pdCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB5aWVsZCogbmV3IEludmFsaWRSb3V0ZUNvbmZpZ0Vycm9yKHR5cGUsIFwibWF4RmlsZVNpemVcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCBzaXplTGltaXRCeXRlcyA9IHlpZWxkKiBmaWxlU2l6ZVRvQnl0ZXMoc2l6ZUxpbWl0KTtcbiAgICAgICAgICAgIGlmIChmaWxlLnNpemUgPiBzaXplTGltaXRCeXRlcykge1xuICAgICAgICAgICAgICAgIHJldHVybiB5aWVsZCogbmV3IEZpbGVTaXplTWlzbWF0Y2godHlwZSwgc2l6ZUxpbWl0LCBmaWxlLnNpemUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGZvcihjb25zdCBfa2V5IGluIGNvdW50cyl7XG4gICAgICAgICAgICBjb25zdCBrZXkgPSBfa2V5O1xuICAgICAgICAgICAgY29uc3QgY29uZmlnID0gcm91dGVDb25maWdba2V5XTtcbiAgICAgICAgICAgIGlmICghY29uZmlnKSByZXR1cm4geWllbGQqIG5ldyBJbnZhbGlkUm91dGVDb25maWdFcnJvcihrZXkpO1xuICAgICAgICAgICAgY29uc3QgY291bnQgPSBjb3VudHNba2V5XTtcbiAgICAgICAgICAgIGNvbnN0IG1pbiA9IGNvbmZpZy5taW5GaWxlQ291bnQ7XG4gICAgICAgICAgICBjb25zdCBtYXggPSBjb25maWcubWF4RmlsZUNvdW50O1xuICAgICAgICAgICAgaWYgKG1pbiA+IG1heCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB5aWVsZCogbmV3IFVwbG9hZFRoaW5nRXJyb3Ioe1xuICAgICAgICAgICAgICAgICAgICBjb2RlOiBcIkJBRF9SRVFVRVNUXCIsXG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IFwiSW52YWxpZCBjb25maWcgZHVyaW5nIGZpbGUgY291bnQgLSBtaW5GaWxlQ291bnQgPiBtYXhGaWxlQ291bnRcIixcbiAgICAgICAgICAgICAgICAgICAgY2F1c2U6IGBtaW5GaWxlQ291bnQgbXVzdCBiZSBsZXNzIHRoYW4gbWF4RmlsZUNvdW50IGZvciBrZXkgJHtrZXl9LiBnb3Q6ICR7bWlufSA+ICR7bWF4fWBcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChjb3VudCA8IG1pbikge1xuICAgICAgICAgICAgICAgIHJldHVybiB5aWVsZCogbmV3IEZpbGVDb3VudE1pc21hdGNoKGtleSwgXCJtaW5pbXVtXCIsIG1pbiwgY291bnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGNvdW50ID4gbWF4KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHlpZWxkKiBuZXcgRmlsZUNvdW50TWlzbWF0Y2goa2V5LCBcIm1heGltdW1cIiwgbWF4LCBjb3VudCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfSk7XG5jb25zdCBleHRyYWN0Um91dGVyQ29uZmlnID0gKHJvdXRlcik9PkVmZmVjdC5mb3JFYWNoKG9iamVjdEtleXMocm91dGVyKSwgKHNsdWcpPT5FZmZlY3QubWFwKGZpbGxJbnB1dFJvdXRlQ29uZmlnKHJvdXRlcltzbHVnXS5fZGVmLnJvdXRlckNvbmZpZyksIChjb25maWcpPT4oe1xuICAgICAgICAgICAgICAgIHNsdWcsXG4gICAgICAgICAgICAgICAgY29uZmlnXG4gICAgICAgICAgICB9KSkpO1xuXG5jb25zdCBtYWtlUnVudGltZSA9IChmZXRjaCwgY29uZmlnKT0+e1xuICAgIGNvbnN0IGZldGNoSHR0cENsaWVudCA9IExheWVyLnByb3ZpZGVNZXJnZShGZXRjaEh0dHBDbGllbnQubGF5ZXIsIExheWVyLnN1Y2NlZWQoRmV0Y2hIdHRwQ2xpZW50LkZldGNoLCBmZXRjaCkpO1xuICAgIGNvbnN0IHdpdGhSZWRhY3RlZEhlYWRlcnMgPSBMYXllci5lZmZlY3REaXNjYXJkKEZpYmVyUmVmLnVwZGF0ZShIZWFkZXJzLmN1cnJlbnRSZWRhY3RlZE5hbWVzLCAoXyk9Pl8uY29uY2F0KFtcbiAgICAgICAgICAgIFwieC11cGxvYWR0aGluZy1hcGkta2V5XCJcbiAgICAgICAgXSkpKTtcbiAgICBjb25zdCBsYXllciA9IExheWVyLnByb3ZpZGUoTGF5ZXIubWVyZ2VBbGwod2l0aExvZ0Zvcm1hdCwgd2l0aE1pbmltYWxMb2dMZXZlbCwgZmV0Y2hIdHRwQ2xpZW50LCB3aXRoUmVkYWN0ZWRIZWFkZXJzKSwgTGF5ZXIuc2V0Q29uZmlnUHJvdmlkZXIoY29uZmlnUHJvdmlkZXIoY29uZmlnKSkpO1xuICAgIHJldHVybiBNYW5hZ2VkUnVudGltZS5tYWtlKGxheWVyKTtcbn07XG5cbmNsYXNzIE1pZGRsZXdhcmVBcmd1bWVudHMgZXh0ZW5kcyBDb250ZXh0LlRhZyhcInVwbG9hZHRoaW5nL01pZGRsZXdhcmVBcmd1bWVudHNcIikoKSB7XG59XG5jb25zdCBtYWtlQWRhcHRlckhhbmRsZXIgPSAobWFrZU1pZGRsZXdhcmVBcmdzLCB0b1JlcXVlc3QsIG9wdHMsIGJlQWRhcHRlcik9PntcbiAgICBjb25zdCBtYW5hZ2VkID0gbWFrZVJ1bnRpbWUob3B0cy5jb25maWc/LmZldGNoLCBvcHRzLmNvbmZpZyk7XG4gICAgY29uc3QgaGFuZGxlID0gRWZmZWN0LnByb21pc2UoKCk9Pm1hbmFnZWQucnVudGltZSgpLnRoZW4oSHR0cEFwcC50b1dlYkhhbmRsZXJSdW50aW1lKSk7XG4gICAgY29uc3QgYXBwID0gKC4uLmFyZ3MpPT5FZmZlY3QubWFwKEVmZmVjdC5wcm9taXNlKCgpPT5tYW5hZ2VkLnJ1blByb21pc2UoY3JlYXRlUmVxdWVzdEhhbmRsZXIob3B0cywgYmVBZGFwdGVyKSkpLCBFZmZlY3QucHJvdmlkZVNlcnZpY2VFZmZlY3QoTWlkZGxld2FyZUFyZ3VtZW50cywgbWFrZU1pZGRsZXdhcmVBcmdzKC4uLmFyZ3MpKSk7XG4gICAgcmV0dXJuIGFzeW5jICguLi5hcmdzKT0+e1xuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBoYW5kbGUucGlwZShFZmZlY3QuYXAoYXBwKC4uLmFyZ3MpKSwgRWZmZWN0LmFwKHRvUmVxdWVzdCguLi5hcmdzKSksIEVmZmVjdC53aXRoTG9nU3BhbihcInJlcXVlc3RIYW5kbGVyXCIpLCBtYW5hZ2VkLnJ1blByb21pc2UpO1xuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH07XG59O1xuY29uc3QgY3JlYXRlUmVxdWVzdEhhbmRsZXIgPSAob3B0cywgYmVBZGFwdGVyKT0+RWZmZWN0LmdlbihmdW5jdGlvbiooKSB7XG4gICAgICAgIGNvbnN0IGlzRGV2ZWxvcG1lbnQgPSB5aWVsZCogSXNEZXZlbG9wbWVudDtcbiAgICAgICAgY29uc3Qgcm91dGVyQ29uZmlnID0geWllbGQqIGV4dHJhY3RSb3V0ZXJDb25maWcob3B0cy5yb3V0ZXIpO1xuICAgICAgICBjb25zdCBoYW5kbGVEYWVtb24gPSAoKCk9PntcbiAgICAgICAgICAgIGlmIChvcHRzLmNvbmZpZz8uaGFuZGxlRGFlbW9uUHJvbWlzZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBvcHRzLmNvbmZpZy5oYW5kbGVEYWVtb25Qcm9taXNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGlzRGV2ZWxvcG1lbnQgPyBcInZvaWRcIiA6IFwiYXdhaXRcIjtcbiAgICAgICAgfSkoKTtcbiAgICAgICAgaWYgKGlzRGV2ZWxvcG1lbnQgJiYgaGFuZGxlRGFlbW9uID09PSBcImF3YWl0XCIpIHtcbiAgICAgICAgICAgIHJldHVybiB5aWVsZCogbmV3IFVwbG9hZFRoaW5nRXJyb3Ioe1xuICAgICAgICAgICAgICAgIGNvZGU6IFwiSU5WQUxJRF9TRVJWRVJfQ09ORklHXCIsXG4gICAgICAgICAgICAgICAgbWVzc2FnZTogJ2hhbmRsZURhZW1vblByb21pc2U6IFwiYXdhaXRcIiBpcyBmb3JiaWRkZW4gaW4gZGV2ZWxvcG1lbnQuJ1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgR0VUID0gRWZmZWN0LmdlbihmdW5jdGlvbiooKSB7XG4gICAgICAgICAgICByZXR1cm4geWllbGQqIEh0dHBTZXJ2ZXJSZXNwb25zZS5qc29uKHJvdXRlckNvbmZpZyk7XG4gICAgICAgIH0pO1xuICAgICAgICBjb25zdCBQT1NUID0gRWZmZWN0LmdlbihmdW5jdGlvbiooKSB7XG4gICAgICAgICAgICBjb25zdCB7IFwidXBsb2FkdGhpbmctaG9va1wiOiB1cGxvYWR0aGluZ0hvb2ssIFwieC11cGxvYWR0aGluZy1wYWNrYWdlXCI6IGZlUGFja2FnZSwgXCJ4LXVwbG9hZHRoaW5nLXZlcnNpb25cIjogY2xpZW50VmVyc2lvbiB9ID0geWllbGQqIEh0dHBTZXJ2ZXJSZXF1ZXN0LnNjaGVtYUhlYWRlcnMoUy5TdHJ1Y3Qoe1xuICAgICAgICAgICAgICAgIFwidXBsb2FkdGhpbmctaG9va1wiOiBVcGxvYWRUaGluZ0hvb2sucGlwZShTLm9wdGlvbmFsKSxcbiAgICAgICAgICAgICAgICBcIngtdXBsb2FkdGhpbmctcGFja2FnZVwiOiBTLlN0cmluZy5waXBlKFMub3B0aW9uYWxXaXRoKHtcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDogKCk9PlwidW5rbm93blwiXG4gICAgICAgICAgICAgICAgfSkpLFxuICAgICAgICAgICAgICAgIFwieC11cGxvYWR0aGluZy12ZXJzaW9uXCI6IFMuU3RyaW5nLnBpcGUoUy5vcHRpb25hbFdpdGgoe1xuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OiAoKT0+dmVyc2lvblxuICAgICAgICAgICAgICAgIH0pKVxuICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgaWYgKGNsaWVudFZlcnNpb24gIT09IHZlcnNpb24pIHtcbiAgICAgICAgICAgICAgICBjb25zdCBzZXJ2ZXJWZXJzaW9uID0gdmVyc2lvbjtcbiAgICAgICAgICAgICAgICB5aWVsZCogRWZmZWN0LmxvZ1dhcm5pbmcoXCJDbGllbnQgdmVyc2lvbiBtaXNtYXRjaC4gVGhpbmdzIG1heSBub3Qgd29yayBhcyBleHBlY3RlZCwgcGxlYXNlIHN5bmMgeW91ciB2ZXJzaW9ucyB0byBlbnN1cmUgY29tcGF0aWJpbGl0eS5cIikucGlwZShFZmZlY3QuYW5ub3RhdGVMb2dzKHtcbiAgICAgICAgICAgICAgICAgICAgY2xpZW50VmVyc2lvbixcbiAgICAgICAgICAgICAgICAgICAgc2VydmVyVmVyc2lvblxuICAgICAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IHsgc2x1ZywgYWN0aW9uVHlwZSB9ID0geWllbGQqIEh0dHBSb3V0ZXIuc2NoZW1hUGFyYW1zKFMuU3RydWN0KHtcbiAgICAgICAgICAgICAgICBhY3Rpb25UeXBlOiBBY3Rpb25UeXBlLnBpcGUoUy5vcHRpb25hbCksXG4gICAgICAgICAgICAgICAgc2x1ZzogUy5TdHJpbmdcbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgIGNvbnN0IHVwbG9hZGFibGUgPSBvcHRzLnJvdXRlcltzbHVnXTtcbiAgICAgICAgICAgIGlmICghdXBsb2FkYWJsZSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IG1zZyA9IGBObyBmaWxlIHJvdXRlIGZvdW5kIGZvciBzbHVnICR7c2x1Z31gO1xuICAgICAgICAgICAgICAgIHlpZWxkKiBFZmZlY3QubG9nRXJyb3IobXNnKTtcbiAgICAgICAgICAgICAgICByZXR1cm4geWllbGQqIG5ldyBVcGxvYWRUaGluZ0Vycm9yKHtcbiAgICAgICAgICAgICAgICAgICAgY29kZTogXCJOT1RfRk9VTkRcIixcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogbXNnXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCB7IGJvZHksIGZpYmVyIH0gPSB5aWVsZCogTWF0Y2gudmFsdWUoe1xuICAgICAgICAgICAgICAgIGFjdGlvblR5cGUsXG4gICAgICAgICAgICAgICAgdXBsb2FkdGhpbmdIb29rXG4gICAgICAgICAgICB9KS5waXBlKE1hdGNoLndoZW4oe1xuICAgICAgICAgICAgICAgIGFjdGlvblR5cGU6IFwidXBsb2FkXCIsXG4gICAgICAgICAgICAgICAgdXBsb2FkdGhpbmdIb29rOiB1bmRlZmluZWRcbiAgICAgICAgICAgIH0sICgpPT5oYW5kbGVVcGxvYWRBY3Rpb24oe1xuICAgICAgICAgICAgICAgICAgICB1cGxvYWRhYmxlLFxuICAgICAgICAgICAgICAgICAgICBmZVBhY2thZ2UsXG4gICAgICAgICAgICAgICAgICAgIGJlQWRhcHRlcixcbiAgICAgICAgICAgICAgICAgICAgc2x1Z1xuICAgICAgICAgICAgICAgIH0pKSwgTWF0Y2gud2hlbih7XG4gICAgICAgICAgICAgICAgYWN0aW9uVHlwZTogdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgIHVwbG9hZHRoaW5nSG9vazogXCJjYWxsYmFja1wiXG4gICAgICAgICAgICB9LCAoKT0+aGFuZGxlQ2FsbGJhY2tSZXF1ZXN0KHtcbiAgICAgICAgICAgICAgICAgICAgdXBsb2FkYWJsZSxcbiAgICAgICAgICAgICAgICAgICAgZmVQYWNrYWdlLFxuICAgICAgICAgICAgICAgICAgICBiZUFkYXB0ZXJcbiAgICAgICAgICAgICAgICB9KSksIE1hdGNoLndoZW4oe1xuICAgICAgICAgICAgICAgIGFjdGlvblR5cGU6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICB1cGxvYWR0aGluZ0hvb2s6IFwiZXJyb3JcIlxuICAgICAgICAgICAgfSwgKCk9PmhhbmRsZUVycm9yUmVxdWVzdCh7XG4gICAgICAgICAgICAgICAgICAgIHVwbG9hZGFibGVcbiAgICAgICAgICAgICAgICB9KSksIE1hdGNoLm9yRWxzZSgoKT0+RWZmZWN0LnN1Y2NlZWQoe1xuICAgICAgICAgICAgICAgICAgICBib2R5OiBudWxsLFxuICAgICAgICAgICAgICAgICAgICBmaWJlcjogbnVsbFxuICAgICAgICAgICAgICAgIH0pKSk7XG4gICAgICAgICAgICBpZiAoZmliZXIpIHtcbiAgICAgICAgICAgICAgICB5aWVsZCogRWZmZWN0LmxvZ0RlYnVnKFwiUnVubmluZyBmaWJlciBhcyBkYWVtb25cIikucGlwZShFZmZlY3QuYW5ub3RhdGVMb2dzKFwiaGFuZGxlRGFlbW9uXCIsIGhhbmRsZURhZW1vbikpO1xuICAgICAgICAgICAgICAgIGlmIChoYW5kbGVEYWVtb24gPT09IFwidm9pZFwiKSA7IGVsc2UgaWYgKGhhbmRsZURhZW1vbiA9PT0gXCJhd2FpdFwiKSB7XG4gICAgICAgICAgICAgICAgICAgIHlpZWxkKiBmaWJlci5hd2FpdDtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBoYW5kbGVEYWVtb24gPT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgICAgICAgICAgICAgICBoYW5kbGVEYWVtb24oRWZmZWN0LnJ1blByb21pc2UoZmliZXIuYXdhaXQpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB5aWVsZCogRWZmZWN0LmxvZ0RlYnVnKFwiU2VuZGluZyByZXNwb25zZVwiKS5waXBlKEVmZmVjdC5hbm5vdGF0ZUxvZ3MoXCJib2R5XCIsIGJvZHkpKTtcbiAgICAgICAgICAgIHJldHVybiB5aWVsZCogSHR0cFNlcnZlclJlc3BvbnNlLmpzb24oYm9keSk7XG4gICAgICAgIH0pLnBpcGUoRWZmZWN0LmNhdGNoVGFncyh7XG4gICAgICAgICAgICBQYXJzZUVycm9yOiAoZSk9Pkh0dHBTZXJ2ZXJSZXNwb25zZS5qc29uKGZvcm1hdEVycm9yKG5ldyBVcGxvYWRUaGluZ0Vycm9yKHtcbiAgICAgICAgICAgICAgICAgICAgY29kZTogXCJCQURfUkVRVUVTVFwiLFxuICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiBcIkludmFsaWQgaW5wdXRcIixcbiAgICAgICAgICAgICAgICAgICAgY2F1c2U6IGUubWVzc2FnZVxuICAgICAgICAgICAgICAgIH0pLCBvcHRzLnJvdXRlciksIHtcbiAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiA0MDBcbiAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgIFVwbG9hZFRoaW5nRXJyb3I6IChlKT0+Ly8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby11bnNhZmUtYXJndW1lbnRcbiAgICAgICAgICAgICAgICBIdHRwU2VydmVyUmVzcG9uc2UuanNvbihmb3JtYXRFcnJvcihlLCBvcHRzLnJvdXRlciksIHtcbiAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiBnZXRTdGF0dXNDb2RlRnJvbUVycm9yKGUpXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgfSkpO1xuICAgICAgICBjb25zdCBhcHBlbmRSZXNwb25zZUhlYWRlcnMgPSBFZmZlY3QubWFwKEh0dHBTZXJ2ZXJSZXNwb25zZS5zZXRIZWFkZXIoXCJ4LXVwbG9hZHRoaW5nLXZlcnNpb25cIiwgdmVyc2lvbikpO1xuICAgICAgICByZXR1cm4gSHR0cFJvdXRlci5lbXB0eS5waXBlKEh0dHBSb3V0ZXIuZ2V0KFwiKlwiLCBHRVQpLCBIdHRwUm91dGVyLnBvc3QoXCIqXCIsIFBPU1QpLCBIdHRwUm91dGVyLnVzZShhcHBlbmRSZXNwb25zZUhlYWRlcnMpKTtcbiAgICB9KS5waXBlKEVmZmVjdC53aXRoTG9nU3BhbihcImNyZWF0ZVJlcXVlc3RIYW5kbGVyXCIpKTtcbmNvbnN0IGhhbmRsZUVycm9yUmVxdWVzdCA9IChvcHRzKT0+RWZmZWN0LmdlbihmdW5jdGlvbiooKSB7XG4gICAgICAgIGNvbnN0IHsgdXBsb2FkYWJsZSB9ID0gb3B0cztcbiAgICAgICAgY29uc3QgcmVxdWVzdCA9IHlpZWxkKiBIdHRwU2VydmVyUmVxdWVzdC5IdHRwU2VydmVyUmVxdWVzdDtcbiAgICAgICAgY29uc3QgeyBhcGlLZXkgfSA9IHlpZWxkKiBVVFRva2VuO1xuICAgICAgICBjb25zdCB2ZXJpZmllZCA9IHlpZWxkKiB2ZXJpZnlTaWduYXR1cmUoKHlpZWxkKiByZXF1ZXN0LnRleHQpLCByZXF1ZXN0LmhlYWRlcnNbXCJ4LXVwbG9hZHRoaW5nLXNpZ25hdHVyZVwiXSwgYXBpS2V5KTtcbiAgICAgICAgeWllbGQqIEVmZmVjdC5sb2dEZWJ1ZyhgU2lnbmF0dXJlIHZlcmlmaWVkOiAke3ZlcmlmaWVkfWApO1xuICAgICAgICBpZiAoIXZlcmlmaWVkKSB7XG4gICAgICAgICAgICB5aWVsZCogRWZmZWN0LmxvZ0Vycm9yKFwiSW52YWxpZCBzaWduYXR1cmVcIik7XG4gICAgICAgICAgICByZXR1cm4geWllbGQqIG5ldyBVcGxvYWRUaGluZ0Vycm9yKHtcbiAgICAgICAgICAgICAgICBjb2RlOiBcIkJBRF9SRVFVRVNUXCIsXG4gICAgICAgICAgICAgICAgbWVzc2FnZTogXCJJbnZhbGlkIHNpZ25hdHVyZVwiXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCByZXF1ZXN0SW5wdXQgPSB5aWVsZCogSHR0cFNlcnZlclJlcXVlc3Quc2NoZW1hQm9keUpzb24oUy5TdHJ1Y3Qoe1xuICAgICAgICAgICAgZmlsZUtleTogUy5TdHJpbmcsXG4gICAgICAgICAgICBlcnJvcjogUy5TdHJpbmdcbiAgICAgICAgfSkpO1xuICAgICAgICB5aWVsZCogRWZmZWN0LmxvZ0RlYnVnKFwiSGFuZGxpbmcgZXJyb3IgY2FsbGJhY2sgcmVxdWVzdCB3aXRoIGlucHV0OlwiKS5waXBlKEVmZmVjdC5hbm5vdGF0ZUxvZ3MoXCJqc29uXCIsIHJlcXVlc3RJbnB1dCkpO1xuICAgICAgICBjb25zdCBmaWJlciA9IHlpZWxkKiBFZmZlY3QudHJ5UHJvbWlzZSh7XG4gICAgICAgICAgICB0cnk6IGFzeW5jICgpPT51cGxvYWRhYmxlLl9kZWYub25VcGxvYWRFcnJvcih7XG4gICAgICAgICAgICAgICAgICAgIGVycm9yOiBuZXcgVXBsb2FkVGhpbmdFcnJvcih7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb2RlOiBcIlVQTE9BRF9GQUlMRURcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IGBVcGxvYWQgZmFpbGVkIGZvciAke3JlcXVlc3RJbnB1dC5maWxlS2V5fTogJHtyZXF1ZXN0SW5wdXQuZXJyb3J9YFxuICAgICAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgICAgICAgZmlsZUtleTogcmVxdWVzdElucHV0LmZpbGVLZXlcbiAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgIGNhdGNoOiAoZXJyb3IpPT5uZXcgVXBsb2FkVGhpbmdFcnJvcih7XG4gICAgICAgICAgICAgICAgICAgIGNvZGU6IFwiSU5URVJOQUxfU0VSVkVSX0VSUk9SXCIsXG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IFwiRmFpbGVkIHRvIHJ1biBvblVwbG9hZEVycm9yXCIsXG4gICAgICAgICAgICAgICAgICAgIGNhdXNlOiBlcnJvclxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgIH0pLnBpcGUoRWZmZWN0LnRhcEVycm9yKChlcnJvcik9PkVmZmVjdC5sb2dFcnJvcihcIkZhaWxlZCB0byBydW4gb25VcGxvYWRFcnJvci4gWW91IHByb2JhYmx5IHNob3VsZG4ndCBiZSB0aHJvd2luZyBlcnJvcnMgaGVyZS5cIikucGlwZShFZmZlY3QuYW5ub3RhdGVMb2dzKFwiZXJyb3JcIiwgZXJyb3IpKSkpLnBpcGUoRWZmZWN0Lmlnbm9yZUxvZ2dlZCwgRWZmZWN0LmZvcmtEYWVtb24pO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgYm9keTogbnVsbCxcbiAgICAgICAgICAgIGZpYmVyXG4gICAgICAgIH07XG4gICAgfSkucGlwZShFZmZlY3Qud2l0aExvZ1NwYW4oXCJoYW5kbGVFcnJvclJlcXVlc3RcIikpO1xuY29uc3QgaGFuZGxlQ2FsbGJhY2tSZXF1ZXN0ID0gKG9wdHMpPT5FZmZlY3QuZ2VuKGZ1bmN0aW9uKigpIHtcbiAgICAgICAgY29uc3QgeyB1cGxvYWRhYmxlLCBmZVBhY2thZ2UsIGJlQWRhcHRlciB9ID0gb3B0cztcbiAgICAgICAgY29uc3QgcmVxdWVzdCA9IHlpZWxkKiBIdHRwU2VydmVyUmVxdWVzdC5IdHRwU2VydmVyUmVxdWVzdDtcbiAgICAgICAgY29uc3QgeyBhcGlLZXkgfSA9IHlpZWxkKiBVVFRva2VuO1xuICAgICAgICBjb25zdCB2ZXJpZmllZCA9IHlpZWxkKiB2ZXJpZnlTaWduYXR1cmUoKHlpZWxkKiByZXF1ZXN0LnRleHQpLCByZXF1ZXN0LmhlYWRlcnNbXCJ4LXVwbG9hZHRoaW5nLXNpZ25hdHVyZVwiXSwgYXBpS2V5KTtcbiAgICAgICAgeWllbGQqIEVmZmVjdC5sb2dEZWJ1ZyhgU2lnbmF0dXJlIHZlcmlmaWVkOiAke3ZlcmlmaWVkfWApO1xuICAgICAgICBpZiAoIXZlcmlmaWVkKSB7XG4gICAgICAgICAgICB5aWVsZCogRWZmZWN0LmxvZ0Vycm9yKFwiSW52YWxpZCBzaWduYXR1cmVcIik7XG4gICAgICAgICAgICByZXR1cm4geWllbGQqIG5ldyBVcGxvYWRUaGluZ0Vycm9yKHtcbiAgICAgICAgICAgICAgICBjb2RlOiBcIkJBRF9SRVFVRVNUXCIsXG4gICAgICAgICAgICAgICAgbWVzc2FnZTogXCJJbnZhbGlkIHNpZ25hdHVyZVwiXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCByZXF1ZXN0SW5wdXQgPSB5aWVsZCogSHR0cFNlcnZlclJlcXVlc3Quc2NoZW1hQm9keUpzb24oUy5TdHJ1Y3Qoe1xuICAgICAgICAgICAgc3RhdHVzOiBTLlN0cmluZyxcbiAgICAgICAgICAgIGZpbGU6IFVwbG9hZGVkRmlsZURhdGEsXG4gICAgICAgICAgICBtZXRhZGF0YTogUy5SZWNvcmQoe1xuICAgICAgICAgICAgICAgIGtleTogUy5TdHJpbmcsXG4gICAgICAgICAgICAgICAgdmFsdWU6IFMuVW5rbm93blxuICAgICAgICAgICAgfSlcbiAgICAgICAgfSkpO1xuICAgICAgICB5aWVsZCogRWZmZWN0LmxvZ0RlYnVnKFwiSGFuZGxpbmcgY2FsbGJhY2sgcmVxdWVzdCB3aXRoIGlucHV0OlwiKS5waXBlKEVmZmVjdC5hbm5vdGF0ZUxvZ3MoXCJqc29uXCIsIHJlcXVlc3RJbnB1dCkpO1xuICAgICAgICAvKipcbiAgICAgKiBSdW4gYC5vblVwbG9hZENvbXBsZXRlYCBhcyBhIGRhZW1vbiB0byBwcmV2ZW50IHRoZVxuICAgICAqIHJlcXVlc3QgZnJvbSBVVCB0byBwb3RlbnRpYWxseSB0aW1lb3V0LlxuICAgICAqLyBjb25zdCBmaWJlciA9IHlpZWxkKiBFZmZlY3QuZ2VuKGZ1bmN0aW9uKigpIHtcbiAgICAgICAgICAgIGNvbnN0IHNlcnZlckRhdGEgPSB5aWVsZCogRWZmZWN0LnRyeVByb21pc2Uoe1xuICAgICAgICAgICAgICAgIHRyeTogYXN5bmMgKCk9PnVwbG9hZGFibGUucmVzb2x2ZXIoe1xuICAgICAgICAgICAgICAgICAgICAgICAgZmlsZTogcmVxdWVzdElucHV0LmZpbGUsXG4gICAgICAgICAgICAgICAgICAgICAgICBtZXRhZGF0YTogcmVxdWVzdElucHV0Lm1ldGFkYXRhXG4gICAgICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICAgIGNhdGNoOiAoZXJyb3IpPT5uZXcgVXBsb2FkVGhpbmdFcnJvcih7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb2RlOiBcIklOVEVSTkFMX1NFUlZFUl9FUlJPUlwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogXCJGYWlsZWQgdG8gcnVuIG9uVXBsb2FkQ29tcGxldGUuIFlvdSBwcm9iYWJseSBzaG91bGRuJ3QgYmUgdGhyb3dpbmcgZXJyb3JzIGhlcmUuXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXVzZTogZXJyb3JcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgY29uc3QgcGF5bG9hZCA9IHtcbiAgICAgICAgICAgICAgICBmaWxlS2V5OiByZXF1ZXN0SW5wdXQuZmlsZS5rZXksXG4gICAgICAgICAgICAgICAgY2FsbGJhY2tEYXRhOiBzZXJ2ZXJEYXRhID8/IG51bGxcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICB5aWVsZCogRWZmZWN0LmxvZ0RlYnVnKFwiJ29uVXBsb2FkQ29tcGxldGUnIGNhbGxiYWNrIGZpbmlzaGVkLiBTZW5kaW5nIHJlc3BvbnNlIHRvIFVwbG9hZFRoaW5nOlwiKS5waXBlKEVmZmVjdC5hbm5vdGF0ZUxvZ3MoXCJjYWxsYmFja0RhdGFcIiwgcGF5bG9hZCkpO1xuICAgICAgICAgICAgY29uc3QgYmFzZVVybCA9IHlpZWxkKiBJbmdlc3RVcmw7XG4gICAgICAgICAgICBjb25zdCBodHRwQ2xpZW50ID0gKHlpZWxkKiBIdHRwQ2xpZW50Lkh0dHBDbGllbnQpLnBpcGUoSHR0cENsaWVudC5maWx0ZXJTdGF0dXNPayk7XG4gICAgICAgICAgICB5aWVsZCogSHR0cENsaWVudFJlcXVlc3QucG9zdChgL2NhbGxiYWNrLXJlc3VsdGApLnBpcGUoSHR0cENsaWVudFJlcXVlc3QucHJlcGVuZFVybChiYXNlVXJsKSwgSHR0cENsaWVudFJlcXVlc3Quc2V0SGVhZGVycyh7XG4gICAgICAgICAgICAgICAgXCJ4LXVwbG9hZHRoaW5nLWFwaS1rZXlcIjogUmVkYWN0ZWQudmFsdWUoYXBpS2V5KSxcbiAgICAgICAgICAgICAgICBcIngtdXBsb2FkdGhpbmctdmVyc2lvblwiOiB2ZXJzaW9uLFxuICAgICAgICAgICAgICAgIFwieC11cGxvYWR0aGluZy1iZS1hZGFwdGVyXCI6IGJlQWRhcHRlcixcbiAgICAgICAgICAgICAgICBcIngtdXBsb2FkdGhpbmctZmUtcGFja2FnZVwiOiBmZVBhY2thZ2VcbiAgICAgICAgICAgIH0pLCBIdHRwQ2xpZW50UmVxdWVzdC5ib2R5SnNvbihwYXlsb2FkKSwgRWZmZWN0LmZsYXRNYXAoaHR0cENsaWVudC5leGVjdXRlKSwgRWZmZWN0LnRhcEVycm9yKGxvZ0h0dHBDbGllbnRFcnJvcihcIkZhaWxlZCB0byByZWdpc3RlciBjYWxsYmFjayByZXN1bHRcIikpLCBFZmZlY3QuZmxhdE1hcChIdHRwQ2xpZW50UmVzcG9uc2Uuc2NoZW1hQm9keUpzb24oQ2FsbGJhY2tSZXN1bHRSZXNwb25zZSkpLCBFZmZlY3QudGFwKEVmZmVjdC5sb2coXCJTZW50IGNhbGxiYWNrIHJlc3VsdCB0byBVcGxvYWRUaGluZ1wiKSksIEVmZmVjdC5zY29wZWQpO1xuICAgICAgICB9KS5waXBlKEVmZmVjdC5pZ25vcmVMb2dnZWQsIEVmZmVjdC5mb3JrRGFlbW9uKTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGJvZHk6IG51bGwsXG4gICAgICAgICAgICBmaWJlclxuICAgICAgICB9O1xuICAgIH0pLnBpcGUoRWZmZWN0LndpdGhMb2dTcGFuKFwiaGFuZGxlQ2FsbGJhY2tSZXF1ZXN0XCIpKTtcbmNvbnN0IHJ1blJvdXRlTWlkZGxld2FyZSA9IChvcHRzKT0+RWZmZWN0LmdlbihmdW5jdGlvbiooKSB7XG4gICAgICAgIGNvbnN0IG1pZGRsZXdhcmVBcmdzID0geWllbGQqIE1pZGRsZXdhcmVBcmd1bWVudHM7XG4gICAgICAgIGNvbnN0IHsganNvbjogeyBmaWxlcywgaW5wdXQgfSwgdXBsb2FkYWJsZSB9ID0gb3B0cztcbiAgICAgICAgeWllbGQqIEVmZmVjdC5sb2dEZWJ1ZyhcIlJ1bm5pbmcgbWlkZGxld2FyZVwiKTtcbiAgICAgICAgY29uc3QgbWV0YWRhdGEgPSB5aWVsZCogRWZmZWN0LnRyeVByb21pc2Uoe1xuICAgICAgICAgICAgdHJ5OiBhc3luYyAoKT0+dXBsb2FkYWJsZS5fZGVmLm1pZGRsZXdhcmUoe1xuICAgICAgICAgICAgICAgICAgICAuLi5taWRkbGV3YXJlQXJncyxcbiAgICAgICAgICAgICAgICAgICAgaW5wdXQsXG4gICAgICAgICAgICAgICAgICAgIGZpbGVzXG4gICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICBjYXRjaDogKGVycm9yKT0+ZXJyb3IgaW5zdGFuY2VvZiBVcGxvYWRUaGluZ0Vycm9yID8gZXJyb3IgOiBuZXcgVXBsb2FkVGhpbmdFcnJvcih7XG4gICAgICAgICAgICAgICAgICAgIGNvZGU6IFwiSU5URVJOQUxfU0VSVkVSX0VSUk9SXCIsXG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IFwiRmFpbGVkIHRvIHJ1biBtaWRkbGV3YXJlXCIsXG4gICAgICAgICAgICAgICAgICAgIGNhdXNlOiBlcnJvclxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgIH0pO1xuICAgICAgICBpZiAobWV0YWRhdGFbVVRGaWxlc10gJiYgbWV0YWRhdGFbVVRGaWxlc10ubGVuZ3RoICE9PSBmaWxlcy5sZW5ndGgpIHtcbiAgICAgICAgICAgIGNvbnN0IG1zZyA9IGBFeHBlY3RlZCBmaWxlcyBvdmVycmlkZSB0byBoYXZlIHRoZSBzYW1lIGxlbmd0aCBhcyBvcmlnaW5hbCBmaWxlcywgZ290ICR7bWV0YWRhdGFbVVRGaWxlc10ubGVuZ3RofSBidXQgZXhwZWN0ZWQgJHtmaWxlcy5sZW5ndGh9YDtcbiAgICAgICAgICAgIHlpZWxkKiBFZmZlY3QubG9nRXJyb3IobXNnKTtcbiAgICAgICAgICAgIHJldHVybiB5aWVsZCogbmV3IFVwbG9hZFRoaW5nRXJyb3Ioe1xuICAgICAgICAgICAgICAgIGNvZGU6IFwiQkFEX1JFUVVFU1RcIixcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiBcIkZpbGVzIG92ZXJyaWRlIG11c3QgaGF2ZSB0aGUgc2FtZSBsZW5ndGggYXMgZmlsZXNcIixcbiAgICAgICAgICAgICAgICBjYXVzZTogbXNnXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICAvLyBBdHRhY2ggY3VzdG9tSWRzIGZyb20gbWlkZGxld2FyZSB0byB0aGUgZmlsZXNcbiAgICAgICAgY29uc3QgZmlsZXNXaXRoQ3VzdG9tSWRzID0geWllbGQqIEVmZmVjdC5mb3JFYWNoKGZpbGVzLCAoZmlsZSwgaWR4KT0+RWZmZWN0LmdlbihmdW5jdGlvbiooKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgdGhlaXJzID0gbWV0YWRhdGFbVVRGaWxlc10/LltpZHhdO1xuICAgICAgICAgICAgICAgIGlmICh0aGVpcnMgJiYgdGhlaXJzLnNpemUgIT09IGZpbGUuc2l6ZSkge1xuICAgICAgICAgICAgICAgICAgICB5aWVsZCogRWZmZWN0LmxvZ1dhcm5pbmcoXCJGaWxlIHNpemUgbWlzbWF0Y2guIFJldmVydGluZyB0byBvcmlnaW5hbCBzaXplXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICBuYW1lOiB0aGVpcnM/Lm5hbWUgPz8gZmlsZS5uYW1lLFxuICAgICAgICAgICAgICAgICAgICBzaXplOiBmaWxlLnNpemUsXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6IGZpbGUudHlwZSxcbiAgICAgICAgICAgICAgICAgICAgY3VzdG9tSWQ6IHRoZWlycz8uY3VzdG9tSWQsXG4gICAgICAgICAgICAgICAgICAgIGxhc3RNb2RpZmllZDogdGhlaXJzPy5sYXN0TW9kaWZpZWQgPz8gRGF0ZS5ub3coKVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9KSk7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBtZXRhZGF0YSxcbiAgICAgICAgICAgIGZpbGVzV2l0aEN1c3RvbUlkc1xuICAgICAgICB9O1xuICAgIH0pLnBpcGUoRWZmZWN0LndpdGhMb2dTcGFuKFwicnVuUm91dGVNaWRkbGV3YXJlXCIpKTtcbmNvbnN0IGhhbmRsZVVwbG9hZEFjdGlvbiA9IChvcHRzKT0+RWZmZWN0LmdlbihmdW5jdGlvbiooKSB7XG4gICAgICAgIGNvbnN0IGh0dHBDbGllbnQgPSAoeWllbGQqIEh0dHBDbGllbnQuSHR0cENsaWVudCkucGlwZShIdHRwQ2xpZW50LmZpbHRlclN0YXR1c09rKTtcbiAgICAgICAgY29uc3QgeyB1cGxvYWRhYmxlLCBmZVBhY2thZ2UsIGJlQWRhcHRlciwgc2x1ZyB9ID0gb3B0cztcbiAgICAgICAgY29uc3QganNvbiA9IHlpZWxkKiBIdHRwU2VydmVyUmVxdWVzdC5zY2hlbWFCb2R5SnNvbihVcGxvYWRBY3Rpb25QYXlsb2FkKTtcbiAgICAgICAgeWllbGQqIEVmZmVjdC5sb2dEZWJ1ZyhcIkhhbmRsaW5nIHVwbG9hZCByZXF1ZXN0XCIpLnBpcGUoRWZmZWN0LmFubm90YXRlTG9ncyhcImpzb25cIiwganNvbikpO1xuICAgICAgICAvLyB2YWxpZGF0ZSB0aGUgaW5wdXRcbiAgICAgICAgeWllbGQqIEVmZmVjdC5sb2dEZWJ1ZyhcIlBhcnNpbmcgdXNlciBpbnB1dFwiKTtcbiAgICAgICAgY29uc3QgaW5wdXRQYXJzZXIgPSB1cGxvYWRhYmxlLl9kZWYuaW5wdXRQYXJzZXI7XG4gICAgICAgIGNvbnN0IHBhcnNlZElucHV0ID0geWllbGQqIEVmZmVjdC50cnlQcm9taXNlKHtcbiAgICAgICAgICAgIHRyeTogYXN5bmMgKCk9PmdldFBhcnNlRm4oaW5wdXRQYXJzZXIpKGpzb24uaW5wdXQpLFxuICAgICAgICAgICAgY2F0Y2g6IChlcnJvcik9Pm5ldyBVcGxvYWRUaGluZ0Vycm9yKHtcbiAgICAgICAgICAgICAgICAgICAgY29kZTogXCJCQURfUkVRVUVTVFwiLFxuICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiBcIkludmFsaWQgaW5wdXRcIixcbiAgICAgICAgICAgICAgICAgICAgY2F1c2U6IGVycm9yXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgfSk7XG4gICAgICAgIHlpZWxkKiBFZmZlY3QubG9nRGVidWcoXCJJbnB1dCBwYXJzZWQgc3VjY2Vzc2Z1bGx5XCIpLnBpcGUoRWZmZWN0LmFubm90YXRlTG9ncyhcImlucHV0XCIsIHBhcnNlZElucHV0KSk7XG4gICAgICAgIGNvbnN0IHsgbWV0YWRhdGEsIGZpbGVzV2l0aEN1c3RvbUlkcyB9ID0geWllbGQqIHJ1blJvdXRlTWlkZGxld2FyZSh7XG4gICAgICAgICAgICBqc29uOiB7XG4gICAgICAgICAgICAgICAgaW5wdXQ6IHBhcnNlZElucHV0LFxuICAgICAgICAgICAgICAgIGZpbGVzOiBqc29uLmZpbGVzXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdXBsb2FkYWJsZVxuICAgICAgICB9KTtcbiAgICAgICAgeWllbGQqIEVmZmVjdC5sb2dEZWJ1ZyhcIlBhcnNpbmcgcm91dGUgY29uZmlnXCIpLnBpcGUoRWZmZWN0LmFubm90YXRlTG9ncyhcInJvdXRlckNvbmZpZ1wiLCB1cGxvYWRhYmxlLl9kZWYucm91dGVyQ29uZmlnKSk7XG4gICAgICAgIGNvbnN0IHBhcnNlZENvbmZpZyA9IHlpZWxkKiBmaWxsSW5wdXRSb3V0ZUNvbmZpZyh1cGxvYWRhYmxlLl9kZWYucm91dGVyQ29uZmlnKS5waXBlKEVmZmVjdC5jYXRjaFRhZyhcIkludmFsaWRSb3V0ZUNvbmZpZ1wiLCAoZXJyKT0+bmV3IFVwbG9hZFRoaW5nRXJyb3Ioe1xuICAgICAgICAgICAgICAgIGNvZGU6IFwiQkFEX1JFUVVFU1RcIixcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiBcIkludmFsaWQgcm91dGUgY29uZmlnXCIsXG4gICAgICAgICAgICAgICAgY2F1c2U6IGVyclxuICAgICAgICAgICAgfSkpKTtcbiAgICAgICAgeWllbGQqIEVmZmVjdC5sb2dEZWJ1ZyhcIlJvdXRlIGNvbmZpZyBwYXJzZWQgc3VjY2Vzc2Z1bGx5XCIpLnBpcGUoRWZmZWN0LmFubm90YXRlTG9ncyhcInJvdXRlQ29uZmlnXCIsIHBhcnNlZENvbmZpZykpO1xuICAgICAgICB5aWVsZCogRWZmZWN0LmxvZ0RlYnVnKFwiVmFsaWRhdGluZyBmaWxlcyBtZWV0IHRoZSBjb25maWcgcmVxdWlyZW1lbnRzXCIpLnBpcGUoRWZmZWN0LmFubm90YXRlTG9ncyhcImZpbGVzXCIsIGpzb24uZmlsZXMpKTtcbiAgICAgICAgeWllbGQqIGFzc2VydEZpbGVzTWVldENvbmZpZyhqc29uLmZpbGVzLCBwYXJzZWRDb25maWcpLnBpcGUoRWZmZWN0Lm1hcEVycm9yKChlKT0+bmV3IFVwbG9hZFRoaW5nRXJyb3Ioe1xuICAgICAgICAgICAgICAgIGNvZGU6IFwiQkFEX1JFUVVFU1RcIixcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiBgSW52YWxpZCBjb25maWc6ICR7ZS5fdGFnfWAsXG4gICAgICAgICAgICAgICAgY2F1c2U6IFwicmVhc29uXCIgaW4gZSA/IGUucmVhc29uIDogZS5tZXNzYWdlXG4gICAgICAgICAgICB9KSkpO1xuICAgICAgICB5aWVsZCogRWZmZWN0LmxvZ0RlYnVnKFwiRmlsZXMgdmFsaWRhdGVkLlwiKTtcbiAgICAgICAgY29uc3QgZmlsZVVwbG9hZFJlcXVlc3RzID0geWllbGQqIEVmZmVjdC5mb3JFYWNoKGZpbGVzV2l0aEN1c3RvbUlkcywgKGZpbGUpPT5FZmZlY3QubWFwKG1hdGNoRmlsZVR5cGUoZmlsZSwgb2JqZWN0S2V5cyhwYXJzZWRDb25maWcpKSwgKHR5cGUpPT4oe1xuICAgICAgICAgICAgICAgICAgICBuYW1lOiBmaWxlLm5hbWUsXG4gICAgICAgICAgICAgICAgICAgIHNpemU6IGZpbGUuc2l6ZSxcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogZmlsZS50eXBlIHx8IHR5cGUsXG4gICAgICAgICAgICAgICAgICAgIGxhc3RNb2RpZmllZDogZmlsZS5sYXN0TW9kaWZpZWQsXG4gICAgICAgICAgICAgICAgICAgIGN1c3RvbUlkOiBmaWxlLmN1c3RvbUlkLFxuICAgICAgICAgICAgICAgICAgICBjb250ZW50RGlzcG9zaXRpb246IHBhcnNlZENvbmZpZ1t0eXBlXT8uY29udGVudERpc3Bvc2l0aW9uID8/IFwiaW5saW5lXCIsXG4gICAgICAgICAgICAgICAgICAgIGFjbDogcGFyc2VkQ29uZmlnW3R5cGVdPy5hY2xcbiAgICAgICAgICAgICAgICB9KSkpLnBpcGUoRWZmZWN0LmNhdGNoVGFncyh7XG4gICAgICAgICAgICAvKiogU2hvdWxkbid0IGhhcHBlbiBzaW5jZSBjb25maWcgaXMgdmFsaWRhdGVkIGFib3ZlIHNvIGp1c3QgZHlpbmcgaXMgZmluZSBJIHRoaW5rICovIEludmFsaWRGaWxlVHlwZTogKGUpPT5FZmZlY3QuZGllKGUpLFxuICAgICAgICAgICAgVW5rbm93bkZpbGVUeXBlOiAoZSk9PkVmZmVjdC5kaWUoZSlcbiAgICAgICAgfSkpO1xuICAgICAgICBjb25zdCByb3V0ZU9wdGlvbnMgPSB1cGxvYWRhYmxlLl9kZWYucm91dGVPcHRpb25zO1xuICAgICAgICBjb25zdCB7IGFwaUtleSwgYXBwSWQgfSA9IHlpZWxkKiBVVFRva2VuO1xuICAgICAgICBjb25zdCBpbmdlc3RVcmwgPSB5aWVsZCogSW5nZXN0VXJsO1xuICAgICAgICBjb25zdCBpc0RldiA9IHlpZWxkKiBJc0RldmVsb3BtZW50O1xuICAgICAgICB5aWVsZCogRWZmZWN0LmxvZ0RlYnVnKFwiR2VuZXJhdGluZyBwcmVzaWduZWQgVVJMc1wiKS5waXBlKEVmZmVjdC5hbm5vdGF0ZUxvZ3MoXCJmaWxlVXBsb2FkUmVxdWVzdHNcIiwgZmlsZVVwbG9hZFJlcXVlc3RzKSwgRWZmZWN0LmFubm90YXRlTG9ncyhcImluZ2VzdFVybFwiLCBpbmdlc3RVcmwpKTtcbiAgICAgICAgY29uc3QgcHJlc2lnbmVkVXJscyA9IHlpZWxkKiBFZmZlY3QuZm9yRWFjaChmaWxlVXBsb2FkUmVxdWVzdHMsIChmaWxlKT0+RWZmZWN0LmdlbihmdW5jdGlvbiooKSB7XG4gICAgICAgICAgICAgICAgY29uc3Qga2V5ID0geWllbGQqIGdlbmVyYXRlS2V5KGZpbGUsIGFwcElkLCByb3V0ZU9wdGlvbnMuZ2V0RmlsZUhhc2hQYXJ0cyk7XG4gICAgICAgICAgICAgICAgY29uc3QgdXJsID0geWllbGQqIGdlbmVyYXRlU2lnbmVkVVJMKGAke2luZ2VzdFVybH0vJHtrZXl9YCwgYXBpS2V5LCB7XG4gICAgICAgICAgICAgICAgICAgIHR0bEluU2Vjb25kczogcm91dGVPcHRpb25zLnByZXNpZ25lZFVSTFRUTCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgICAgICAgICAgXCJ4LXV0LWlkZW50aWZpZXJcIjogYXBwSWQsXG4gICAgICAgICAgICAgICAgICAgICAgICBcIngtdXQtZmlsZS1uYW1lXCI6IGZpbGUubmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFwieC11dC1maWxlLXNpemVcIjogZmlsZS5zaXplLFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ4LXV0LWZpbGUtdHlwZVwiOiBmaWxlLnR5cGUsXG4gICAgICAgICAgICAgICAgICAgICAgICBcIngtdXQtc2x1Z1wiOiBzbHVnLFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ4LXV0LWN1c3RvbS1pZFwiOiBmaWxlLmN1c3RvbUlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ4LXV0LWNvbnRlbnQtZGlzcG9zaXRpb25cIjogZmlsZS5jb250ZW50RGlzcG9zaXRpb24sXG4gICAgICAgICAgICAgICAgICAgICAgICBcIngtdXQtYWNsXCI6IGZpbGUuYWNsXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICB1cmwsXG4gICAgICAgICAgICAgICAgICAgIGtleVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9KSwge1xuICAgICAgICAgICAgY29uY3VycmVuY3k6IFwidW5ib3VuZGVkXCJcbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IHNlcnZlclJlcSA9IHlpZWxkKiBIdHRwU2VydmVyUmVxdWVzdC5IdHRwU2VydmVyUmVxdWVzdDtcbiAgICAgICAgY29uc3QgcmVxdWVzdFVybCA9IHlpZWxkKiBIdHRwU2VydmVyUmVxdWVzdC50b1VSTChzZXJ2ZXJSZXEpO1xuICAgICAgICBjb25zdCBkZXZIb29rUmVxdWVzdCA9IHlpZWxkKiBDb25maWcuc3RyaW5nKFwiY2FsbGJhY2tVcmxcIikucGlwZShDb25maWcud2l0aERlZmF1bHQocmVxdWVzdFVybC5vcmlnaW4gKyByZXF1ZXN0VXJsLnBhdGhuYW1lKSwgRWZmZWN0Lm1hcCgodXJsKT0+SHR0cENsaWVudFJlcXVlc3QucG9zdCh1cmwpLnBpcGUoSHR0cENsaWVudFJlcXVlc3QuYXBwZW5kVXJsUGFyYW0oXCJzbHVnXCIsIHNsdWcpKSkpO1xuICAgICAgICBjb25zdCBtZXRhZGF0YVJlcXVlc3QgPSBIdHRwQ2xpZW50UmVxdWVzdC5wb3N0KFwiL3JvdXRlLW1ldGFkYXRhXCIpLnBpcGUoSHR0cENsaWVudFJlcXVlc3QucHJlcGVuZFVybChpbmdlc3RVcmwpLCBIdHRwQ2xpZW50UmVxdWVzdC5zZXRIZWFkZXJzKHtcbiAgICAgICAgICAgIFwieC11cGxvYWR0aGluZy1hcGkta2V5XCI6IFJlZGFjdGVkLnZhbHVlKGFwaUtleSksXG4gICAgICAgICAgICBcIngtdXBsb2FkdGhpbmctdmVyc2lvblwiOiB2ZXJzaW9uLFxuICAgICAgICAgICAgXCJ4LXVwbG9hZHRoaW5nLWJlLWFkYXB0ZXJcIjogYmVBZGFwdGVyLFxuICAgICAgICAgICAgXCJ4LXVwbG9hZHRoaW5nLWZlLXBhY2thZ2VcIjogZmVQYWNrYWdlXG4gICAgICAgIH0pLCBIdHRwQ2xpZW50UmVxdWVzdC5ib2R5SnNvbih7XG4gICAgICAgICAgICBmaWxlS2V5czogcHJlc2lnbmVkVXJscy5tYXAoKHsga2V5IH0pPT5rZXkpLFxuICAgICAgICAgICAgbWV0YWRhdGE6IG1ldGFkYXRhLFxuICAgICAgICAgICAgaXNEZXYsXG4gICAgICAgICAgICBjYWxsYmFja1VybDogZGV2SG9va1JlcXVlc3QudXJsLFxuICAgICAgICAgICAgY2FsbGJhY2tTbHVnOiBzbHVnLFxuICAgICAgICAgICAgYXdhaXRTZXJ2ZXJEYXRhOiByb3V0ZU9wdGlvbnMuYXdhaXRTZXJ2ZXJEYXRhID8/IHRydWVcbiAgICAgICAgfSksIEVmZmVjdC5mbGF0TWFwKGh0dHBDbGllbnQuZXhlY3V0ZSkpO1xuICAgICAgICAvLyBTZW5kIG1ldGFkYXRhIHRvIFVUIHNlcnZlciAobm9uIGJsb2NraW5nIGFzIGEgZGFlbW9uKVxuICAgICAgICAvLyBJbiBkZXYsIGtlZXAgdGhlIHN0cmVhbSBvcGVuIGFuZCBzaW11bGF0ZSB0aGUgY2FsbGJhY2sgcmVxdWVzdHMgYXNcbiAgICAgICAgLy8gZmlsZXMgY29tcGxldGUgdXBsb2FkaW5nXG4gICAgICAgIGNvbnN0IGZpYmVyID0geWllbGQqIEVmZmVjdC5pZihpc0Rldiwge1xuICAgICAgICAgICAgb25UcnVlOiAoKT0+bWV0YWRhdGFSZXF1ZXN0LnBpcGUoRWZmZWN0LnRhcEJvdGgoe1xuICAgICAgICAgICAgICAgICAgICBvblN1Y2Nlc3M6IGxvZ0h0dHBDbGllbnRSZXNwb25zZShcIlJlZ2lzdGVyZWQgbWV0YWRhdGFcIiwge1xuICAgICAgICAgICAgICAgICAgICAgICAgbWl4aW46IFwiTm9uZVwiXG4gICAgICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICAgICAgICBvbkZhaWx1cmU6IGxvZ0h0dHBDbGllbnRFcnJvcihcIkZhaWxlZCB0byByZWdpc3RlciBtZXRhZGF0YVwiKVxuICAgICAgICAgICAgICAgIH0pLCBIdHRwQ2xpZW50UmVzcG9uc2Uuc3RyZWFtLCBoYW5kbGVKc29uTGluZVN0cmVhbShNZXRhZGF0YUZldGNoU3RyZWFtUGFydCwgKGNodW5rKT0+ZGV2SG9va1JlcXVlc3QucGlwZShIdHRwQ2xpZW50UmVxdWVzdC5zZXRIZWFkZXJzKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidXBsb2FkdGhpbmctaG9va1wiOiBjaHVuay5ob29rLFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJ4LXVwbG9hZHRoaW5nLXNpZ25hdHVyZVwiOiBjaHVuay5zaWduYXR1cmVcbiAgICAgICAgICAgICAgICAgICAgfSksIEh0dHBDbGllbnRSZXF1ZXN0LnNldEJvZHkoSHR0cEJvZHkudGV4dChjaHVuay5wYXlsb2FkLCBcImFwcGxpY2F0aW9uL2pzb25cIikpLCBodHRwQ2xpZW50LmV4ZWN1dGUsIEVmZmVjdC50YXBCb3RoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9uU3VjY2VzczogbG9nSHR0cENsaWVudFJlc3BvbnNlKFwiU3VjY2Vzc2Z1bGx5IGZvcndhcmRlZCBjYWxsYmFjayByZXF1ZXN0IGZyb20gZGV2IHN0cmVhbVwiKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIG9uRmFpbHVyZTogbG9nSHR0cENsaWVudEVycm9yKFwiRmFpbGVkIHRvIGZvcndhcmQgY2FsbGJhY2sgcmVxdWVzdCBmcm9tIGRldiBzdHJlYW1cIilcbiAgICAgICAgICAgICAgICAgICAgfSksIEVmZmVjdC5hbm5vdGF0ZUxvZ3MoY2h1bmspLCBFZmZlY3QuYXNWb2lkLCBFZmZlY3QuaWdub3JlTG9nZ2VkLCBFZmZlY3Quc2NvcGVkKSkpLFxuICAgICAgICAgICAgb25GYWxzZTogKCk9Pm1ldGFkYXRhUmVxdWVzdC5waXBlKEVmZmVjdC50YXBCb3RoKHtcbiAgICAgICAgICAgICAgICAgICAgb25TdWNjZXNzOiBsb2dIdHRwQ2xpZW50UmVzcG9uc2UoXCJSZWdpc3RlcmVkIG1ldGFkYXRhXCIpLFxuICAgICAgICAgICAgICAgICAgICBvbkZhaWx1cmU6IGxvZ0h0dHBDbGllbnRFcnJvcihcIkZhaWxlZCB0byByZWdpc3RlciBtZXRhZGF0YVwiKVxuICAgICAgICAgICAgICAgIH0pLCBFZmZlY3QuZmxhdE1hcChIdHRwQ2xpZW50UmVzcG9uc2Uuc2NoZW1hQm9keUpzb24oTWV0YWRhdGFGZXRjaFJlc3BvbnNlKSksIEVmZmVjdC5zY29wZWQpXG4gICAgICAgIH0pLnBpcGUoRWZmZWN0LmZvcmtEYWVtb24pO1xuICAgICAgICBjb25zdCBwcmVzaWduZWRzID0gcHJlc2lnbmVkVXJscy5tYXAoKHAsIGkpPT4oe1xuICAgICAgICAgICAgICAgIHVybDogcC51cmwsXG4gICAgICAgICAgICAgICAga2V5OiBwLmtleSxcbiAgICAgICAgICAgICAgICBuYW1lOiBmaWxlVXBsb2FkUmVxdWVzdHNbaV0ubmFtZSxcbiAgICAgICAgICAgICAgICBjdXN0b21JZDogZmlsZVVwbG9hZFJlcXVlc3RzW2ldLmN1c3RvbUlkID8/IG51bGxcbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgeWllbGQqIEVmZmVjdC5sb2dJbmZvKFwiU2VuZGluZyBwcmVzaWduZWQgVVJMcyB0byBjbGllbnRcIikucGlwZShFZmZlY3QuYW5ub3RhdGVMb2dzKFwicHJlc2lnbmVkVXJsc1wiLCBwcmVzaWduZWRzKSk7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBib2R5OiBwcmVzaWduZWRzLFxuICAgICAgICAgICAgZmliZXJcbiAgICAgICAgfTtcbiAgICB9KS5waXBlKEVmZmVjdC53aXRoTG9nU3BhbihcImhhbmRsZVVwbG9hZEFjdGlvblwiKSk7XG5cbmZ1bmN0aW9uIGludGVybmFsQ3JlYXRlQnVpbGRlcihpbml0RGVmID0ge30pIHtcbiAgICBjb25zdCBfZGVmID0ge1xuICAgICAgICAvLyBEZWZhdWx0IHJvdXRlciBjb25maWdcbiAgICAgICAgcm91dGVyQ29uZmlnOiB7XG4gICAgICAgICAgICBpbWFnZToge1xuICAgICAgICAgICAgICAgIG1heEZpbGVTaXplOiBcIjRNQlwiXG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHJvdXRlT3B0aW9uczoge1xuICAgICAgICAgICAgYXdhaXRTZXJ2ZXJEYXRhOiB0cnVlXG4gICAgICAgIH0sXG4gICAgICAgIGlucHV0UGFyc2VyOiB7XG4gICAgICAgICAgICBwYXJzZTogKCk9PnVuZGVmaW5lZCxcbiAgICAgICAgICAgIF9pbnB1dDogdW5kZWZpbmVkLFxuICAgICAgICAgICAgX291dHB1dDogdW5kZWZpbmVkXG4gICAgICAgIH0sXG4gICAgICAgIG1pZGRsZXdhcmU6ICgpPT4oe30pLFxuICAgICAgICBvblVwbG9hZEVycm9yOiAoKT0+e1xuICAgICAgICAvLyBub29wXG4gICAgICAgIH0sXG4gICAgICAgIGVycm9yRm9ybWF0dGVyOiBpbml0RGVmLmVycm9yRm9ybWF0dGVyID8/IGRlZmF1bHRFcnJvckZvcm1hdHRlcixcbiAgICAgICAgLy8gT3ZlcmxvYWQgd2l0aCBwcm9wZXJ0aWVzIHBhc3NlZCBpblxuICAgICAgICAuLi5pbml0RGVmXG4gICAgfTtcbiAgICByZXR1cm4ge1xuICAgICAgICBpbnB1dCAodXNlclBhcnNlcikge1xuICAgICAgICAgICAgcmV0dXJuIGludGVybmFsQ3JlYXRlQnVpbGRlcih7XG4gICAgICAgICAgICAgICAgLi4uX2RlZixcbiAgICAgICAgICAgICAgICBpbnB1dFBhcnNlcjogdXNlclBhcnNlclxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIG1pZGRsZXdhcmUgKHVzZXJNaWRkbGV3YXJlKSB7XG4gICAgICAgICAgICByZXR1cm4gaW50ZXJuYWxDcmVhdGVCdWlsZGVyKHtcbiAgICAgICAgICAgICAgICAuLi5fZGVmLFxuICAgICAgICAgICAgICAgIG1pZGRsZXdhcmU6IHVzZXJNaWRkbGV3YXJlXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgb25VcGxvYWRDb21wbGV0ZSAodXNlclVwbG9hZENvbXBsZXRlKSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIF9kZWYsXG4gICAgICAgICAgICAgICAgcmVzb2x2ZXI6IHVzZXJVcGxvYWRDb21wbGV0ZVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSxcbiAgICAgICAgb25VcGxvYWRFcnJvciAodXNlck9uVXBsb2FkRXJyb3IpIHtcbiAgICAgICAgICAgIHJldHVybiBpbnRlcm5hbENyZWF0ZUJ1aWxkZXIoe1xuICAgICAgICAgICAgICAgIC4uLl9kZWYsXG4gICAgICAgICAgICAgICAgb25VcGxvYWRFcnJvcjogdXNlck9uVXBsb2FkRXJyb3JcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfTtcbn1cbmZ1bmN0aW9uIGNyZWF0ZUJ1aWxkZXIob3B0cykge1xuICAgIHJldHVybiAoaW5wdXQsIGNvbmZpZyk9PntcbiAgICAgICAgcmV0dXJuIGludGVybmFsQ3JlYXRlQnVpbGRlcih7XG4gICAgICAgICAgICByb3V0ZXJDb25maWc6IGlucHV0LFxuICAgICAgICAgICAgcm91dGVPcHRpb25zOiBjb25maWcgPz8ge30sXG4gICAgICAgICAgICAuLi5vcHRzXG4gICAgICAgIH0pO1xuICAgIH07XG59XG5cbmNvbnN0IGNyZWF0ZVVwbG9hZHRoaW5nID0gKG9wdHMpPT5jcmVhdGVCdWlsZGVyKG9wdHMpO1xuY29uc3QgY3JlYXRlUm91dGVIYW5kbGVyID0gKG9wdHMpPT57XG4gICAgY29uc3QgaGFuZGxlciA9IG1ha2VBZGFwdGVySGFuZGxlcigocmVxKT0+RWZmZWN0LnN1Y2NlZWQoe1xuICAgICAgICAgICAgcmVxLFxuICAgICAgICAgICAgcmVzOiB1bmRlZmluZWQsXG4gICAgICAgICAgICBldmVudDogdW5kZWZpbmVkXG4gICAgICAgIH0pLCAocmVxKT0+RWZmZWN0LnN1Y2NlZWQocmVxKSwgb3B0cywgXCJuZXh0anMtYXBwXCIpO1xuICAgIHJldHVybiB7XG4gICAgICAgIFBPU1Q6IGhhbmRsZXIsXG4gICAgICAgIEdFVDogaGFuZGxlclxuICAgIH07XG59O1xuXG5leHBvcnQgeyBjcmVhdGVSb3V0ZUhhbmRsZXIsIGNyZWF0ZVVwbG9hZHRoaW5nIH07XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/uploadthing/next/index.js\n");

/***/ })

};
;